<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/blog/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/blog/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/blog/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/blog/images/logo.svg" color="#222">

<link rel="stylesheet" href="/blog/css/main.css">


<link rel="stylesheet" href="/blog/lib/font-awesome/css/font-awesome.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"pasaulis.gitee.io","root":"/blog/","scheme":"Gemini","version":"7.7.2","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="一、静态文件参考：https:&#x2F;&#x2F;www.cnblogs.com&#x2F;jiajiaba&#x2F;p&#x2F;10584329.html参考：https:&#x2F;&#x2F;docs.djangoproject.com&#x2F;zh-hans&#x2F;3.0&#x2F;ref&#x2F;settings&#x2F;#static-files 1.1 使用在 网页使用的css文件，js文件和图片叫做静态文件。1)新建静态文件夹 根目录&#x2F;static&#x2F;js、css、images2)">
<meta property="og:type" content="article">
<meta property="og:title" content="Django（十七）：静态文件、中间件">
<meta property="og:url" content="https://pasaulis.gitee.io/blog/2020/01/14/Django%EF%BC%88%E5%8D%81%E4%B8%83%EF%BC%89%EF%BC%9A%E9%9D%99%E6%80%81%E6%96%87%E4%BB%B6%E3%80%81%E4%B8%AD%E9%97%B4%E4%BB%B6/index.html">
<meta property="og:site_name" content="晨曦的博客">
<meta property="og:description" content="一、静态文件参考：https:&#x2F;&#x2F;www.cnblogs.com&#x2F;jiajiaba&#x2F;p&#x2F;10584329.html参考：https:&#x2F;&#x2F;docs.djangoproject.com&#x2F;zh-hans&#x2F;3.0&#x2F;ref&#x2F;settings&#x2F;#static-files 1.1 使用在 网页使用的css文件，js文件和图片叫做静态文件。1)新建静态文件夹 根目录&#x2F;static&#x2F;js、css、images2)">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20200113151801923.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTAxMzIxNzc=,size_16,color_FFFFFF,t_70">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20200113152941694.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTAxMzIxNzc=,size_16,color_FFFFFF,t_70">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20200114130423197.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTAxMzIxNzc=,size_16,color_FFFFFF,t_70">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20200113152941694.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTAxMzIxNzc=,size_16,color_FFFFFF,t_70">
<meta property="article:published_time" content="2020-01-14T04:00:02.000Z">
<meta property="article:modified_time" content="2020-03-23T03:01:39.331Z">
<meta property="article:author" content="晨曦">
<meta property="article:tag" content="python">
<meta property="article:tag" content="vue">
<meta property="article:tag" content="react">
<meta property="article:tag" content="AI">
<meta property="article:tag" content="人工智能">
<meta property="article:tag" content="爬虫">
<meta property="article:tag" content="大数据分析">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://img-blog.csdnimg.cn/20200113151801923.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTAxMzIxNzc=,size_16,color_FFFFFF,t_70">

<link rel="canonical" href="https://pasaulis.gitee.io/blog/2020/01/14/Django%EF%BC%88%E5%8D%81%E4%B8%83%EF%BC%89%EF%BC%9A%E9%9D%99%E6%80%81%E6%96%87%E4%BB%B6%E3%80%81%E4%B8%AD%E9%97%B4%E4%BB%B6/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>Django（十七）：静态文件、中间件 | 晨曦的博客</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/blog/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">晨曦的博客</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">技术博客</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/blog/" rel="section"><i class="fa fa-fw fa-home"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/blog/about/" rel="section"><i class="fa fa-fw fa-user"></i>关于</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/blog/categories/" rel="section"><i class="fa fa-fw fa-th"></i>分类</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/blog/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>标签</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/blog/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block " lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://pasaulis.gitee.io/blog/2020/01/14/Django%EF%BC%88%E5%8D%81%E4%B8%83%EF%BC%89%EF%BC%9A%E9%9D%99%E6%80%81%E6%96%87%E4%BB%B6%E3%80%81%E4%B8%AD%E9%97%B4%E4%BB%B6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="http://www.zeyajt.com/u/40b74ddb-a87b-41cd-821b-3f6eeb544661/image/637203952121373129.jpg">
      <meta itemprop="name" content="晨曦">
      <meta itemprop="description" content="晨曦的技术博客，专注于python、vue、react、人工智能、爬虫、大数据分析">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="晨曦的博客">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Django（十七）：静态文件、中间件
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-01-14 12:00:02" itemprop="dateCreated datePublished" datetime="2020-01-14T12:00:02+08:00">2020-01-14</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-03-23 11:01:39" itemprop="dateModified" datetime="2020-03-23T11:01:39+08:00">2020-03-23</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/python/" itemprop="url" rel="index"><span itemprop="name">python</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/python/Django/" itemprop="url" rel="index"><span itemprop="name">Django</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="一、静态文件"><a href="#一、静态文件" class="headerlink" title="一、静态文件"></a>一、静态文件</h1><p>参考：<a href="https://www.cnblogs.com/jiajiaba/p/10584329.html" target="_blank" rel="noopener">https://www.cnblogs.com/jiajiaba/p/10584329.html</a><br>参考：<a href="https://docs.djangoproject.com/zh-hans/3.0/ref/settings/#static-files" target="_blank" rel="noopener">https://docs.djangoproject.com/zh-hans/3.0/ref/settings/#static-files</a></p>
<h2 id="1-1-使用"><a href="#1-1-使用" class="headerlink" title="1.1 使用"></a>1.1 使用</h2><p>在 网页使用的css文件，js文件和图片叫做静态文件。<br>1)新建静态文件夹 根目录/static/js、css、images<br>2) 配置静态文件所在的物理目录。</p>
<h3 id="Settings-py"><a href="#Settings-py" class="headerlink" title="Settings.py"></a>Settings.py</h3><p>【1】设置访问静态文件对应的url地址<br>【2】设置静态文件存放的物理目录(必须设置，否则访问内部文件会显示404not found)</p>
<a id="more"></a>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Static files (CSS, JavaScript, Images)</span></span><br><span class="line"><span class="comment"># https://docs.djangoproject.com/en/1.8/howto/static-files/</span></span><br><span class="line"><span class="comment"># 【1】设置访问静态文件对应的url地址</span></span><br><span class="line">STATIC_URL = <span class="string">'/static/'</span></span><br><span class="line"><span class="comment"># STATIC_URL = '/abc/'</span></span><br><span class="line"><span class="comment"># 【2】设置静态文件存放的物理目录(必须设置，否则访问内部文件会显示404not found)</span></span><br><span class="line">STATICFILES_DIRS = [os.path.join(BASE_DIR, <span class="string">'static'</span>)]</span><br></pre></td></tr></table></figure>
<p><strong>说明：</strong></p>
<ul>
<li>STATIC_URL 设置访问静态文件对应的url。</li>
<li>STATICFILES_DIRS 设置静态文件所在的物理目录。</li>
</ul>
<h2 id="1-2-加载目录过程（了解）"><a href="#1-2-加载目录过程（了解）" class="headerlink" title="1.2 加载目录过程（了解）"></a>1.2 加载目录过程（了解）</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">STATICFILES_FINDERS=(<span class="string">'django.contrib.staticfiles.finders.FileSystemFinder'</span>, </span><br><span class="line"><span class="string">'django.contrib.staticfiles.finders.AppDirectoriesFinder'</span>)</span><br></pre></td></tr></table></figure>

<h2 id="1-3-模板中动态生成静态文件路径"><a href="#1-3-模板中动态生成静态文件路径" class="headerlink" title="1.3 模板中动态生成静态文件路径"></a>1.3 模板中动态生成静态文件路径</h2><ol>
<li><code>{ % load static % }</code> django2.0以前可能是  <code>{ % load staticfiles % }</code></li>
<li><code>&lt;img src=&quot;{ % static &#39;images/mm.jpg&#39; % }&quot;&gt;</code><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">"en"</span>&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">"UTF-8"</span>&gt;</span><br><span class="line">    &lt;!-- 【1】加载静态 --&gt;</span><br><span class="line">    &#123;% load static %&#125;</span><br><span class="line">    &lt;title&gt;首页&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h1&gt;首页&#123;&#123;name&#125;&#125;&lt;/h1&gt;</span><br><span class="line"></span><br><span class="line">&lt;img src=<span class="string">"/static/images/mm.jpg"</span>&gt;&lt;br/&gt;</span><br><span class="line">&lt;img src=<span class="string">"/abc/images/mm.jpg"</span>&gt;&lt;br/&gt;</span><br><span class="line">【<span class="number">2</span>】动态获取STATIC_URL,拼接静态文件路径:&lt;br/&gt;</span><br><span class="line">&lt;img src=<span class="string">"&#123;% static 'images/mm.jpg' %&#125;"</span>&gt;</span><br><span class="line"></span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
效果：</li>
</ol>
<ul>
<li>1.1 2) 步的配置文件改变成<code>STATIC_URL = &#39;/abc/&#39;</code>动态的路径依旧可以得到正确地址。<br>settings.py<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Static files (CSS, JavaScript, Images)</span></span><br><span class="line"><span class="comment"># https://docs.djangoproject.com/en/1.8/howto/static-files/</span></span><br><span class="line"><span class="comment"># 【1】设置访问静态文件对应的url地址</span></span><br><span class="line"><span class="comment"># STATIC_URL = '/static/'</span></span><br><span class="line">STATIC_URL = <span class="string">'/abc/'</span></span><br><span class="line"><span class="comment"># 【2】设置静态文件存放的物理目录</span></span><br><span class="line"><span class="comment">#STATICFILES_DIRS = [os.path.join(BASE_DIR, 'static')]</span></span><br></pre></td></tr></table></figure>
<img src="https://img-blog.csdnimg.cn/20200113151801923.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTAxMzIxNzc=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><h1 id="二、中间件（函数）"><a href="#二、中间件（函数）" class="headerlink" title="二、中间件（函数）"></a>二、中间件（函数）</h1>【参考】<a href="https://docs.djangoproject.com/zh-hans/3.0/topics/http/middleware/" target="_blank" rel="noopener">https://docs.djangoproject.com/zh-hans/3.0/topics/http/middleware/</a><h5 id="【中间件函数】是django框架给我们预留的函数接口，让我们可以干预请求和应答的过程。"><a href="#【中间件函数】是django框架给我们预留的函数接口，让我们可以干预请求和应答的过程。" class="headerlink" title="【中间件函数】是django框架给我们预留的函数接口，让我们可以干预请求和应答的过程。"></a>【中间件函数】是django框架给我们预留的函数接口，让我们可以<font color='red'>干预请求</font>和<font color='red'>应答的过程</font>。</h5><img src="https://img-blog.csdnimg.cn/20200113152941694.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTAxMzIxNzc=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br><img src="https://img-blog.csdnimg.cn/20200114130423197.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTAxMzIxNzc=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><h2 id="2-0-实例支持：获取浏览器端的ip地址"><a href="#2-0-实例支持：获取浏览器端的ip地址" class="headerlink" title="2.0 实例支持：获取浏览器端的ip地址"></a>2.0 实例支持：获取浏览器端的ip地址</h2>使用request对象的META属性：<code>request.META[&#39;REMOTE_ADDR&#39;]</code><h2 id="2-1中间件作用——实例说明"><a href="#2-1中间件作用——实例说明" class="headerlink" title="2.1中间件作用——实例说明"></a>2.1中间件作用——实例说明</h2></li>
<li>目标：过滤指定IP，让它访问不了网站</li>
</ul>
<h2 id="2-2常规解决方法——【装饰器过滤IP】"><a href="#2-2常规解决方法——【装饰器过滤IP】" class="headerlink" title="2.2常规解决方法——【装饰器过滤IP】"></a>2.2常规解决方法——【装饰器过滤IP】</h2><h4 id="1）app2-views-py编辑装饰器"><a href="#1）app2-views-py编辑装饰器" class="headerlink" title="1）app2/views.py编辑装饰器"></a>1）app2/views.py编辑装饰器</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">EXCLUDE_IPS = [<span class="string">'192.168.1.123'</span>,<span class="string">'172.16.179.152'</span>] <span class="comment">#第1个ip即要禁用的目标主机IP</span></span><br><span class="line"><span class="string">'''装饰器函数：如果IP在exclude_ids里则返回forbidden'''</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">blocked_ips</span><span class="params">(view_func)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">wrapper</span><span class="params">(request, *view_args, **view_kwargs)</span>:</span></span><br><span class="line">        <span class="comment"># 获取浏览器端的ip地址</span></span><br><span class="line">        user_ip = request.META[<span class="string">'REMOTE_ADDR'</span>]</span><br><span class="line">        <span class="keyword">if</span> user_ip <span class="keyword">in</span> EXCLUDE_IPS:</span><br><span class="line">            <span class="keyword">return</span> HttpResponse(<span class="string">'&lt;h1&gt;Forbidden&lt;/h1&gt;'</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> view_func(request, *view_args, **view_kwargs)</span><br><span class="line">    <span class="keyword">return</span> wrapper</span><br><span class="line"></span><br><span class="line"><span class="comment"># /index</span></span><br><span class="line"><span class="meta">@blocked_ips #引用装饰器，此页面会禁用指定ip访问</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span> <span class="params">(request)</span>:</span>    </span><br><span class="line">    <span class="keyword">return</span> render(request,<span class="string">'app2/index.html'</span>,&#123;<span class="string">'name'</span>:<span class="string">'Tom'</span>&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># /url_reverse</span></span><br><span class="line"><span class="meta">@blocked_ips #引用装饰器，此页面会禁用指定ip访问</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">url_reverse</span> <span class="params">(request)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> render(request,<span class="string">'app2/url_reverse.html'</span>)</span><br></pre></td></tr></table></figure>
<h4 id="2）urls配置略过"><a href="#2）urls配置略过" class="headerlink" title="2）urls配置略过#"></a>2）urls配置略过#</h4><h4 id="3）启动服务"><a href="#3）启动服务" class="headerlink" title="3）启动服务"></a>3）启动服务</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">py manage.py runserver <span class="number">192.168</span><span class="number">.1</span><span class="number">.4</span>:<span class="number">8000</span></span><br></pre></td></tr></table></figure>
<h4 id="4）在局域网的另一台主机（192-168-1-123电脑）访问-192-168-1-4-8000-index-或-url-reverse"><a href="#4）在局域网的另一台主机（192-168-1-123电脑）访问-192-168-1-4-8000-index-或-url-reverse" class="headerlink" title="4）在局域网的另一台主机（192.168.1.123电脑）访问 192.168.1.4:8000/index 或 url_reverse"></a>4）在局域网的另一台主机（192.168.1.123电脑）访问 192.168.1.4:8000/index 或 url_reverse</h4><p>显示：<strong>Forbidden</strong></p>
<h4 id="5）装饰器方法缺点：虽然也能禁用指定IP，但每个视频函数页面都要调用装饰器-blocked-ips，太过麻烦。"><a href="#5）装饰器方法缺点：虽然也能禁用指定IP，但每个视频函数页面都要调用装饰器-blocked-ips，太过麻烦。" class="headerlink" title="5）装饰器方法缺点：虽然也能禁用指定IP，但每个视频函数页面都要调用装饰器@blocked_ips，太过麻烦。"></a>5）装饰器方法缺点：虽然也能禁用指定IP，但每个视频函数页面都要调用装饰器<code>@blocked_ips</code>，太过麻烦。</h4><h2 id="2-3-中间件过滤IP【重点】"><a href="#2-3-中间件过滤IP【重点】" class="headerlink" title="2.3 中间件过滤IP【重点】"></a><font color='red'>2.3 中间件过滤IP【重点】</font></h2><p>【参考】<a href="https://segmentfault.com/a/1190000019784702" target="_blank" rel="noopener">https://segmentfault.com/a/1190000019784702</a></p>
<h3 id="1）app2-middleware-py-编写中间件"><a href="#1）app2-middleware-py-编写中间件" class="headerlink" title="1）app2/middleware.py 编写中间件"></a>1）app2/middleware.py 编写中间件</h3><p>建立文件，自定义中间件函数，详细代码：</p>
<ol>
<li>新建app2/middleware.py文件。</li>
<li>定义中间件类，写中间件函数</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> HttpResponse</span><br><span class="line"><span class="keyword">from</span> django.utils.deprecation <span class="keyword">import</span> MiddlewareMixin</span><br><span class="line"></span><br><span class="line"><span class="comment">#【1】类继承自MiddlewareMixin，类名可随意写，建议加上Middleware  </span></span><br><span class="line"><span class="comment">#django2.0之前写法：class BlockedIPSMiddleware(object)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BlockedIPSMiddleware</span><span class="params">(MiddlewareMixin)</span>:</span> </span><br><span class="line">    <span class="string">'''中间件类'''</span></span><br><span class="line">    EXCLUDE_IPS = [<span class="string">'192.168.1.123'</span>,<span class="string">'172.16.179.152'</span>]</span><br><span class="line">    <span class="comment">#【2】此处是process_view函数重写，因此写法固定，不能变（包括函数名、参数）</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">process_view</span><span class="params">(self, request, view_func, *view_args, **view_kwargs)</span>:</span></span><br><span class="line">        <span class="string">'''视图函数调用之前会调用'''</span></span><br><span class="line">        user_ip = request.META[<span class="string">'REMOTE_ADDR'</span>]</span><br><span class="line">        <span class="keyword">if</span> user_ip <span class="keyword">in</span> BlockedIPSMiddleware.EXCLUDE_IPS:</span><br><span class="line">            <span class="keyword">return</span> HttpResponse(<span class="string">'&lt;h1&gt;Forbidden&lt;/h1&gt;'</span>)</span><br></pre></td></tr></table></figure>

<h3 id="2）【project2-settings-py】配置中间件"><a href="#2）【project2-settings-py】配置中间件" class="headerlink" title="2）【project2/settings.py】配置中间件"></a>2）【project2/settings.py】配置中间件</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">【<span class="number">1</span>】注册过滤IP的中间件类名（app2文件夹下.middleware.py文件下.BlockedIPSMiddleware类）</span><br><span class="line">MIDDLEWARE = [</span><br><span class="line">    <span class="string">'django.middleware.security.SecurityMiddleware'</span>,</span><br><span class="line">    <span class="string">'django.contrib.sessions.middleware.SessionMiddleware'</span>,</span><br><span class="line">    <span class="string">'django.middleware.common.CommonMiddleware'</span>,</span><br><span class="line">    <span class="string">'django.middleware.csrf.CsrfViewMiddleware'</span>, <span class="comment">#django默认打开csrf防护，它只对post提交有效</span></span><br><span class="line">    <span class="string">'django.contrib.auth.middleware.AuthenticationMiddleware'</span>,</span><br><span class="line">    <span class="string">'django.contrib.messages.middleware.MessageMiddleware'</span>,</span><br><span class="line">    <span class="string">'django.middleware.clickjacking.XFrameOptionsMiddleware'</span>,</span><br><span class="line">    <span class="string">'app2.middleware.BlockedIPSMiddleware'</span> <span class="comment"># 【1】注册过滤IP的中间件类名（app2文件夹下.middleware.py文件下.BlockedIPSMiddleware类）</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<h3 id="附）app2-views-py"><a href="#附）app2-views-py" class="headerlink" title="附）app2/views.py"></a>附）app2/views.py</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render,redirect</span><br><span class="line"><span class="keyword">from</span> django.template <span class="keyword">import</span> loader,RequestContext</span><br><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> HttpResponse,JsonResponse</span><br><span class="line"><span class="keyword">from</span> app2.models <span class="keyword">import</span> BookInfo</span><br><span class="line"></span><br><span class="line">EXCLUDE_IPS = [<span class="string">'192.168.1.123'</span>,<span class="string">'172.16.179.152'</span>]</span><br><span class="line"><span class="string">'''装饰器函数：如果IP在exclude_ids里则返回forbidden'''</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">blocked_ips</span><span class="params">(view_func)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">wrapper</span><span class="params">(request, *view_args, **view_kwargs)</span>:</span></span><br><span class="line">        <span class="comment"># 获取浏览器端的ip地址</span></span><br><span class="line">        user_ip = request.META[<span class="string">'REMOTE_ADDR'</span>]</span><br><span class="line">        <span class="keyword">if</span> user_ip <span class="keyword">in</span> EXCLUDE_IPS:</span><br><span class="line">            <span class="keyword">return</span> HttpResponse(<span class="string">'&lt;h1&gt;Forbidden&lt;/h1&gt;'</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> view_func(request, *view_args, **view_kwargs)</span><br><span class="line">    <span class="keyword">return</span> wrapper</span><br><span class="line"></span><br><span class="line"><span class="comment"># /index</span></span><br><span class="line"><span class="comment">#@blocked_ips</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span> <span class="params">(request)</span>:</span>    </span><br><span class="line">    <span class="keyword">return</span> render(request,<span class="string">'app2/index.html'</span>,&#123;<span class="string">'name'</span>:<span class="string">'Tom'</span>&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># /url_reverse</span></span><br><span class="line"><span class="comment">#@blocked_ips</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">url_reverse</span> <span class="params">(request)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> render(request,<span class="string">'app2/url_reverse.html'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># /temp_tags</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">temp_tags</span><span class="params">(request)</span>:</span></span><br><span class="line">    <span class="string">'''模板标签'''</span></span><br><span class="line">    <span class="comment"># 1. 查找所有图书的信息</span></span><br><span class="line">    books = BookInfo.objects.all()</span><br><span class="line">    <span class="keyword">return</span> render(request,<span class="string">'app2/temp_tags.html'</span>, &#123;<span class="string">'books'</span>:books&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="3）效果：再启动服务器："><a href="#3）效果：再启动服务器：" class="headerlink" title="3）效果：再启动服务器："></a>3）效果：再启动服务器：</h3><p>1.打开cmd运行</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">py manage.py runserver <span class="number">192.168</span><span class="number">.1</span><span class="number">.4</span>:<span class="number">8000</span></span><br></pre></td></tr></table></figure>
<p>2.另一台电脑（192.168.1.123）访问任意网址：<a href="http://192.168.1.4:8000/temp_tags/" target="_blank" rel="noopener">http://192.168.1.4:8000/temp_tags/</a><br><a href="http://192.168.1.4:8000/index/等等。都会自动提示：" target="_blank" rel="noopener">http://192.168.1.4:8000/index/等等。都会自动提示：</a><br><strong>Forbidden</strong><br>3. 这样就不必加装饰器函数、逐个@装饰器函数了</p>
<h2 id="2-4-django2-0之后MiddlewareMixin中间件类的其它函数及作用"><a href="#2-4-django2-0之后MiddlewareMixin中间件类的其它函数及作用" class="headerlink" title="2.4 django2.0之后MiddlewareMixin中间件类的其它函数及作用"></a>2.4 django2.0之后MiddlewareMixin中间件类的其它函数及作用</h2><p><img src="https://img-blog.csdnimg.cn/20200113152941694.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTAxMzIxNzc=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h3 id="1）process-request"><a href="#1）process-request" class="headerlink" title="1）process_request:"></a>1）process_request:</h3><p>这是请求来到 middleware 中时讲入的第一个方法。一般情优下,我们以在这里做一些校验,比如<br>户登录或者 HTTP 中是否有认证头之类的验证.这个方法可以有两种返回值 HttpResnonse 或者None，如果返回 HttpResponse，那么接下米的处理方法只会执行 process_response，其他方法将不会被执行。这里需要注意的是，如果你的 middleware 是 settings 配置的 MIDDLEWARE 的第一个，那么剩下的 middleware 也不会被执行；如果返回 None，那么 Diango会继续执行其他方法。</p>
<h3 id="2）process-view"><a href="#2）process-view" class="headerlink" title="2）process_view:"></a>2）process_view:</h3><p>这个方法是在 process_request 方法之后执行的,参数如上面代码所示，其中 func 就是我们将要执行的 view 方法。因此，如果要统计一个view的执行时间，可以在这里做。它的返回值跟 process_request 一样，是HttpResponse 或者 None，其逻辑也一样。如果返回 None，那么 Django 会帮你执行 view 函数,从而得到最终的 response。</p>
<h3 id="3）Process-template-response"><a href="#3）Process-template-response" class="headerlink" title="3）Process_template_response:"></a>3）Process_template_response:</h3><p>执行完上面的方法，并且 Django 帮我们执行完 view，拿到最终的 response 后，如果使用了模板的 response (这是指通过 return render(request,’index.html’,context={})方式返回的 response),就会来到这个方法中。 在这个方法中，我们可以对 response 做一下操作,比如 Content-Type 设置,或者其他 header 的修改/增加。</p>
<h3 id="4）process-response"><a href="#4）process-response" class="headerlink" title="4）process_response:"></a>4）process_response:</h3><p>当所有流程都处理完毕后，就来到了这个方法。这个方法的逻辑跟 process_template_response是完全一样的,只是后者是针对带有模板的response的处理。</p>
<h3 id="5）process-exception"><a href="#5）process-exception" class="headerlink" title="5）process_exception:"></a>5）process_exception:</h3><p>上面的处理方法是按顺序介绍的，而这个方法不太一样。只有在发生异常时,才会进入这个方法。哪个阶段发生的异常呢?<br>可以简单理解为在将要调用的 View 中出现异常(就是在process_view 的 func 函数中)或者返回的模板 response 在渲染时发生的异常。但是需要注意的是，如果你在process_view 中手动调用了 func，就像我们上面做的那样,就不会触发 process_exception 了。这个方法接收到异常之<br>后，可以选择处理异常，然后返回一个含有异常信息的 HttpResponse，或者直接返回 None 不处理，这种情况下 Django会使用自己的异常模板。</p>
<h2 id="2-5）django2-0之前middleware函数："><a href="#2-5）django2-0之前middleware函数：" class="headerlink" title="2.5）django2.0之前middleware函数："></a>2.5）django2.0之前middleware函数：</h2><p>在类中定义中间件预留函数。<br><code>__init__</code>:服务器响应第一个请求的时候调用。<br>process_request:是在产生request对象，进行url匹配之前调用。<br>process_view：是url匹配之后，调用视图函数之前。<br>process_response：视图函数调用之后，内容返回给浏览器之前。<br>process_exception:视图函数出现异常，会调用这个函数。<br>如果注册的多个中间件类中包含process_exception函数的时候，调用的顺序跟注册的顺序是相反的。</p>
<h2 id="2-6）中间件各函数调用过程实例演示"><a href="#2-6）中间件各函数调用过程实例演示" class="headerlink" title="2.6）中间件各函数调用过程实例演示"></a>2.6）中间件各函数调用过程实例演示</h2><p>【参考】<a href="https://docs.djangoproject.com/zh-hans/3.0/topics/http/middleware/#upgrading-pre-django-1-10-style-middleware" target="_blank" rel="noopener">https://docs.djangoproject.com/zh-hans/3.0/topics/http/middleware/#upgrading-pre-django-1-10-style-middleware</a></p>
<h3 id="1）app2-middleware-py-编写中间件-1"><a href="#1）app2-middleware-py-编写中间件-1" class="headerlink" title="1）app2/middleware.py 编写中间件"></a>1）app2/middleware.py 编写中间件</h3><h5 id="django2-0后写法"><a href="#django2-0后写法" class="headerlink" title="django2.0后写法"></a><font color='red'>django2.0后写法</font></h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestMiddleware</span><span class="params">(MiddlewareMixin)</span>:</span> </span><br><span class="line">    <span class="string">'''中间件类'''</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,get_response)</span>:</span><span class="comment">#【1】重点一此处必须多加参数,get_response，否则报错： __init__() takes 1 positional argument but 2 were given</span></span><br><span class="line">        <span class="string">'''服务器重启之后，接收第一个请求时调用'''</span></span><br><span class="line">        <span class="comment">#super().__init__()</span></span><br><span class="line">        self.get_response = get_response <span class="comment">#【2】此处必须得到父类的get_response属性，否则报错 __init__() takes 1 positional argument but 2 were given</span></span><br><span class="line">        print(<span class="string">'----init----'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">process_request</span><span class="params">(self, request)</span>:</span></span><br><span class="line">        <span class="string">'''产生request对象之后，url匹配之前调用'''</span></span><br><span class="line">        print(<span class="string">'----process_request----'</span>)</span><br><span class="line">        <span class="comment"># return HttpResponse('process_request')</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">process_view</span><span class="params">(self, request, view_func, *view_args, **view_kwargs)</span>:</span></span><br><span class="line">        <span class="string">'''url匹配之后，视图函数调用之前调用'''</span></span><br><span class="line">        print(<span class="string">'----process_view----'</span>)</span><br><span class="line">        <span class="keyword">return</span> HttpResponse(<span class="string">'process_view'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">process_response</span><span class="params">(self, request, response)</span>:</span></span><br><span class="line">        <span class="string">'''视图函数调用之后，内容返回浏览器之前'''</span></span><br><span class="line">        print(<span class="string">'----process_response----'</span>)</span><br><span class="line">        <span class="keyword">return</span> response</span><br></pre></td></tr></table></figure>
<h5 id="django2-0之前写法"><a href="#django2-0之前写法" class="headerlink" title="django2.0之前写法"></a>django2.0之前写法</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">'''django2.0之前写法'''</span></span><br><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> HttpResponse</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestMiddleware</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="string">'''中间件类'''</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">'''服务器重启之后，接收第一个请求时调用'''</span></span><br><span class="line">        print(<span class="string">'----init----'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">process_request</span><span class="params">(self, request)</span>:</span></span><br><span class="line">        <span class="string">'''产生request对象之后，url匹配之前调用'''</span></span><br><span class="line">        print(<span class="string">'----process_request----'</span>)</span><br><span class="line">        <span class="comment"># return HttpResponse('process_request')</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">process_view</span><span class="params">(self, request, view_func, *view_args, **view_kwargs)</span>:</span></span><br><span class="line">        <span class="string">'''url匹配之后，视图函数调用之前调用'''</span></span><br><span class="line">        print(<span class="string">'----process_view----'</span>)</span><br><span class="line">        <span class="keyword">return</span> HttpResponse(<span class="string">'process_view'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">process_response</span><span class="params">(self, request, response)</span>:</span></span><br><span class="line">        <span class="string">'''视图函数调用之后，内容返回浏览器之前'''</span></span><br><span class="line">        print(<span class="string">'----process_response----'</span>)</span><br><span class="line">        <span class="keyword">return</span> response</span><br></pre></td></tr></table></figure>
<h3 id="2）app2-views-py"><a href="#2）app2-views-py" class="headerlink" title="2）app2/views.py"></a>2）app2/views.py</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render</span><br><span class="line"></span><br><span class="line"><span class="comment"># /index</span></span><br><span class="line"><span class="comment">#@blocked_ips</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span> <span class="params">(request)</span>:</span></span><br><span class="line">	<span class="string">'''首页'''</span></span><br><span class="line">    print(<span class="string">'----index----'</span>)   </span><br><span class="line">    <span class="keyword">return</span> render(request,<span class="string">'app2/index.html'</span>,&#123;<span class="string">'name'</span>:<span class="string">'Tom'</span>&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="3）配置settings-py"><a href="#3）配置settings-py" class="headerlink" title="3）配置settings.py"></a>3）配置settings.py</h3><p>【1】注册中间件流程测试类名</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">MIDDLEWARE = [</span><br><span class="line">    <span class="string">'django.middleware.security.SecurityMiddleware'</span>,</span><br><span class="line">    <span class="string">'django.contrib.sessions.middleware.SessionMiddleware'</span>,</span><br><span class="line">    <span class="string">'django.middleware.common.CommonMiddleware'</span>,</span><br><span class="line">    <span class="string">'django.middleware.csrf.CsrfViewMiddleware'</span>, <span class="comment">#django默认打开csrf防护，它只对post提交有效</span></span><br><span class="line">    <span class="string">'django.contrib.auth.middleware.AuthenticationMiddleware'</span>,</span><br><span class="line">    <span class="string">'django.contrib.messages.middleware.MessageMiddleware'</span>,</span><br><span class="line">    <span class="string">'django.middleware.clickjacking.XFrameOptionsMiddleware'</span>,</span><br><span class="line">    <span class="string">'app2.middleware.BlockedIPSMiddleware'</span>, <span class="comment"># 注册过滤IP的类名</span></span><br><span class="line">    <span class="string">'app2.middleware.TestMiddleware'</span>, <span class="comment">#【1】注册中间件流程测试类名</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<h3 id="效果：http-127-0-0-1-8000-index"><a href="#效果：http-127-0-0-1-8000-index" class="headerlink" title="效果：http://127.0.0.1:8000/index/"></a>效果：<a href="http://127.0.0.1:8000/index/" target="_blank" rel="noopener">http://127.0.0.1:8000/index/</a></h3><p>process_view</p>
<h5 id="1-正常运行（把首页截断不运行）"><a href="#1-正常运行（把首页截断不运行）" class="headerlink" title="1. 正常运行（把首页截断不运行）"></a>1. 正常运行（把首页截断不运行）</h5><p>控制台输出（即可看到中间件各函数运行流程）：</p>
<ol>
<li>第一次会执行init</li>
<li>再次请求就不再调用它了<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Starting development server at http://<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">8000</span>/</span><br><span class="line">Quit the server <span class="keyword">with</span> CTRL-BREAK.</span><br><span class="line">----init----</span><br><span class="line">----process_request----</span><br><span class="line">----process_view----</span><br><span class="line">----process_response----</span><br><span class="line">[<span class="number">14</span>/Jan/<span class="number">2020</span> <span class="number">10</span>:<span class="number">58</span>:<span class="number">16</span>] <span class="string">"GET /index/ HTTP/1.1"</span> <span class="number">200</span> <span class="number">12</span></span><br><span class="line">----process_request----</span><br><span class="line">----process_view----</span><br><span class="line">----process_response----</span><br><span class="line">[<span class="number">14</span>/Jan/<span class="number">2020</span> <span class="number">11</span>:<span class="number">01</span>:<span class="number">39</span>] <span class="string">"GET /index/ HTTP/1.1"</span> <span class="number">200</span> <span class="number">12</span></span><br></pre></td></tr></table></figure>
<h5 id="2-如果把process-request解除注释（后面步骤截断）"><a href="#2-如果把process-request解除注释（后面步骤截断）" class="headerlink" title="2. 如果把process_request解除注释（后面步骤截断）"></a>2. 如果把process_request解除注释（后面步骤截断）</h5>可以看到后面都被截断不再运行了。<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">process_request</span><span class="params">(self, request)</span>:</span></span><br><span class="line">        <span class="string">'''产生request对象之后，url匹配之前调用'''</span></span><br><span class="line">        print(<span class="string">'----process_request----'</span>)</span><br><span class="line">        <span class="keyword">return</span> HttpResponse(<span class="string">'process_request'</span>)</span><br></pre></td></tr></table></figure>
控制台输出<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">----process_request----</span><br><span class="line">----process_response----</span><br><span class="line">[<span class="number">14</span>/Jan/<span class="number">2020</span> <span class="number">11</span>:<span class="number">22</span>:<span class="number">36</span>] <span class="string">"GET /index/ HTTP/1.1"</span> <span class="number">200</span> <span class="number">15</span></span><br></pre></td></tr></table></figure>
<h5 id="3-如果这两个函数都注释掉："><a href="#3-如果这两个函数都注释掉：" class="headerlink" title="3. 如果这两个函数都注释掉："></a>3. 如果这两个函数都注释掉：</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">process_request</span><span class="params">(self, request)</span>:</span></span><br><span class="line">        <span class="string">'''产生request对象之后，url匹配之前调用'''</span></span><br><span class="line">        print(<span class="string">'----process_request----'</span>)</span><br><span class="line">        <span class="comment"># return HttpResponse('process_request')</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">process_view</span><span class="params">(self, request, view_func, *view_args, **view_kwargs)</span>:</span></span><br><span class="line">        <span class="string">'''url匹配之后，视图函数调用之前调用'''</span></span><br><span class="line">        print(<span class="string">'----process_view----'</span>)</span><br><span class="line">        <span class="comment">#return HttpResponse('process_view')</span></span><br></pre></td></tr></table></figure>
则控制台输出：</li>
</ol>
<ul>
<li>可以看到首页被加载了<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Quit the server <span class="keyword">with</span> CTRL-BREAK.</span><br><span class="line">----init----</span><br><span class="line">----process_request----</span><br><span class="line">----process_view----</span><br><span class="line">----index----</span><br><span class="line">----process_response----</span><br><span class="line">[<span class="number">14</span>/Jan/<span class="number">2020</span> <span class="number">11</span>:<span class="number">25</span>:<span class="number">45</span>] <span class="string">"GET /index/ HTTP/1.1"</span> <span class="number">200</span> <span class="number">349</span></span><br><span class="line">----process_request----</span><br><span class="line">----process_response----</span><br><span class="line">Not Found: /static/images/mm.jpg</span><br><span class="line">[<span class="number">14</span>/Jan/<span class="number">2020</span> <span class="number">11</span>:<span class="number">25</span>:<span class="number">45</span>] <span class="string">"GET /static/images/mm.jpg HTTP/1.1"</span> <span class="number">404</span> <span class="number">4316</span></span><br><span class="line">[<span class="number">14</span>/Jan/<span class="number">2020</span> <span class="number">11</span>:<span class="number">25</span>:<span class="number">45</span>] <span class="string">"GET /abc/images/mm.jpg HTTP/1.1"</span> <span class="number">404</span> <span class="number">1659</span></span><br></pre></td></tr></table></figure>
<h2 id="2-6）发生异常的中间件"><a href="#2-6）发生异常的中间件" class="headerlink" title="2.6）发生异常的中间件"></a>2.6）发生异常的中间件</h2><h3 id="1）app2-middleware-py-编写异常处理中间件"><a href="#1）app2-middleware-py-编写异常处理中间件" class="headerlink" title="1）app2/middleware.py 编写异常处理中间件"></a>1）app2/middleware.py 编写异常处理中间件</h3></li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> HttpResponse</span><br><span class="line"><span class="keyword">from</span> django.utils.deprecation <span class="keyword">import</span> MiddlewareMixin</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ExceptionTest1Middleware</span><span class="params">(MiddlewareMixin)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">process_exception</span><span class="params">(self, request, exception)</span>:</span></span><br><span class="line">        <span class="string">'''视图函数发生异常时调用'''</span></span><br><span class="line">        print(<span class="string">'----process_exception1----'</span>)</span><br><span class="line">        print(exception)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ExceptionTest2Middleware</span><span class="params">(MiddlewareMixin)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">process_exception</span><span class="params">(self, request, exception)</span>:</span></span><br><span class="line">        <span class="string">'''视图函数发生异常时调用'''</span></span><br><span class="line">        print(<span class="string">'----process_exception2----'</span>)</span><br></pre></td></tr></table></figure>
<h3 id="2）注册中间件settings-py"><a href="#2）注册中间件settings-py" class="headerlink" title="2）注册中间件settings.py"></a>2）注册中间件settings.py</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">MIDDLEWARE = [</span><br><span class="line">    <span class="string">'django.middleware.security.SecurityMiddleware'</span>,</span><br><span class="line">    <span class="string">'django.contrib.sessions.middleware.SessionMiddleware'</span>,</span><br><span class="line">    <span class="string">'django.middleware.common.CommonMiddleware'</span>,</span><br><span class="line">    <span class="string">'django.middleware.csrf.CsrfViewMiddleware'</span>, <span class="comment">#django默认打开csrf防护，它只对post提交有效</span></span><br><span class="line">    <span class="string">'django.contrib.auth.middleware.AuthenticationMiddleware'</span>,</span><br><span class="line">    <span class="string">'django.contrib.messages.middleware.MessageMiddleware'</span>,</span><br><span class="line">    <span class="string">'django.middleware.clickjacking.XFrameOptionsMiddleware'</span>,</span><br><span class="line">    <span class="comment">#'app2.middleware.BlockedIPSMiddleware', # 注册过滤IP的类名</span></span><br><span class="line">    <span class="comment">#'app2.middleware.TestMiddleware', #注册中间件流程测试类名</span></span><br><span class="line"></span><br><span class="line">    <span class="string">'app2.middleware.ExceptionTest1Middleware'</span>, <span class="comment">#【1】异常处理中间件</span></span><br><span class="line">    <span class="string">'app2.middleware.ExceptionTest2Middleware'</span>, <span class="comment">#【2】异常处理中间件，它们的调用顺序是自下往上的</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<h3 id="3）写一个错误到视图函数app2-views-py"><a href="#3）写一个错误到视图函数app2-views-py" class="headerlink" title="3）写一个错误到视图函数app2/views.py"></a>3）写一个错误到视图函数app2/views.py</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># /index</span></span><br><span class="line"><span class="comment">#@blocked_ips</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span> <span class="params">(request)</span>:</span></span><br><span class="line">    <span class="string">'''首页'''</span></span><br><span class="line">    name=<span class="string">'a'</span>+<span class="number">2</span> <span class="comment">#【错误】用字符串和数字相加</span></span><br><span class="line">    print(<span class="string">'----index----'</span>)    </span><br><span class="line">    <span class="keyword">return</span> render(request,<span class="string">'app2/index.html'</span>,&#123;<span class="string">'name'</span>:<span class="string">'Tom'</span>&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="效果：http-127-0-0-1-8000-index-1"><a href="#效果：http-127-0-0-1-8000-index-1" class="headerlink" title="效果：http://127.0.0.1:8000/index/"></a>效果：<a href="http://127.0.0.1:8000/index/" target="_blank" rel="noopener">http://127.0.0.1:8000/index/</a></h3><p>报错：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">TypeError at /index/</span><br><span class="line">can only concatenate str (<span class="keyword">not</span> <span class="string">"int"</span>) to str</span><br></pre></td></tr></table></figure>
<p>控制台输出：<br>【1-2】处</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">Starting development server at http://<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">8000</span>/</span><br><span class="line">Quit the server <span class="keyword">with</span> CTRL-BREAK.</span><br><span class="line">----process_exception2---- 【<span class="number">1</span>】</span><br><span class="line">----process_exception1----【<span class="number">2</span>】</span><br><span class="line"></span><br><span class="line">can only concatenate str (<span class="keyword">not</span> <span class="string">"int"</span>) to str</span><br><span class="line">Internal Server Error: /index/</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">"C:\Users\Administrator\AppData\Local\Programs\Python\Python37\lib\site-p</span></span><br><span class="line"><span class="string">ackages\django\core\handlers\exception.py"</span>, line <span class="number">34</span>, <span class="keyword">in</span> inner</span><br><span class="line">    response = get_response(request)</span><br><span class="line">  File <span class="string">"C:\Users\Administrator\AppData\Local\Programs\Python\Python37\lib\site-p</span></span><br><span class="line"><span class="string">ackages\django\core\handlers\base.py"</span>, line <span class="number">115</span>, <span class="keyword">in</span> _get_response</span><br><span class="line">    response = self.process_exception_by_middleware(e, request)</span><br><span class="line">  File <span class="string">"C:\Users\Administrator\AppData\Local\Programs\Python\Python37\lib\site-p</span></span><br><span class="line"><span class="string">ackages\django\core\handlers\base.py"</span>, line <span class="number">113</span>, <span class="keyword">in</span> _get_response</span><br><span class="line">    response = wrapped_callback(request, *callback_args, **callback_kwargs)</span><br><span class="line">  File <span class="string">"D:\a\django-app\project2\app2\views.py"</span>, line <span class="number">155</span>, <span class="keyword">in</span> index</span><br><span class="line">    name=<span class="string">'a'</span>+<span class="number">2</span></span><br><span class="line">TypeError: can only concatenate str (<span class="keyword">not</span> <span class="string">"int"</span>) to str</span><br><span class="line">[<span class="number">14</span>/Jan/<span class="number">2020</span> <span class="number">11</span>:<span class="number">54</span>:<span class="number">35</span>] <span class="string">"GET /index/ HTTP/1.1"</span> <span class="number">500</span> <span class="number">69194</span></span><br></pre></td></tr></table></figure>


    </div>

    
    
    

      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/blog/2020/01/13/Django%EF%BC%88%E5%8D%81%E5%85%AD%EF%BC%89%E5%9F%BA%E4%BA%8E%E6%A8%A1%E6%9D%BF%E7%9A%84%E7%99%BB%E5%BD%95%E6%A1%88%E4%BE%8B%EF%BC%9A%E7%99%BB%E5%BD%95%E8%A3%85%E9%A5%B0%E5%99%A8%E3%80%81csrf%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F%E5%8F%8A%E9%98%B2%E6%8A%A4%E3%80%81ajax%E7%9A%84Post%20%E7%9A%84csrf%E5%BC%80%E5%90%AF%E5%86%99%E6%B3%95%E3%80%81%E7%94%9F%E6%88%90%E9%AA%8C%E8%AF%81%E7%A0%81%E3%80%81%E5%8A%A0%E9%AA%8C%E8%AF%81%E7%A0%81%E7%99%BB%E5%BD%95%E3%80%81%E5%8F%8D%E5%90%91%E8%A7%A3%E6%9E%90+%E4%BC%A0%E5%8F%82/" rel="prev" title="Django（十六）基于模板的登录案例：登录装饰器、csrf攻击方式及防护、ajax的Post 的csrf开启写法、生成验证码、加验证码登录、反向解析+传参">
      <i class="fa fa-chevron-left"></i> Django（十六）基于模板的登录案例：登录装饰器、csrf攻击方式及防护、ajax的Post 的csrf开启写法、生成验证码、加验证码登录、反向解析+传参
    </a></div>
      <div class="post-nav-item">
    <a href="/blog/2020/01/17/Django%EF%BC%88%E5%8D%81%E5%85%AB%EF%BC%89%E5%90%8E%E5%8F%B0%E7%AE%A1%E7%90%86%EF%BC%9A%E5%88%97%E8%A1%A8%E9%A1%B5%E9%80%89%E9%A1%B9%E3%80%81%E7%BC%96%E8%BE%91%E9%A1%B5%E9%80%89%E9%A1%B9%E3%80%81%E8%87%AA%E5%AE%9A%E4%B9%89%E5%90%8E%E5%8F%B0%E9%A1%B5%E9%9D%A2/" rel="next" title="Django（十八）后台管理-列表页选项、编辑页选项、自定义后台页面">
      Django（十八）后台管理-列表页选项、编辑页选项、自定义后台页面 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  

  </div>


          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#一、静态文件"><span class="nav-number">1.</span> <span class="nav-text">一、静态文件</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-1-使用"><span class="nav-number">1.1.</span> <span class="nav-text">1.1 使用</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Settings-py"><span class="nav-number">1.1.1.</span> <span class="nav-text">Settings.py</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-2-加载目录过程（了解）"><span class="nav-number">1.2.</span> <span class="nav-text">1.2 加载目录过程（了解）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-3-模板中动态生成静态文件路径"><span class="nav-number">1.3.</span> <span class="nav-text">1.3 模板中动态生成静态文件路径</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#二、中间件（函数）"><span class="nav-number">2.</span> <span class="nav-text">二、中间件（函数）</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#【中间件函数】是django框架给我们预留的函数接口，让我们可以干预请求和应答的过程。"><span class="nav-number">2.0.0.0.1.</span> <span class="nav-text">【中间件函数】是django框架给我们预留的函数接口，让我们可以干预请求和应答的过程。</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-0-实例支持：获取浏览器端的ip地址"><span class="nav-number">2.1.</span> <span class="nav-text">2.0 实例支持：获取浏览器端的ip地址</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-1中间件作用——实例说明"><span class="nav-number">2.2.</span> <span class="nav-text">2.1中间件作用——实例说明</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-2常规解决方法——【装饰器过滤IP】"><span class="nav-number">2.3.</span> <span class="nav-text">2.2常规解决方法——【装饰器过滤IP】</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1）app2-views-py编辑装饰器"><span class="nav-number">2.3.0.1.</span> <span class="nav-text">1）app2&#x2F;views.py编辑装饰器</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2）urls配置略过"><span class="nav-number">2.3.0.2.</span> <span class="nav-text">2）urls配置略过#</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3）启动服务"><span class="nav-number">2.3.0.3.</span> <span class="nav-text">3）启动服务</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4）在局域网的另一台主机（192-168-1-123电脑）访问-192-168-1-4-8000-index-或-url-reverse"><span class="nav-number">2.3.0.4.</span> <span class="nav-text">4）在局域网的另一台主机（192.168.1.123电脑）访问 192.168.1.4:8000&#x2F;index 或 url_reverse</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5）装饰器方法缺点：虽然也能禁用指定IP，但每个视频函数页面都要调用装饰器-blocked-ips，太过麻烦。"><span class="nav-number">2.3.0.5.</span> <span class="nav-text">5）装饰器方法缺点：虽然也能禁用指定IP，但每个视频函数页面都要调用装饰器@blocked_ips，太过麻烦。</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-3-中间件过滤IP【重点】"><span class="nav-number">2.4.</span> <span class="nav-text">2.3 中间件过滤IP【重点】</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1）app2-middleware-py-编写中间件"><span class="nav-number">2.4.1.</span> <span class="nav-text">1）app2&#x2F;middleware.py 编写中间件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2）【project2-settings-py】配置中间件"><span class="nav-number">2.4.2.</span> <span class="nav-text">2）【project2&#x2F;settings.py】配置中间件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#附）app2-views-py"><span class="nav-number">2.4.3.</span> <span class="nav-text">附）app2&#x2F;views.py</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3）效果：再启动服务器："><span class="nav-number">2.4.4.</span> <span class="nav-text">3）效果：再启动服务器：</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-4-django2-0之后MiddlewareMixin中间件类的其它函数及作用"><span class="nav-number">2.5.</span> <span class="nav-text">2.4 django2.0之后MiddlewareMixin中间件类的其它函数及作用</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1）process-request"><span class="nav-number">2.5.1.</span> <span class="nav-text">1）process_request:</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2）process-view"><span class="nav-number">2.5.2.</span> <span class="nav-text">2）process_view:</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3）Process-template-response"><span class="nav-number">2.5.3.</span> <span class="nav-text">3）Process_template_response:</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4）process-response"><span class="nav-number">2.5.4.</span> <span class="nav-text">4）process_response:</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5）process-exception"><span class="nav-number">2.5.5.</span> <span class="nav-text">5）process_exception:</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-5）django2-0之前middleware函数："><span class="nav-number">2.6.</span> <span class="nav-text">2.5）django2.0之前middleware函数：</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-6）中间件各函数调用过程实例演示"><span class="nav-number">2.7.</span> <span class="nav-text">2.6）中间件各函数调用过程实例演示</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1）app2-middleware-py-编写中间件-1"><span class="nav-number">2.7.1.</span> <span class="nav-text">1）app2&#x2F;middleware.py 编写中间件</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#django2-0后写法"><span class="nav-number">2.7.1.0.1.</span> <span class="nav-text">django2.0后写法</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#django2-0之前写法"><span class="nav-number">2.7.1.0.2.</span> <span class="nav-text">django2.0之前写法</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2）app2-views-py"><span class="nav-number">2.7.2.</span> <span class="nav-text">2）app2&#x2F;views.py</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3）配置settings-py"><span class="nav-number">2.7.3.</span> <span class="nav-text">3）配置settings.py</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#效果：http-127-0-0-1-8000-index"><span class="nav-number">2.7.4.</span> <span class="nav-text">效果：http:&#x2F;&#x2F;127.0.0.1:8000&#x2F;index&#x2F;</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-正常运行（把首页截断不运行）"><span class="nav-number">2.7.4.0.1.</span> <span class="nav-text">1. 正常运行（把首页截断不运行）</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-如果把process-request解除注释（后面步骤截断）"><span class="nav-number">2.7.4.0.2.</span> <span class="nav-text">2. 如果把process_request解除注释（后面步骤截断）</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-如果这两个函数都注释掉："><span class="nav-number">2.7.4.0.3.</span> <span class="nav-text">3. 如果这两个函数都注释掉：</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-6）发生异常的中间件"><span class="nav-number">2.8.</span> <span class="nav-text">2.6）发生异常的中间件</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1）app2-middleware-py-编写异常处理中间件"><span class="nav-number">2.8.1.</span> <span class="nav-text">1）app2&#x2F;middleware.py 编写异常处理中间件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2）注册中间件settings-py"><span class="nav-number">2.8.2.</span> <span class="nav-text">2）注册中间件settings.py</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3）写一个错误到视图函数app2-views-py"><span class="nav-number">2.8.3.</span> <span class="nav-text">3）写一个错误到视图函数app2&#x2F;views.py</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#效果：http-127-0-0-1-8000-index-1"><span class="nav-number">2.8.4.</span> <span class="nav-text">效果：http:&#x2F;&#x2F;127.0.0.1:8000&#x2F;index&#x2F;</span></a></li></ol></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="晨曦"
      src="http://www.zeyajt.com/u/40b74ddb-a87b-41cd-821b-3f6eeb544661/image/637203952121373129.jpg">
  <p class="site-author-name" itemprop="name">晨曦</p>
  <div class="site-description" itemprop="description">晨曦的技术博客，专注于python、vue、react、人工智能、爬虫、大数据分析</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/blog/archives/">
        
          <span class="site-state-item-count">97</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/blog/categories/">
          
        <span class="site-state-item-count">15</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/blog/tags/">
          
        <span class="site-state-item-count">9</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">晨曦</span>
</div>

        








      </div>
    </footer>
  </div>

  
  <script src="/blog/lib/anime.min.js"></script>
  <script src="/blog/lib/velocity/velocity.min.js"></script>
  <script src="/blog/lib/velocity/velocity.ui.min.js"></script>

<script src="/blog/js/utils.js"></script>

<script src="/blog/js/motion.js"></script>


<script src="/blog/js/schemes/pisces.js"></script>


<script src="/blog/js/next-boot.js"></script>




  















  

  


 
</body>
</html>
