<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"chenxi188.github.io","root":"/","scheme":"Gemini","version":"7.7.2","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="详情请点阅读全文">
<meta property="og:type" content="article">
<meta property="og:title" content="《React后台管理系统实战：五》产品管理（四）：产品修改、接收商品列表传过来的商品数据、显示商品分类、显示图片、显示对应详情">
<meta property="og:url" content="https://chenxi188.github.io/2020/03/10/%E3%80%8AReact%E5%90%8E%E5%8F%B0%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E5%AE%9E%E6%88%98%EF%BC%9A%E4%BA%94%E3%80%8B%E4%BA%A7%E5%93%81%E7%AE%A1%E7%90%86%EF%BC%88%E5%9B%9B%EF%BC%89%EF%BC%9A%E4%BA%A7%E5%93%81%E4%BF%AE%E6%94%B9%E3%80%81%E6%8E%A5%E6%94%B6%E5%95%86%E5%93%81%E5%88%97%E8%A1%A8%E4%BC%A0%E8%BF%87%E6%9D%A5%E7%9A%84%E5%95%86%E5%93%81%E6%95%B0%E6%8D%AE%E3%80%81%E6%98%BE%E7%A4%BA%E5%95%86%E5%93%81%E5%88%86%E7%B1%BB%E3%80%81%E6%98%BE%E7%A4%BA%E5%9B%BE%E7%89%87%E3%80%81%E6%98%BE%E7%A4%BA%E5%AF%B9%E5%BA%94%E8%AF%A6%E6%83%85/index.html">
<meta property="og:site_name" content="晨曦的博客">
<meta property="og:description" content="详情请点阅读全文">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20200309222408165.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTAxMzIxNzc=,size_16,color_FFFFFF,t_70">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20200309223127187.png">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20200309230703842.png">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20200310115159278.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTAxMzIxNzc=,size_16,color_FFFFFF,t_70">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20200310123449949.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTAxMzIxNzc=,size_16,color_FFFFFF,t_70">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20200310131703499.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTAxMzIxNzc=,size_16,color_FFFFFF,t_70">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20200310132143112.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTAxMzIxNzc=,size_16,color_FFFFFF,t_70">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20200310132332484.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTAxMzIxNzc=,size_16,color_FFFFFF,t_70">
<meta property="article:published_time" content="2020-03-10T05:25:11.000Z">
<meta property="article:modified_time" content="2020-03-23T02:37:01.266Z">
<meta property="article:author" content="晨曦">
<meta property="article:tag" content="python">
<meta property="article:tag" content="vue">
<meta property="article:tag" content="react">
<meta property="article:tag" content="AI">
<meta property="article:tag" content="人工智能">
<meta property="article:tag" content="爬虫">
<meta property="article:tag" content="大数据分析">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://img-blog.csdnimg.cn/20200309222408165.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTAxMzIxNzc=,size_16,color_FFFFFF,t_70">

<link rel="canonical" href="https://chenxi188.github.io/2020/03/10/%E3%80%8AReact%E5%90%8E%E5%8F%B0%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E5%AE%9E%E6%88%98%EF%BC%9A%E4%BA%94%E3%80%8B%E4%BA%A7%E5%93%81%E7%AE%A1%E7%90%86%EF%BC%88%E5%9B%9B%EF%BC%89%EF%BC%9A%E4%BA%A7%E5%93%81%E4%BF%AE%E6%94%B9%E3%80%81%E6%8E%A5%E6%94%B6%E5%95%86%E5%93%81%E5%88%97%E8%A1%A8%E4%BC%A0%E8%BF%87%E6%9D%A5%E7%9A%84%E5%95%86%E5%93%81%E6%95%B0%E6%8D%AE%E3%80%81%E6%98%BE%E7%A4%BA%E5%95%86%E5%93%81%E5%88%86%E7%B1%BB%E3%80%81%E6%98%BE%E7%A4%BA%E5%9B%BE%E7%89%87%E3%80%81%E6%98%BE%E7%A4%BA%E5%AF%B9%E5%BA%94%E8%AF%A6%E6%83%85/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>《React后台管理系统实战：五》产品管理（四）：产品修改、接收商品列表传过来的商品数据、显示商品分类、显示图片、显示对应详情 | 晨曦的博客</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">晨曦的博客</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">技术博客</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i>关于</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>分类</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>标签</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block " lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://chenxi188.github.io/2020/03/10/%E3%80%8AReact%E5%90%8E%E5%8F%B0%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E5%AE%9E%E6%88%98%EF%BC%9A%E4%BA%94%E3%80%8B%E4%BA%A7%E5%93%81%E7%AE%A1%E7%90%86%EF%BC%88%E5%9B%9B%EF%BC%89%EF%BC%9A%E4%BA%A7%E5%93%81%E4%BF%AE%E6%94%B9%E3%80%81%E6%8E%A5%E6%94%B6%E5%95%86%E5%93%81%E5%88%97%E8%A1%A8%E4%BC%A0%E8%BF%87%E6%9D%A5%E7%9A%84%E5%95%86%E5%93%81%E6%95%B0%E6%8D%AE%E3%80%81%E6%98%BE%E7%A4%BA%E5%95%86%E5%93%81%E5%88%86%E7%B1%BB%E3%80%81%E6%98%BE%E7%A4%BA%E5%9B%BE%E7%89%87%E3%80%81%E6%98%BE%E7%A4%BA%E5%AF%B9%E5%BA%94%E8%AF%A6%E6%83%85/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="http://www.zeyajt.com/u/40b74ddb-a87b-41cd-821b-3f6eeb544661/image/637203952121373129.jpg">
      <meta itemprop="name" content="晨曦">
      <meta itemprop="description" content="晨曦的技术博客，专注于python、vue、react、人工智能、爬虫、大数据分析">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="晨曦的博客">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          《React后台管理系统实战：五》产品管理（四）：产品修改、接收商品列表传过来的商品数据、显示商品分类、显示图片、显示对应详情
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-03-10 13:25:11" itemprop="dateCreated datePublished" datetime="2020-03-10T13:25:11+08:00">2020-03-10</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-03-23 10:37:01" itemprop="dateModified" datetime="2020-03-23T10:37:01+08:00">2020-03-23</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%89%8D%E7%AB%AF/" itemprop="url" rel="index"><span itemprop="name">前端</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%89%8D%E7%AB%AF/React/" itemprop="url" rel="index"><span itemprop="name">React</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>详情请点阅读全文 </p>
<a id="more"></a>

<h1 id="一、点修改按钮传值给修改商品页"><a href="#一、点修改按钮传值给修改商品页" class="headerlink" title="一、点修改按钮传值给修改商品页"></a>一、点修改按钮传值给修改商品页</h1><h2 id="1-传当前产品对象给add-update组件页home-jsx"><a href="#1-传当前产品对象给add-update组件页home-jsx" class="headerlink" title="1.传当前产品对象给add-update组件页home.jsx"></a>1.传当前产品对象给add-update组件页home.jsx</h2><p>【1】传列表页当前产品对象给add-update组件页面：<code>onClick={()=&gt;this.props.history.push(&#39;/product/add-update&#39;,proObj)}</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">                width:<span class="number">100</span>,</span><br><span class="line">                title:<span class="string">'操作'</span>,</span><br><span class="line">                </span><br><span class="line">                render:<span class="function">(<span class="params">proObj</span>)=&gt;</span>&#123;<span class="comment">//proObj当前商品对象</span></span><br><span class="line">                    <span class="keyword">return</span>(</span><br><span class="line">                        &lt;span&gt;</span><br><span class="line">                            &#123;<span class="comment">/*【1】将product对象使用state传递给目标路由组件*/</span>&#125;</span><br><span class="line">                            &lt;LinkButton onClick=&#123;()=&gt;<span class="keyword">this</span>.props.history.push(<span class="string">'/product/detail'</span>,&#123;proObj&#125;)&#125;&gt;详情&lt;<span class="regexp">/LinkButton&gt;</span></span><br><span class="line"><span class="regexp">                            &lt;LinkButton onClick=&#123;()=&gt;this.props.history.push('/</span>product/add-update<span class="string">',proObj)&#125;&gt;修改&lt;/LinkButton&gt;</span></span><br><span class="line"><span class="string">                        &lt;/span&gt;</span></span><br><span class="line"><span class="string">                    )</span></span><br><span class="line"><span class="string">                &#125;</span></span><br><span class="line"><span class="string">            &#125;,</span></span><br></pre></td></tr></table></figure>
<h1 id="二、接收传过来的商品对象-add-update-jsx"><a href="#二、接收传过来的商品对象-add-update-jsx" class="headerlink" title="二、接收传过来的商品对象 add-update.jsx"></a>二、接收传过来的商品对象 add-update.jsx</h1><h2 id="1-接收传过来的数据，并进行数据的处理"><a href="#1-接收传过来的数据，并进行数据的处理" class="headerlink" title="1.接收传过来的数据，并进行数据的处理"></a>1.接收传过来的数据，并进行数据的处理</h2><p><img src="https://img-blog.csdnimg.cn/20200309222408165.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTAxMzIxNzc=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">componentWillMount()&#123;</span><br><span class="line">        <span class="comment">//【1】取出产品列表修改按钮传过来的state</span></span><br><span class="line">        <span class="keyword">const</span> product=<span class="keyword">this</span>.props.location.state <span class="comment">//如果是添加的就没有值，否则就有值</span></span><br><span class="line">        <span class="comment">//【2】少用state，此处保存是否更新标识到this</span></span><br><span class="line">        <span class="keyword">this</span>.isUpdate=!!product <span class="comment">//双取反,若product有值，结果为ture</span></span><br><span class="line">        <span class="comment">//【3】少用state，保存商品对象到this（如果没有，则保存空对象）</span></span><br><span class="line">        <span class="keyword">this</span>.product=product || &#123;&#125; <span class="comment">//防止添加商品时，展示数据的initialValue:product.name报错undefiend</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h2 id="3-解构数据，确定当前页面名（修改商品-添加商品）add-update-jsx"><a href="#3-解构数据，确定当前页面名（修改商品-添加商品）add-update-jsx" class="headerlink" title="3.解构数据，确定当前页面名（修改商品 | 添加商品）add-update.jsx"></a>3.解构数据，确定当前页面名（修改商品 | 添加商品）add-update.jsx</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//render下return前</span></span><br><span class="line"><span class="comment">//【4】解构需要的数据</span></span><br><span class="line">        <span class="keyword">const</span> &#123;isUpdate,product&#125;=<span class="keyword">this</span></span><br><span class="line">        <span class="keyword">const</span>&#123;pCategoryId,categoryId,imgs,detail&#125;=product</span><br><span class="line"></span><br><span class="line">        <span class="comment">//card左</span></span><br><span class="line">        <span class="keyword">const</span> title=(</span><br><span class="line">            &lt;span&gt;</span><br><span class="line">                &lt;LinkButton onClick=&#123;()=&gt;<span class="keyword">this</span>.props.history.goBack()&#125;&gt;</span><br><span class="line">                    &lt;Icon type=<span class="string">'arrow-left'</span> style=&#123;&#123;<span class="attr">fontSize</span>:<span class="number">20</span>&#125;&#125; /&gt;                   </span><br><span class="line">                &lt;<span class="regexp">/LinkButton&gt;</span></span><br><span class="line"><span class="regexp">                &#123;/</span>* 【<span class="number">5</span>】根据值确定显示内容 *<span class="regexp">/&#125;</span></span><br><span class="line"><span class="regexp">                &lt;span&gt;&#123;isUpdate?'修改商品':'添加商品'&#125;&lt;/</span>span&gt;</span><br><span class="line">            &lt;<span class="regexp">/span&gt;</span></span><br><span class="line"><span class="regexp">        )</span></span><br></pre></td></tr></table></figure>
<h3 id="效果："><a href="#效果：" class="headerlink" title="效果："></a>效果：</h3><p><img src="https://img-blog.csdnimg.cn/20200309223127187.png" alt="在这里插入图片描述"></p>
<h1 id="三、显示商品对应分类"><a href="#三、显示商品对应分类" class="headerlink" title="三、显示商品对应分类"></a>三、显示商品对应分类</h1><h2 id="1-商品分类显示解决1"><a href="#1-商品分类显示解决1" class="headerlink" title="1.商品分类显示解决1"></a>1.商品分类显示解决1</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//render之下return前</span></span><br><span class="line"><span class="comment">//【分类0】</span></span><br><span class="line"><span class="keyword">const</span>&#123;pCategoryId,categoryId&#125;=product</span><br><span class="line">        <span class="comment">// 【分类2】初始值定义</span></span><br><span class="line">        <span class="keyword">const</span> categoryIds=[]</span><br><span class="line">        <span class="comment">//【分类3】如果是一个一级分类商品，则把分类id直接装入数组</span></span><br><span class="line">        <span class="keyword">if</span>(pCategoryId===<span class="string">'0'</span>)&#123;</span><br><span class="line">            categoryIds.push(categoryId)</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;<span class="comment">//【分类4】否则商品是一个二级分类的商品，把两级分类id都装入数组          </span></span><br><span class="line">        categoryIds.push(pCategoryId)</span><br><span class="line">        categoryIds.push(categoryId)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//return内</span></span><br><span class="line">&lt;Item label=<span class="string">"商品分类"</span>&gt;</span><br><span class="line">    &#123;<span class="comment">//【分类1】初始值设置为一个变量</span></span><br><span class="line">    getFieldDecorator(<span class="string">'categoryIds'</span>, &#123;</span><br><span class="line">        initialValue: categoryIds,</span><br><span class="line">        rules: [</span><br><span class="line">        &#123;<span class="attr">required</span>: <span class="literal">true</span>, <span class="attr">message</span>: <span class="string">'必须指定商品分类'</span>&#125;,</span><br><span class="line">        ]</span><br><span class="line">    &#125;)(<span class="xml"><span class="tag">&lt;<span class="name">Cascader</span></span></span></span><br><span class="line"><span class="xml">        placeholder='请指定商品分类'</span></span><br><span class="line"><span class="xml">        options=&#123;this.state.options&#125;  /*需要显示的列表数据数组*/</span></span><br><span class="line"><span class="xml">        loadData=&#123;this.loadData&#125; /*当选择某个列表项, 加载下一级列表的监听回调*/</span></span><br><span class="line"><span class="xml">        /&gt;</span></span><br><span class="line">    )</span><br><span class="line">    &#125;</span><br><span class="line"> &lt;<span class="regexp">/Item&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="初步效果：仅能显示一级分类，二级分类不显示"><a href="#初步效果：仅能显示一级分类，二级分类不显示" class="headerlink" title="初步效果：仅能显示一级分类，二级分类不显示"></a>初步效果：仅能显示一级分类，二级分类不显示</h3><p><img src="https://img-blog.csdnimg.cn/20200309230703842.png" alt="在这里插入图片描述"></p>
<h2 id="2-商品分类显示2级分类"><a href="#2-商品分类显示2级分类" class="headerlink" title="2.商品分类显示2级分类"></a>2.商品分类显示2级分类</h2><p>【1-6】</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//把获取到的categorys解析为options</span></span><br><span class="line">    initOptions= <span class="keyword">async</span> (categorys)=&gt;&#123; <span class="comment">//【3】</span></span><br><span class="line">        <span class="keyword">const</span> options = categorys.map(<span class="function">(<span class="params">v,k</span>)=&gt;</span>(&#123; <span class="comment">//返回一个字典，要额外加一个括号            </span></span><br><span class="line">                value: v._id,</span><br><span class="line">                label: v.name,</span><br><span class="line">                isLeaf: <span class="literal">false</span>,             </span><br><span class="line">        &#125;))</span><br><span class="line"></span><br><span class="line">    <span class="comment">//【1】如果是一个二级分类商品的更新一</span></span><br><span class="line">    <span class="keyword">const</span> &#123;isUpdate, product&#125; = <span class="keyword">this</span></span><br><span class="line">    <span class="keyword">const</span> &#123;pCategoryId&#125; = product</span><br><span class="line">    <span class="keyword">if</span>(isUpdate &amp;&amp; pCategoryId!==<span class="string">'0'</span>) &#123;<span class="comment">//当前功能是商品修改，且，一级分类不为0（父分类为0即表示只有一级分类）</span></span><br><span class="line">      <span class="comment">//【2】获取对应的二级分类列表</span></span><br><span class="line">      <span class="keyword">const</span> subCategorys = <span class="keyword">await</span> <span class="keyword">this</span>.getCategorys(pCategoryId)</span><br><span class="line">      <span class="comment">//【4】生成二级下拉列表的options</span></span><br><span class="line">      <span class="keyword">const</span> childOptions = subCategorys.map(<span class="function"><span class="params">c</span> =&gt;</span> (&#123;</span><br><span class="line">        value: c._id,</span><br><span class="line">        label: c.name,</span><br><span class="line">        isLeaf: <span class="literal">true</span></span><br><span class="line">      &#125;))</span><br><span class="line"></span><br><span class="line">      <span class="comment">//【5】找到当前商品对应的一级option对象</span></span><br><span class="line">      <span class="keyword">const</span> targetOption = options.find(<span class="function"><span class="params">option</span> =&gt;</span> option.value===pCategoryId)</span><br><span class="line"></span><br><span class="line">      <span class="comment">//【6】关联对应的一级option上</span></span><br><span class="line">      targetOption.children = childOptions</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">            options</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//获取categorys</span></span><br><span class="line">    getCategorys= <span class="keyword">async</span> (parentId)=&gt;&#123;</span><br><span class="line">        <span class="keyword">const</span> result = <span class="keyword">await</span> reqCategorys(parentId)</span><br><span class="line">        <span class="keyword">if</span>(result.status===<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">const</span> categorys = result.data</span><br><span class="line">            <span class="comment">// 如果是一级分类列表</span></span><br><span class="line">            <span class="keyword">if</span> (parentId===<span class="string">'0'</span>) &#123;</span><br><span class="line">                <span class="keyword">this</span>.initOptions(categorys)</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123; <span class="comment">// 二级列表</span></span><br><span class="line">                <span class="keyword">return</span> categorys  <span class="comment">// 返回二级列表 ==&gt; 当前async函数返回的promsie就会成功且value为categorys</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            message.error(<span class="string">'产品分类获取失败请刷新重试'</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h3 id="效果：-1"><a href="#效果：-1" class="headerlink" title="效果："></a>效果：</h3><p><img src="https://img-blog.csdnimg.cn/20200310115159278.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTAxMzIxNzc=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h1 id="三、显示图片"><a href="#三、显示图片" class="headerlink" title="三、显示图片"></a>三、显示图片</h1><h2 id="1-解析出要传递给图片显示组件的数据add-update-jsx"><a href="#1-解析出要传递给图片显示组件的数据add-update-jsx" class="headerlink" title="1.解析出要传递给图片显示组件的数据add-update.jsx"></a>1.解析出要传递给图片显示组件的数据add-update.jsx</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//【1】解构需要的数据imgs</span></span><br><span class="line"><span class="keyword">const</span> &#123;isUpdate,product&#125;=<span class="keyword">this</span></span><br><span class="line"><span class="keyword">const</span>&#123;pCategoryId,categoryId,imgs,detail&#125;=product</span><br></pre></td></tr></table></figure>
<h2 id="2-传递数据以属性格式给子组件add-update-jsx"><a href="#2-传递数据以属性格式给子组件add-update-jsx" class="headerlink" title="2.传递数据以属性格式给子组件add-update.jsx"></a>2.传递数据以属性格式给子组件add-update.jsx</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;Item label=<span class="string">'商品图片'</span>&gt;</span><br><span class="line">     &#123;<span class="comment">/* 【2】imgs传给子组件 PicturesWall */</span>&#125;</span><br><span class="line">     &lt;PicturesWall ref=&#123;<span class="keyword">this</span>.pw&#125; imgs=&#123;imgs&#125; /&gt;</span><br><span class="line"> &lt;<span class="regexp">/Item&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="3-pictures-wall-jsx接收传过来的图片属性"><a href="#3-pictures-wall-jsx接收传过来的图片属性" class="headerlink" title="3.pictures-wall.jsx接收传过来的图片属性"></a>3.pictures-wall.jsx接收传过来的图片属性</h2><p>【0-5】</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;BASE_IMG_URL&#125; <span class="keyword">from</span> <span class="string">'../../../utils/constans'</span> <span class="comment">//【0】引入基础图片上传地址即：http://localhost:5000/upload/</span></span><br><span class="line"><span class="keyword">import</span> PropTypes <span class="keyword">from</span> <span class="string">'prop-types'</span> <span class="comment">//【1】引入prop-types用于获取父组件传过来的数据</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//【2】接收父组件传过来的值 （非必须）</span></span><br><span class="line">  <span class="keyword">static</span> propTypes=&#123;</span><br><span class="line">    imgs:PropTypes.array</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">constructor</span>(props)&#123;</span><br><span class="line">    <span class="keyword">super</span>(props)</span><br><span class="line">    <span class="comment">//【3】定义fileList为空</span></span><br><span class="line">    <span class="keyword">let</span> fileList=[]</span><br><span class="line">    <span class="comment">//【4】如果传来了imgs属性值</span></span><br><span class="line">    <span class="keyword">const</span> &#123;imgs&#125;=<span class="keyword">this</span>.props <span class="comment">//解构imgs</span></span><br><span class="line">    <span class="keyword">if</span>(imgs &amp;&amp; imgs.length&gt;<span class="number">0</span>)&#123;<span class="comment">//imgs存在且长度大于0</span></span><br><span class="line">      fileList=imgs.map(<span class="function">(<span class="params">img,index</span>)=&gt;</span>(&#123;<span class="comment">//定义一个对象要额外加个括号</span></span><br><span class="line">        uid: -index, <span class="comment">// 每个file都有自己唯一的id</span></span><br><span class="line">        name: img, <span class="comment">// 图片文件名</span></span><br><span class="line">        status: <span class="string">'done'</span>, <span class="comment">// 图片状态: done-已上传, uploading: 正在上传中, removed: 已删除</span></span><br><span class="line">        url: BASE_IMG_URL + img</span><br><span class="line">      &#125;))</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>.state=&#123;</span><br><span class="line">      previewVisible: <span class="literal">false</span>,</span><br><span class="line">      previewImage: <span class="string">''</span>,</span><br><span class="line">      fileList <span class="comment">//【5】</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<h3 id="效果：已自动加载对应图"><a href="#效果：已自动加载对应图" class="headerlink" title="效果：已自动加载对应图"></a>效果：已自动加载对应图</h3><p><img src="https://img-blog.csdnimg.cn/20200310123449949.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTAxMzIxNzc=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h1 id="四、显示商品对应商品详情"><a href="#四、显示商品对应商品详情" class="headerlink" title="四、显示商品对应商品详情"></a>四、显示商品对应商品详情</h1><h2 id="1-add-update-jsx解析及传值给子组件"><a href="#1-add-update-jsx解析及传值给子组件" class="headerlink" title="1.add-update.jsx解析及传值给子组件"></a>1.add-update.jsx解析及传值给子组件</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//【1】render下return上解构需要的数据detail</span></span><br><span class="line"><span class="keyword">const</span> &#123;isUpdate,product&#125;=<span class="keyword">this</span></span><br><span class="line"><span class="keyword">const</span>&#123;pCategoryId,categoryId,imgs,detail&#125;=product</span><br><span class="line"></span><br><span class="line">&lt;Item label=<span class="string">'商品详情'</span> labelCol=&#123;&#123;<span class="attr">span</span>: <span class="number">2</span>&#125;&#125; wrapperCol=&#123;&#123;<span class="attr">span</span>: <span class="number">20</span>&#125;&#125;&gt;</span><br><span class="line">    &#123;<span class="comment">/**指定把richtext对象装进editor里 </span></span><br><span class="line"><span class="comment">     * 【2】传detail给子组件RichText</span></span><br><span class="line"><span class="comment">    */</span>&#125;</span><br><span class="line">    &lt;RichText ref=&#123;<span class="keyword">this</span>.editor&#125; detail=&#123;detail&#125; /&gt;</span><br><span class="line">&lt;<span class="regexp">/Item&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="2-rich-text-jsx接收传过来的值"><a href="#2-rich-text-jsx接收传过来的值" class="headerlink" title="2.rich-text.jsx接收传过来的值"></a>2.rich-text.jsx接收传过来的值</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> PropTypes <span class="keyword">from</span> <span class="string">'prop-types'</span> <span class="comment">//【1】引入proptypes用于接收父组件传值</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//【2】接收父组件传值</span></span><br><span class="line">  <span class="keyword">static</span> propTypes=&#123;</span><br><span class="line">    detail:PropTypes.string</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<h2 id="3-显示传过来的html"><a href="#3-显示传过来的html" class="headerlink" title="3.显示传过来的html"></a>3.显示传过来的html</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; EditorState, convertToRaw,ContentState &#125; <span class="keyword">from</span> <span class="string">'draft-js'</span>; <span class="comment">//【1】引入ContentState</span></span><br><span class="line"><span class="keyword">import</span> htmlToDraft <span class="keyword">from</span> <span class="string">'html-to-draftjs'</span>; <span class="comment">//【2】显示现有html需要组件</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//【3】rich-text官网拉到底找到把现成的代码来修改，字符串显示到富文本编辑框内</span></span><br><span class="line">  <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">    <span class="keyword">super</span>(props)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> html = <span class="keyword">this</span>.props.detail <span class="comment">//解构出传过来的detail内的html数据</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (html) &#123; <span class="comment">// 【4】html如果有值, 根据html格式字符串创建一个对应的编辑对象</span></span><br><span class="line">      <span class="keyword">const</span> contentBlock = htmlToDraft(html)</span><br><span class="line">      <span class="keyword">const</span> contentState = ContentState.createFromBlockArray(contentBlock.contentBlocks)</span><br><span class="line">      <span class="keyword">const</span> editorState = EditorState.createWithContent(contentState)</span><br><span class="line">      <span class="keyword">this</span>.state = &#123;</span><br><span class="line">        editorState,</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;<span class="comment">//【5】没有则让富文本框创建空对象</span></span><br><span class="line">      <span class="keyword">this</span>.state = &#123;</span><br><span class="line">        editorState: EditorState.createEmpty(), <span class="comment">// 创建一个没有内容的编辑对象</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<h3 id="效果：点修改自动加载对应商品详情内容"><a href="#效果：点修改自动加载对应商品详情内容" class="headerlink" title="效果：点修改自动加载对应商品详情内容"></a>效果：点修改自动加载对应商品详情内容</h3><p><img src="https://img-blog.csdnimg.cn/20200310131703499.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTAxMzIxNzc=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h1 id="五、附：商品修改功能完整代码"><a href="#五、附：商品修改功能完整代码" class="headerlink" title="五、附：商品修改功能完整代码"></a>五、附：商品修改功能完整代码</h1><h2 id="1-home-jsx"><a href="#1-home-jsx" class="headerlink" title="1.home.jsx"></a>1.home.jsx</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React,&#123;Component&#125; <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">    Card,</span><br><span class="line">    Select,</span><br><span class="line">    Input,</span><br><span class="line">    Table,</span><br><span class="line">    Icon,</span><br><span class="line">    Button,</span><br><span class="line">    message</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">'antd'</span></span><br><span class="line"><span class="keyword">import</span> LinkButton <span class="keyword">from</span> <span class="string">'../../../components/link-button'</span></span><br><span class="line"><span class="keyword">import</span> &#123;reqProducts,reqSearchProducts,reqUpdateStatus&#125; <span class="keyword">from</span> <span class="string">'../../../api/'</span> <span class="comment">//引入入api请求函数</span></span><br><span class="line"><span class="keyword">import</span> &#123;PAGE_SIZE&#125; <span class="keyword">from</span> <span class="string">'../../../utils/constans'</span> <span class="comment">//引入常量每页显示产品条数PAGE_SIZE=3</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Option=Select.Option</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">Home</span> <span class="keyword">extends</span> <span class="title">Component</span></span>&#123;</span><br><span class="line">    state=&#123;</span><br><span class="line">        <span class="comment">//商品列表</span></span><br><span class="line">        total:<span class="number">0</span>,<span class="comment">//商品总数</span></span><br><span class="line">        products:[], </span><br><span class="line">        loading:<span class="literal">false</span>,</span><br><span class="line">        searchName:<span class="string">''</span>, <span class="comment">//搜索关键词</span></span><br><span class="line">        searchType:<span class="string">'productName'</span>, <span class="comment">//按什么搜索：名称/描述 productName/productDesc</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//【6】更新商品上下架状态</span></span><br><span class="line">    updateStatus = <span class="keyword">async</span> (productId,status)=&gt;&#123;</span><br><span class="line">        <span class="keyword">const</span> result=<span class="keyword">await</span> reqUpdateStatus(productId,status)</span><br><span class="line">        <span class="keyword">if</span>(result.status===<span class="number">0</span>)&#123;</span><br><span class="line">            message.success(<span class="string">'商品上下架状态更新成功'</span>)</span><br><span class="line">            <span class="comment">//【8】更新成功后重新获取正确的商品分页此时传入的页码来源于7步存入的页码</span></span><br><span class="line">            <span class="keyword">this</span>.getProducts(<span class="keyword">this</span>.pageNum)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//Table的列名及对应显示的内容渲染</span></span><br><span class="line">    initColumns=<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.columns=[</span><br><span class="line">            &#123;</span><br><span class="line">                title:<span class="string">'商品名称'</span>,</span><br><span class="line">                dataIndex:<span class="string">'name'</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                title:<span class="string">'商品描述'</span>,</span><br><span class="line">                dataIndex:<span class="string">'desc'</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                title:<span class="string">'价格'</span>,</span><br><span class="line">                dataIndex:<span class="string">'price'</span>,</span><br><span class="line">                render:<span class="function">(<span class="params">price</span>)=&gt;</span><span class="string">'￥'</span>+price <span class="comment">//把price渲染进对应的行，并加上￥符号</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                width:<span class="number">100</span>,</span><br><span class="line">                title:<span class="string">'商品状态'</span>,</span><br><span class="line">                <span class="comment">//dataIndex:'status',//【1】注释掉</span></span><br><span class="line">                render:<span class="function">(<span class="params">proObj</span>)=&gt;</span>&#123;<span class="comment">//【2】传入当前的商品对象</span></span><br><span class="line">                    <span class="keyword">const</span> &#123;_id,status&#125;=proObj <span class="comment">//【3】解构商品id和status</span></span><br><span class="line">                    <span class="keyword">const</span> newStatus=status===<span class="number">1</span>?<span class="number">2</span>:<span class="number">1</span><span class="comment">//【4】把商品的状态2换1，1换2</span></span><br><span class="line">                    <span class="keyword">return</span>(</span><br><span class="line">                        &lt;span&gt;</span><br><span class="line">                            &lt;Button </span><br><span class="line">                            type=<span class="string">'primary'</span> </span><br><span class="line">                            <span class="comment">/*【5】调用更新状态函数把当前商品id及要更新的状态传过去*/</span></span><br><span class="line">                            onClick=&#123;()=&gt;<span class="keyword">this</span>.updateStatus(_id,newStatus)&#125;&gt;</span><br><span class="line">                                &#123;status===<span class="number">1</span> ? <span class="string">'下架'</span> : <span class="string">'上架'</span>&#125;&lt;<span class="regexp">/Button&gt;</span></span><br><span class="line"><span class="regexp">                            &lt;span&gt;&#123;status===1 ? '在售':'已下架'&#125;&lt;/</span>span&gt;</span><br><span class="line">                        &lt;<span class="regexp">/span&gt;</span></span><br><span class="line"><span class="regexp">                    )</span></span><br><span class="line"><span class="regexp">                &#125;</span></span><br><span class="line"><span class="regexp">            &#125;,</span></span><br><span class="line"><span class="regexp">            &#123;</span></span><br><span class="line"><span class="regexp">                width:100,</span></span><br><span class="line"><span class="regexp">                title:'操作',</span></span><br><span class="line"><span class="regexp">                </span></span><br><span class="line"><span class="regexp">                render:(proObj)=&gt;&#123;/</span><span class="regexp">/proObj当前商品对象</span></span><br><span class="line"><span class="regexp">                    return(</span></span><br><span class="line"><span class="regexp">                        &lt;span&gt;</span></span><br><span class="line"><span class="regexp">                            &#123;/</span>*将product对象使用state传递给目标路由组件*<span class="regexp">/&#125;</span></span><br><span class="line"><span class="regexp">                            &lt;LinkButton onClick=&#123;()=&gt;this.props.history.push('/</span>product/detail<span class="string">',&#123;proObj&#125;)&#125;&gt;详情&lt;/LinkButton&gt;</span></span><br><span class="line"><span class="string">                            &lt;LinkButton onClick=&#123;()=&gt;this.props.history.push('</span>/product/add-update<span class="string">',proObj)&#125;&gt;修改&lt;/LinkButton&gt;</span></span><br><span class="line"><span class="string">                        &lt;/span&gt;</span></span><br><span class="line"><span class="string">                    )</span></span><br><span class="line"><span class="string">                &#125;</span></span><br><span class="line"><span class="string">            &#125;,</span></span><br><span class="line"><span class="string">        ]</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    //请求产品列表放入state，后台分页</span></span><br><span class="line"><span class="string">    getProducts=async(pageNum)=&gt;&#123;//pageNum为请求页码</span></span><br><span class="line"><span class="string">        this.setState(&#123;loading:true&#125;) //设置加载动画开始显示</span></span><br><span class="line"><span class="string">        this.pageNum=pageNum //【7】保存pageNum, 让其它方法可以看到</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        const &#123;searchName,searchType&#125;=this.state  //</span></span><br><span class="line"><span class="string">        let result //有两个result因此把result提出来定义</span></span><br><span class="line"><span class="string">        if(searchName)&#123;//如果有搜索关键词就是关键词搜索，易错pageSize:PAGE_SIZE</span></span><br><span class="line"><span class="string">            result=await reqSearchProducts(&#123;pageNum,pageSize:PAGE_SIZE,searchType,searchName&#125;)</span></span><br><span class="line"><span class="string">        &#125;else&#123;//否则就是一般搜索</span></span><br><span class="line"><span class="string">            result = await reqProducts(pageNum,PAGE_SIZE) // 常量：每页显示产品条数，</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">        this.setState(&#123;loading:false&#125;) //关闭加载动画</span></span><br><span class="line"><span class="string">        if(result.status===0)&#123;</span></span><br><span class="line"><span class="string">            console.log(result.data)</span></span><br><span class="line"><span class="string">            const &#123;total,list&#125;=result.data          </span></span><br><span class="line"><span class="string">            this.setState(&#123;</span></span><br><span class="line"><span class="string">                total,</span></span><br><span class="line"><span class="string">                products:list</span></span><br><span class="line"><span class="string">            &#125;)</span></span><br><span class="line"><span class="string">        &#125;else&#123;</span></span><br><span class="line"><span class="string">            message.error('</span>加载产品失败，请刷新页面重试<span class="string">')</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    componentWillMount()&#123;</span></span><br><span class="line"><span class="string">        //Table列名初始化函数调用，用于准备表格列名及显示内容</span></span><br><span class="line"><span class="string">        this.initColumns()</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    //获取产品</span></span><br><span class="line"><span class="string">    componentDidMount()&#123;</span></span><br><span class="line"><span class="string">        this.getProducts(1)       </span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    render()&#123;</span></span><br><span class="line"><span class="string">        //state数据解构，简化使用</span></span><br><span class="line"><span class="string">        const &#123;products,loading,total,searchName,searchType&#125;=this.state</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        //card左侧内容</span></span><br><span class="line"><span class="string">        const title=(</span></span><br><span class="line"><span class="string">            &lt;span&gt;</span></span><br><span class="line"><span class="string">                &lt;Select </span></span><br><span class="line"><span class="string">                value=&#123;searchType&#125; /**/</span></span><br><span class="line"><span class="string">                style=&#123;&#123;width:150,&#125;&#125; </span></span><br><span class="line"><span class="string">                onChange=&#123;value=&gt;this.setState(&#123;searchType:value&#125;)&#125;/**/</span></span><br><span class="line"><span class="string">                &gt;</span></span><br><span class="line"><span class="string">                    &lt;Option value='</span>productName<span class="string">'&gt;按名称搜索&lt;/Option&gt;</span></span><br><span class="line"><span class="string">                    &lt;Option value='</span>productDesc<span class="string">'&gt;按描述搜索&lt;/Option&gt;</span></span><br><span class="line"><span class="string">                &lt;/Select&gt;</span></span><br><span class="line"><span class="string">                &lt;Input placeholder='</span>关键字<span class="string">' style=&#123;&#123;width:150,margin:'</span><span class="number">0</span> <span class="number">8</span>px<span class="string">'&#125;&#125; </span></span><br><span class="line"><span class="string">                value=&#123;searchName&#125;/**/</span></span><br><span class="line"><span class="string">                onChange=&#123;event=&gt;this.setState(&#123;searchName:event.target.value&#125;)&#125;/**/</span></span><br><span class="line"><span class="string">                 /&gt;</span></span><br><span class="line"><span class="string">                &lt;Button type='</span>primary<span class="string">'</span></span><br><span class="line"><span class="string">                onClick=&#123;()=&gt;this.getProducts(1)&#125; //点击搜索对应产品</span></span><br><span class="line"><span class="string">                &gt;搜索&lt;/Button&gt;</span></span><br><span class="line"><span class="string">            &lt;/span&gt;</span></span><br><span class="line"><span class="string">        )</span></span><br><span class="line"><span class="string">        //card右侧内容</span></span><br><span class="line"><span class="string">        const extra=(</span></span><br><span class="line"><span class="string">            &lt;Button type='</span>primary<span class="string">' onClick=&#123;() =&gt; this.props.history.push('</span>/product/add-update<span class="string">')&#125;&gt;</span></span><br><span class="line"><span class="string">                &lt;Icon type='</span>plus<span class="string">'/&gt;</span></span><br><span class="line"><span class="string">                添加商品</span></span><br><span class="line"><span class="string">            &lt;/Button&gt;</span></span><br><span class="line"><span class="string">        )</span></span><br><span class="line"><span class="string">        return(</span></span><br><span class="line"><span class="string">            &lt;Card title=&#123;title&#125; extra=&#123;extra&#125;&gt;</span></span><br><span class="line"><span class="string">                &lt;Table </span></span><br><span class="line"><span class="string">                bordered </span></span><br><span class="line"><span class="string">                rowKey='</span>_id<span class="string">'</span></span><br><span class="line"><span class="string">                dataSource=&#123;products&#125;</span></span><br><span class="line"><span class="string">                loading=&#123;loading&#125;</span></span><br><span class="line"><span class="string">                columns=&#123;this.columns&#125;</span></span><br><span class="line"><span class="string">                pagination=&#123;&#123;/*分页配置*/</span></span><br><span class="line"><span class="string">                    current: this.pageNum,</span></span><br><span class="line"><span class="string">                    total,</span></span><br><span class="line"><span class="string">                    defaultPageSize: PAGE_SIZE,</span></span><br><span class="line"><span class="string">                    showQuickJumper: true,</span></span><br><span class="line"><span class="string">                    onChange: this.getProducts /*onchange是一回调函数，把pageNum传给getproducts,等于：(pageNum)=&gt;&#123;this.getProducts(pageNum)&#125;*/</span></span><br><span class="line"><span class="string">                &#125;&#125; </span></span><br><span class="line"><span class="string">                /&gt;</span></span><br><span class="line"><span class="string">                </span></span><br><span class="line"><span class="string">            &lt;/Card&gt;</span></span><br><span class="line"><span class="string">        )</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure>
<h2 id="2-add-update-jsx"><a href="#2-add-update-jsx" class="headerlink" title="2.add-update.jsx"></a>2.add-update.jsx</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React,&#123;Component&#125; <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">    Card,</span><br><span class="line">    Icon,</span><br><span class="line">    Form,</span><br><span class="line">    Input,</span><br><span class="line">    Cascader,<span class="comment">//级联组件</span></span><br><span class="line">    Button,</span><br><span class="line">    message,</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">'antd'</span></span><br><span class="line"><span class="keyword">import</span> LinkButton <span class="keyword">from</span> <span class="string">'../../../components/link-button'</span></span><br><span class="line"><span class="keyword">import</span> &#123;reqCategorys,reqAddUpdatePro&#125; <span class="keyword">from</span> <span class="string">'../../../api'</span> <span class="comment">//引入添加修改产品函数</span></span><br><span class="line"><span class="keyword">import</span> PicturesWall <span class="keyword">from</span> <span class="string">'./pictures-wall'</span></span><br><span class="line"><span class="keyword">import</span> RichText <span class="keyword">from</span> <span class="string">'./rich-text'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123;Item&#125;=Form</span><br><span class="line"><span class="keyword">const</span> &#123;TextArea&#125;=Input</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AddUpdate</span> <span class="keyword">extends</span> <span class="title">Component</span></span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(props)&#123;</span><br><span class="line">        <span class="keyword">super</span>(props)</span><br><span class="line">        <span class="comment">//创建用于存放指定ref标识的标签对象容器</span></span><br><span class="line">        <span class="keyword">this</span>.pw=React.createRef()</span><br><span class="line">        <span class="comment">//</span></span><br><span class="line">        <span class="keyword">this</span>.editor=React.createRef()</span><br><span class="line"></span><br><span class="line">       <span class="keyword">this</span>.state=&#123;</span><br><span class="line">        options:[], <span class="comment">//定义状态选项</span></span><br><span class="line">        &#125; </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    <span class="comment">//把获取到的categorys解析为options</span></span><br><span class="line">    initOptions= <span class="keyword">async</span> (categorys)=&gt;&#123; <span class="comment">//</span></span><br><span class="line">        <span class="keyword">const</span> options = categorys.map(<span class="function">(<span class="params">v,k</span>)=&gt;</span>(&#123; <span class="comment">//返回一个字典，要额外加一个括号            </span></span><br><span class="line">                value: v._id,</span><br><span class="line">                label: v.name,</span><br><span class="line">                isLeaf: <span class="literal">false</span>,             </span><br><span class="line">        &#125;))</span><br><span class="line"></span><br><span class="line">    <span class="comment">//如果是一个二级分类商品的更新一</span></span><br><span class="line">    <span class="keyword">const</span> &#123;isUpdate, product&#125; = <span class="keyword">this</span></span><br><span class="line">    <span class="keyword">const</span> &#123;pCategoryId&#125; = product</span><br><span class="line">    <span class="keyword">if</span>(isUpdate &amp;&amp; pCategoryId!==<span class="string">'0'</span>) &#123;<span class="comment">//当前功能是商品修改，且，一级分类不为0（父分类为0即表示只有一级分类）</span></span><br><span class="line">      <span class="comment">//获取对应的二级分类列表</span></span><br><span class="line">      <span class="keyword">const</span> subCategorys = <span class="keyword">await</span> <span class="keyword">this</span>.getCategorys(pCategoryId)</span><br><span class="line">      <span class="comment">//生成二级下拉列表的options</span></span><br><span class="line">      <span class="keyword">const</span> childOptions = subCategorys.map(<span class="function"><span class="params">c</span> =&gt;</span> (&#123;</span><br><span class="line">        value: c._id,</span><br><span class="line">        label: c.name,</span><br><span class="line">        isLeaf: <span class="literal">true</span></span><br><span class="line">      &#125;))</span><br><span class="line"></span><br><span class="line">      <span class="comment">//找到当前商品对应的一级option对象</span></span><br><span class="line">      <span class="keyword">const</span> targetOption = options.find(<span class="function"><span class="params">option</span> =&gt;</span> option.value===pCategoryId)</span><br><span class="line"></span><br><span class="line">      <span class="comment">//关联对应的一级option上</span></span><br><span class="line">      targetOption.children = childOptions</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">            options</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//获取categorys</span></span><br><span class="line">    getCategorys= <span class="keyword">async</span> (parentId)=&gt;&#123;</span><br><span class="line">        <span class="keyword">const</span> result = <span class="keyword">await</span> reqCategorys(parentId)</span><br><span class="line">        <span class="keyword">if</span>(result.status===<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">const</span> categorys = result.data</span><br><span class="line">            <span class="comment">// 如果是一级分类列表</span></span><br><span class="line">            <span class="keyword">if</span> (parentId===<span class="string">'0'</span>) &#123;</span><br><span class="line">                <span class="keyword">this</span>.initOptions(categorys)</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123; <span class="comment">// 二级列表</span></span><br><span class="line">                <span class="keyword">return</span> categorys  <span class="comment">// 返回二级列表 ==&gt; 当前async函数返回的promsie就会成功且value为categorys</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            message.error(<span class="string">'产品分类获取失败请刷新重试'</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//自定义验证：商品价格大于0函数</span></span><br><span class="line">    valiPrice=<span class="function">(<span class="params">rule, value, callback</span>)=&gt;</span>&#123;</span><br><span class="line">        <span class="comment">//console.log(value,typeof(value))  //在价格输入-1即显示是string类型</span></span><br><span class="line">        <span class="keyword">if</span>(value*<span class="number">1</span>&gt;<span class="number">0</span>)&#123; <span class="comment">//字符串*1：将字符串转化为数字类型</span></span><br><span class="line">             callback()</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            callback(<span class="string">'价格必须大于0'</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    onChange = <span class="function">(<span class="params">value, selectedOptions</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(value, selectedOptions);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      </span><br><span class="line">    <span class="comment">//加载二级分类列表函数</span></span><br><span class="line">    loadData = <span class="keyword">async</span> selectedOptions =&gt; &#123;</span><br><span class="line">        <span class="keyword">const</span> targetOption = selectedOptions[<span class="number">0</span>];</span><br><span class="line">        targetOption.loading = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 根据选中的分类, 请求获取二级分类列表</span></span><br><span class="line">        <span class="keyword">const</span> subCategorys = <span class="keyword">await</span> <span class="keyword">this</span>.getCategorys(targetOption.value)</span><br><span class="line">        <span class="comment">// 隐藏loading</span></span><br><span class="line">        targetOption.loading = <span class="literal">false</span></span><br><span class="line">        <span class="comment">// 二级分类数组有数据</span></span><br><span class="line">        <span class="keyword">if</span> (subCategorys &amp;&amp; subCategorys.length&gt;<span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">// 生成一个二级列表的options</span></span><br><span class="line">        <span class="keyword">const</span> childOptions = subCategorys.map(<span class="function"><span class="params">c</span> =&gt;</span> (&#123;</span><br><span class="line">            value: c._id,</span><br><span class="line">            label: c.name,</span><br><span class="line">            isLeaf: <span class="literal">true</span></span><br><span class="line">        &#125;))</span><br><span class="line">        <span class="comment">// 关联到当前option上</span></span><br><span class="line">        targetOption.children = childOptions</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123; <span class="comment">// 当前选中的分类没有二级分类</span></span><br><span class="line">            targetOption.isLeaf = <span class="literal">true</span></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 更新options状态</span></span><br><span class="line">            <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">                options: [...this.state.options],</span><br><span class="line">            &#125;)        </span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//产品表单提交</span></span><br><span class="line">     submit=<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.props.form.validateFields(<span class="keyword">async</span>(error,values)=&gt;&#123;</span><br><span class="line">            </span><br><span class="line">                       </span><br><span class="line">            <span class="keyword">if</span>(!error)&#123;</span><br><span class="line">                <span class="comment">//收集数据, 并封装成product对象</span></span><br><span class="line">                <span class="keyword">const</span> &#123;name,desc,price,categoryIds&#125;=values</span><br><span class="line">                <span class="keyword">let</span> pCategoryId,categoryId</span><br><span class="line">                <span class="keyword">if</span>(categoryIds.length===<span class="number">1</span>)&#123;<span class="comment">//如果长度为1说明只有一级产品分类</span></span><br><span class="line">                    pCategoryId=<span class="string">'0'</span></span><br><span class="line">                    categoryId=categoryIds[<span class="number">0</span>]</span><br><span class="line">                &#125;<span class="keyword">else</span>&#123;<span class="comment">//否则说明有二级产品分类</span></span><br><span class="line">                    pCategoryId=categoryIds[<span class="number">0</span>] </span><br><span class="line">                    categoryId=categoryIds[<span class="number">1</span>]</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">//获取子组件的相关信息</span></span><br><span class="line">                <span class="keyword">const</span> imgs=<span class="keyword">this</span>.pw.current.getImgs()  </span><br><span class="line">                <span class="comment">//获取子组件商品详情的带html标签的字符串数据</span></span><br><span class="line">                <span class="keyword">const</span> detail=<span class="keyword">this</span>.editor.current.getDetail()       </span><br><span class="line">               </span><br><span class="line">                <span class="keyword">const</span> product=&#123;name,desc,price,imgs,detail,pCategoryId,categoryId&#125;</span><br><span class="line">                <span class="comment">//输出看看</span></span><br><span class="line">                <span class="built_in">console</span>.log(product)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                <span class="comment">//调用接口请求函数去添加/更新</span></span><br><span class="line">                <span class="keyword">const</span> result=<span class="keyword">await</span> reqAddUpdatePro(product)</span><br><span class="line">                <span class="keyword">if</span>(result.status===<span class="number">0</span>)&#123;<span class="comment">//根据结果提示是否添加/更新成功</span></span><br><span class="line">                    message.success(<span class="string">'添加产品成功'</span>)</span><br><span class="line">                &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                    message.error(<span class="string">'添加产品失败'</span>)</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;                </span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">'验证失败，请检查产品数据'</span>)</span><br><span class="line">            &#125;   </span><br><span class="line">            </span><br><span class="line">            </span><br><span class="line">        &#125;)    </span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    componentWillMount()&#123;</span><br><span class="line">        <span class="comment">//取出产品列表修改按钮传过来的state</span></span><br><span class="line">        <span class="keyword">const</span> product=<span class="keyword">this</span>.props.location.state <span class="comment">//如果是添加的就没有值，否则就有值</span></span><br><span class="line">        <span class="comment">//保存是否更新标识到this</span></span><br><span class="line">        <span class="keyword">this</span>.isUpdate=!!product <span class="comment">//双取反,若product有值，结果为ture</span></span><br><span class="line">        <span class="comment">//保存商品到this（如果没有，则保存空对象）</span></span><br><span class="line">        <span class="keyword">this</span>.product=product || &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">      </span><br><span class="line">    componentDidMount()&#123;</span><br><span class="line">        <span class="keyword">this</span>.getCategorys(<span class="string">'0'</span>) <span class="comment">//加载categorys并初始化为</span></span><br><span class="line">    &#125;</span><br><span class="line">      </span><br><span class="line">    render()&#123;</span><br><span class="line">        <span class="comment">//【1】解构需要的数据detail</span></span><br><span class="line">        <span class="keyword">const</span> &#123;isUpdate,product&#125;=<span class="keyword">this</span></span><br><span class="line">        <span class="keyword">const</span>&#123;pCategoryId,categoryId,imgs,detail&#125;=product</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 初始值定义</span></span><br><span class="line">        <span class="keyword">const</span> categoryIds=[]</span><br><span class="line">        <span class="comment">//如果是一个一级分类商品，则把分类id直接装入数组</span></span><br><span class="line">        <span class="keyword">if</span>(pCategoryId===<span class="string">'0'</span>)&#123;</span><br><span class="line">            categoryIds.push(categoryId)</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;<span class="comment">//否则商品是一个二级分类的商品，把两级分类id都装入数组          </span></span><br><span class="line">        categoryIds.push(pCategoryId)</span><br><span class="line">        categoryIds.push(categoryId)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//card左</span></span><br><span class="line">        <span class="keyword">const</span> title=(</span><br><span class="line">            &lt;span&gt;</span><br><span class="line">                &lt;LinkButton onClick=&#123;()=&gt;<span class="keyword">this</span>.props.history.goBack()&#125;&gt;</span><br><span class="line">                    &lt;Icon type=<span class="string">'arrow-left'</span> style=&#123;&#123;<span class="attr">fontSize</span>:<span class="number">20</span>&#125;&#125; /&gt;                   </span><br><span class="line">                &lt;<span class="regexp">/LinkButton&gt;</span></span><br><span class="line"><span class="regexp">                &#123;/</span>* 根据值确定显示内容 *<span class="regexp">/&#125;</span></span><br><span class="line"><span class="regexp">                &lt;span&gt;&#123;isUpdate?'修改商品':'添加商品'&#125;&lt;/</span>span&gt;</span><br><span class="line">            &lt;<span class="regexp">/span&gt;</span></span><br><span class="line"><span class="regexp">        )</span></span><br><span class="line"><span class="regexp">        </span></span><br><span class="line"><span class="regexp">        /</span><span class="regexp">/form内的Item的布局样式</span></span><br><span class="line"><span class="regexp">        const formItemLayout = &#123;</span></span><br><span class="line"><span class="regexp">            labelCol: &#123;span: 2&#125;, /</span><span class="regexp">/左侧label标签的宽度占2个格栅</span></span><br><span class="line"><span class="regexp">            wrapperCol: &#123;span: 8 &#125;, /</span><span class="regexp">/右侧（输入框外面有一层包裹）占8个格栅</span></span><br><span class="line"><span class="regexp">          &#125;;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">        /</span><span class="regexp">/获取from的getFieldDecorator</span></span><br><span class="line"><span class="regexp">        const &#123;getFieldDecorator&#125;=this.props.form</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">        </span></span><br><span class="line"><span class="regexp">        </span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">        return(</span></span><br><span class="line"><span class="regexp">            &lt;Card title=&#123;title&#125; extra=''&gt;</span></span><br><span class="line"><span class="regexp">                &#123;/</span>* 使用组件的扩展属性语法 *<span class="regexp">/&#125;</span></span><br><span class="line"><span class="regexp">                &lt;Form &#123;...formItemLayout&#125;&gt;</span></span><br><span class="line"><span class="regexp">                    &#123;/</span>* label指定商品前面标签名,placeholder指定输入框提示内容 *<span class="regexp">/&#125;</span></span><br><span class="line"><span class="regexp">                    &lt;Item label='商品名称'&gt;</span></span><br><span class="line"><span class="regexp">                        &#123;/</span><span class="regexp">/商品名规则</span></span><br><span class="line"><span class="regexp">                            getFieldDecorator('name',&#123;</span></span><br><span class="line"><span class="regexp">                                initialValue:product.name,/</span><span class="regexp">/显示要修改的商品名</span></span><br><span class="line"><span class="regexp">                                rules:[</span></span><br><span class="line"><span class="regexp">                                    &#123;required:true,message:'商品名称必须填写'&#125;</span></span><br><span class="line"><span class="regexp">                                ]</span></span><br><span class="line"><span class="regexp">                            &#125;)(&lt;Input  placeholder='输入商品名' /</span>&gt;)</span><br><span class="line">                        &#125;</span><br><span class="line">                        </span><br><span class="line">                    &lt;<span class="regexp">/Item&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">                    &lt;Item label='商品描述'&gt;</span></span><br><span class="line"><span class="regexp">                        &#123;/</span><span class="regexp">/autoSize指定文本域最小高度和最大高度</span></span><br><span class="line"><span class="regexp">                            getFieldDecorator('desc',&#123;</span></span><br><span class="line"><span class="regexp">                                initialValue:product.desc, /</span><span class="regexp">/</span></span><br><span class="line"><span class="regexp">                                rules:[</span></span><br><span class="line"><span class="regexp">                                    &#123;required:true,message:'商品描述必须输入'&#125;</span></span><br><span class="line"><span class="regexp">                                ]</span></span><br><span class="line"><span class="regexp">                            &#125;)(&lt;TextArea placeholder='输入商品描述' autoSize=&#123;&#123; minRows: 2, maxRows: 6 &#125;&#125; /</span>&gt;)</span><br><span class="line">                        &#125;                       </span><br><span class="line">                    &lt;<span class="regexp">/Item&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">                    &lt;Item label='商品价格'&gt;</span></span><br><span class="line"><span class="regexp">                        &#123;/</span><span class="regexp">/validator自定义验证规则要求价格大于0</span></span><br><span class="line"><span class="regexp">                            getFieldDecorator('price',&#123;</span></span><br><span class="line"><span class="regexp">                                initialValue:product.price, /</span><span class="regexp">/</span></span><br><span class="line"><span class="regexp">                                rules:[</span></span><br><span class="line"><span class="regexp">                                    &#123;required:true,message:'价格必须输入'&#125;,</span></span><br><span class="line"><span class="regexp">                                    &#123;validator:(rule,value,callback)=&gt;&#123;</span></span><br><span class="line"><span class="regexp">                                        if(value*1&gt;0)&#123; //字符串*1：将字符串转化为数字类型</span></span><br><span class="line"><span class="regexp">                                            callback() //此处必须进行回调函数调用，否则将无法通过验证</span></span><br><span class="line"><span class="regexp">                                       &#125;else&#123;</span></span><br><span class="line"><span class="regexp">                                           callback('价格必须大于0')</span></span><br><span class="line"><span class="regexp">                                       &#125;</span></span><br><span class="line"><span class="regexp">                                    &#125;&#125;,</span></span><br><span class="line"><span class="regexp">                                ]</span></span><br><span class="line"><span class="regexp">                            &#125;)(&lt;Input type='number' placeholder='输入商品价格' addonAfter="元" /</span>&gt;)</span><br><span class="line">                        &#125;                        </span><br><span class="line">                    &lt;<span class="regexp">/Item&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">                    &lt;Item label="商品分类"&gt;</span></span><br><span class="line"><span class="regexp">                        &#123;/</span><span class="regexp">/初始值设置为一个变量</span></span><br><span class="line"><span class="regexp">                        getFieldDecorator('categoryIds', &#123;</span></span><br><span class="line"><span class="regexp">                            initialValue: categoryIds,</span></span><br><span class="line"><span class="regexp">                            rules: [</span></span><br><span class="line"><span class="regexp">                            &#123;required: true, message: '必须指定商品分类'&#125;,</span></span><br><span class="line"><span class="regexp">                            ]</span></span><br><span class="line"><span class="regexp">                        &#125;)(&lt;Cascader</span></span><br><span class="line"><span class="regexp">                            placeholder='请指定商品分类'</span></span><br><span class="line"><span class="regexp">                            options=&#123;this.state.options&#125;  /</span>*需要显示的列表数据数组*<span class="regexp">/</span></span><br><span class="line"><span class="regexp">                            loadData=&#123;this.loadData&#125; /</span>*当选择某个列表项, 加载下一级列表的监听回调*<span class="regexp">/</span></span><br><span class="line"><span class="regexp">                            /</span>&gt;</span><br><span class="line">                        )</span><br><span class="line">                        &#125;</span><br><span class="line"></span><br><span class="line">                    &lt;<span class="regexp">/Item&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">                    &lt;Item label='商品图片'&gt;</span></span><br><span class="line"><span class="regexp">                        &#123;/</span>* imgs传给子组件 PicturesWall *<span class="regexp">/&#125;</span></span><br><span class="line"><span class="regexp">                        &lt;PicturesWall ref=&#123;this.pw&#125; imgs=&#123;imgs&#125; /</span>&gt;</span><br><span class="line">                    &lt;<span class="regexp">/Item&gt; </span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">                    &lt;Item label='商品详情' labelCol=&#123;&#123;span: 2&#125;&#125; wrapperCol=&#123;&#123;span: 20&#125;&#125;&gt;</span></span><br><span class="line"><span class="regexp">                        &#123;/</span>**指定把richtext对象装进editor里 </span><br><span class="line">                         * 【<span class="number">2</span>】传detail给子组件RichText</span><br><span class="line">                        *<span class="regexp">/&#125;</span></span><br><span class="line"><span class="regexp">                        &lt;RichText ref=&#123;this.editor&#125; detail=&#123;detail&#125; /</span>&gt;</span><br><span class="line">                    &lt;<span class="regexp">/Item&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">                    &lt;Item &gt;</span></span><br><span class="line"><span class="regexp">                        &lt;Button type='primary' onClick=&#123;this.submit&#125;&gt;提交&lt;/</span>Button&gt;</span><br><span class="line">                    &lt;<span class="regexp">/Item&gt;  </span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">                &lt;/</span>Form&gt;</span><br><span class="line">            &lt;<span class="regexp">/Card&gt;</span></span><br><span class="line"><span class="regexp">        )</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp">export default Form.create()(AddUpdate) /</span><span class="regexp">/包装当前类使得到form的的强大函数</span></span><br></pre></td></tr></table></figure>
<h2 id="3-pictures-wall-jsx"><a href="#3-pictures-wall-jsx" class="headerlink" title="3.pictures-wall.jsx"></a>3.pictures-wall.jsx</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React,&#123;Component&#125; <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">import</span> &#123; Upload, Icon, Modal,message &#125; <span class="keyword">from</span> <span class="string">'antd'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;reqDeletPic&#125; <span class="keyword">from</span> <span class="string">'../../../api'</span> <span class="comment">//删除图片api</span></span><br><span class="line"><span class="keyword">import</span> &#123;BASE_IMG_URL&#125; <span class="keyword">from</span> <span class="string">'../../../utils/constans'</span> <span class="comment">//【0】引入基础图片上传地址即：http://localhost:5000/upload/</span></span><br><span class="line"><span class="keyword">import</span> PropTypes <span class="keyword">from</span> <span class="string">'prop-types'</span> <span class="comment">//【1】引入prop-types用于获取父组件传过来的数据</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getBase64</span>(<span class="params">file</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> reader = <span class="keyword">new</span> FileReader();</span><br><span class="line">    reader.readAsDataURL(file);</span><br><span class="line">    reader.onload = <span class="function"><span class="params">()</span> =&gt;</span> resolve(reader.result);</span><br><span class="line">    reader.onerror = <span class="function"><span class="params">error</span> =&gt;</span> reject(error);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">PicturesWall</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="comment">//【2】接收父组件传过来的值 （非必须）</span></span><br><span class="line">  <span class="keyword">static</span> propTypes=&#123;</span><br><span class="line">    imgs:PropTypes.array</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/*&#123;fileList: [       </span></span><br><span class="line"><span class="comment">        uid: '-1', // 每个file都有自己唯一的id</span></span><br><span class="line"><span class="comment">        name: 'xxx.png', // 图片文件名</span></span><br><span class="line"><span class="comment">        status: 'done', // 图片状态: done-已上传, uploading: 正在上传中, removed: 已删除</span></span><br><span class="line"><span class="comment">        url: 'https://zos.alipayobjects.com/rmsportal/jkjgkEfvpUPVyRjUImniVslZfWPnJuuZ.png', // 图片地址</span></span><br><span class="line"><span class="comment">      &#125;,</span></span><br><span class="line"><span class="comment">      ]*/</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">constructor</span>(props)&#123;</span><br><span class="line">    <span class="keyword">super</span>(props)</span><br><span class="line"></span><br><span class="line">    <span class="comment">//【3】定义fileList</span></span><br><span class="line">    <span class="keyword">let</span> fileList=[]</span><br><span class="line">    <span class="comment">//【4】如果传来了imgs属性值</span></span><br><span class="line">    <span class="keyword">const</span> &#123;imgs&#125;=<span class="keyword">this</span>.props <span class="comment">//解构imgs</span></span><br><span class="line">    <span class="keyword">if</span>(imgs &amp;&amp; imgs.length&gt;<span class="number">0</span>)&#123;<span class="comment">//imgs存在且长度大于0</span></span><br><span class="line">      fileList=imgs.map(<span class="function">(<span class="params">img,index</span>)=&gt;</span>(&#123;<span class="comment">//定义一个对象要额外加个括号</span></span><br><span class="line">        uid: -index, <span class="comment">// 每个file都有自己唯一的id</span></span><br><span class="line">        name: img, <span class="comment">// 图片文件名</span></span><br><span class="line">        status: <span class="string">'done'</span>, <span class="comment">// 图片状态: done-已上传, uploading: 正在上传中, removed: 已删除</span></span><br><span class="line">        url: BASE_IMG_URL + img</span><br><span class="line">      &#125;))</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>.state=&#123;</span><br><span class="line">      previewVisible: <span class="literal">false</span>,</span><br><span class="line">      previewImage: <span class="string">''</span>,</span><br><span class="line">      fileList</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">  获取所有已上传图片文件名的数组</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  getImgs  = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">//返回状态中的文件列表中每个文件的文件名</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.state.fileList.map(<span class="function"><span class="params">file</span> =&gt;</span> file.name)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// state = &#123;</span></span><br><span class="line">  <span class="comment">//   previewVisible: false,</span></span><br><span class="line">  <span class="comment">//   previewImage: '',</span></span><br><span class="line">  <span class="comment">//   fileList: [</span></span><br><span class="line">  <span class="comment">//   //   &#123;</span></span><br><span class="line">  <span class="comment">//   //     uid: '-1',</span></span><br><span class="line">  <span class="comment">//   //     name: 'image.png',</span></span><br><span class="line">  <span class="comment">//   //     status: 'done',</span></span><br><span class="line">  <span class="comment">//   //     url: 'https://zos.alipayobjects.com/rmsportal/jkjgkEfvpUPVyRjUImniVslZfWPnJuuZ.png',</span></span><br><span class="line">  <span class="comment">//   //   &#125;</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">//    ],</span></span><br><span class="line">  <span class="comment">// &#125;;</span></span><br><span class="line"></span><br><span class="line">  handleCancel = <span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">this</span>.setState(&#123; <span class="attr">previewVisible</span>: <span class="literal">false</span> &#125;);</span><br><span class="line"></span><br><span class="line">  handlePreview = <span class="keyword">async</span> file =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (!file.url &amp;&amp; !file.preview) &#123;</span><br><span class="line">      file.preview = <span class="keyword">await</span> getBase64(file.originFileObj);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">      previewImage: file.url || file.preview,</span><br><span class="line">      previewVisible: <span class="literal">true</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">  file: 当前操作的图片文件(上传/删除)</span></span><br><span class="line"><span class="comment">  fileList: 所有已上传图片文件对象的数组</span></span><br><span class="line"><span class="comment">  官方文档：https://ant.design/components/upload-cn/#onChange</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  handleChange = <span class="keyword">async</span> (&#123; file,fileList &#125;) =&gt; &#123; <span class="comment">//async</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'handlechange:'</span>,file.status, fileList.length, file===fileList[fileList.length<span class="number">-1</span>])</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 一旦上传成功, 将当前上传的file的信息修正成最新的(name, url)</span></span><br><span class="line">    <span class="keyword">if</span>(file.status===<span class="string">'done'</span>)&#123;</span><br><span class="line">      <span class="keyword">const</span> result = file.response  <span class="comment">// &#123;status: 0, data: &#123;name: 'xxx.jpg', url: '图片地址'&#125;&#125;</span></span><br><span class="line">      <span class="keyword">if</span>(result.status===<span class="number">0</span>)&#123;</span><br><span class="line">        message.success(<span class="string">'上传成功'</span>)</span><br><span class="line">        <span class="keyword">const</span> &#123;name, url&#125; = result.data</span><br><span class="line">        file = fileList[fileList.length<span class="number">-1</span>]</span><br><span class="line">        file.name = name</span><br><span class="line">        file.url = url           </span><br><span class="line">      &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">      message.error(<span class="string">'上传错误'</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span>(file.status===<span class="string">'removed'</span>)&#123;<span class="comment">//如果文件的状态为移除，则删除服务器上对应图片名图片</span></span><br><span class="line">      <span class="keyword">const</span> result=<span class="keyword">await</span> reqDeletPic(file.name)</span><br><span class="line">      <span class="keyword">if</span>(result.status===<span class="number">0</span>)&#123;</span><br><span class="line">        message.success(<span class="string">'图片删除成功：'</span>+file.name)</span><br><span class="line">      &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        message.error(<span class="string">'图片删除失败：'</span>+file.name)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 在操作(上传/删除)过程中不断更新fileList状态</span></span><br><span class="line">    <span class="keyword">this</span>.setState(&#123; fileList &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; previewVisible, previewImage, fileList &#125; = <span class="keyword">this</span>.state;</span><br><span class="line">    <span class="keyword">const</span> uploadButton = (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;Icon type=<span class="string">"plus"</span> /&gt;</span><br><span class="line">        &lt;div className=<span class="string">"ant-upload-text"</span>&gt;Upload&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>div&gt;</span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div className=<span class="string">"clearfix"</span>&gt;</span><br><span class="line">        &lt;Upload</span><br><span class="line">          action=<span class="string">"/manage/img/upload"</span> <span class="comment">/**上传图片的接口地址 */</span></span><br><span class="line">          accept=<span class="string">'image/*'</span>  <span class="comment">/**只接受图片格式 */</span></span><br><span class="line">          name=<span class="string">'image'</span> <span class="comment">/**请求参数名，来自api说明上传图片的参数类型 */</span></span><br><span class="line">          listType=<span class="string">"picture-card"</span> <span class="comment">/*卡片样式：text, picture 和 picture-card*/</span></span><br><span class="line">          fileList=&#123;fileList&#125; <span class="comment">/*所有已上传图片文件对象的数组*/</span></span><br><span class="line">          onPreview=&#123;<span class="keyword">this</span>.handlePreview&#125; <span class="comment">/**显示图片预览函数 */</span></span><br><span class="line">          onChange=&#123;<span class="keyword">this</span>.handleChange&#125; <span class="comment">/**上传/删除图片函数 */</span></span><br><span class="line">        &gt;</span><br><span class="line">          &#123;<span class="comment">//控制图片上传按钮最多5个</span></span><br><span class="line">          fileList.length &gt;= <span class="number">5</span> ? <span class="literal">null</span> : uploadButton&#125;</span><br><span class="line">        &lt;<span class="regexp">/Upload&gt;</span></span><br><span class="line"><span class="regexp">        &lt;Modal visible=&#123;previewVisible&#125; footer=&#123;null&#125; onCancel=&#123;this.handleCancel&#125;&gt;</span></span><br><span class="line"><span class="regexp">          &lt;img alt="example" style=&#123;&#123; width: '100%' &#125;&#125; src=&#123;previewImage&#125; /</span>&gt;</span><br><span class="line">        &lt;<span class="regexp">/Modal&gt;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>div&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="4-rich-text-jsx"><a href="#4-rich-text-jsx" class="headerlink" title="4.rich-text.jsx"></a>4.rich-text.jsx</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; EditorState, convertToRaw,ContentState &#125; <span class="keyword">from</span> <span class="string">'draft-js'</span>; <span class="comment">//【3】引入ContentState</span></span><br><span class="line"><span class="keyword">import</span> &#123; Editor &#125; <span class="keyword">from</span> <span class="string">'react-draft-wysiwyg'</span>;</span><br><span class="line"><span class="keyword">import</span> draftToHtml <span class="keyword">from</span> <span class="string">'draftjs-to-html'</span>;</span><br><span class="line"><span class="keyword">import</span> htmlToDraft <span class="keyword">from</span> <span class="string">'html-to-draftjs'</span>; <span class="comment">//【0】显示现有html需要组件</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">'react-draft-wysiwyg/dist/react-draft-wysiwyg.css'</span> <span class="comment">//引入编辑器样式，否则会乱七八糟</span></span><br><span class="line"><span class="keyword">import</span> PropTypes <span class="keyword">from</span> <span class="string">'prop-types'</span> <span class="comment">//【1】引入proptypes用于接收父组件传值</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">RichText</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="comment">//【2】接收父组件传值</span></span><br><span class="line">  <span class="keyword">static</span> propTypes=&#123;</span><br><span class="line">    detail:PropTypes.string</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  state = &#123;</span><br><span class="line">    editorState: EditorState.createEmpty(),</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//【4】rich-text官网拉到底找到把现成的字符串显示到富文本编辑框内</span></span><br><span class="line">  <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">    <span class="keyword">super</span>(props)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> html = <span class="keyword">this</span>.props.detail <span class="comment">//解构出传过来的detail内的html数据</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (html) &#123; <span class="comment">// 【5】html如果有值, 根据html格式字符串创建一个对应的编辑对象</span></span><br><span class="line">      <span class="keyword">const</span> contentBlock = htmlToDraft(html)</span><br><span class="line">      <span class="keyword">const</span> contentState = ContentState.createFromBlockArray(contentBlock.contentBlocks)</span><br><span class="line">      <span class="keyword">const</span> editorState = EditorState.createWithContent(contentState)</span><br><span class="line">      <span class="keyword">this</span>.state = &#123;</span><br><span class="line">        editorState,</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;<span class="comment">//【6】没有则让富文本框创建空对象</span></span><br><span class="line">      <span class="keyword">this</span>.state = &#123;</span><br><span class="line">        editorState: EditorState.createEmpty(), <span class="comment">// 创建一个没有内容的编辑对象</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  onEditorStateChange=<span class="function">(<span class="params">editorState</span>) =&gt;</span> &#123; <span class="comment">//标签写法改成如左写法</span></span><br><span class="line">    <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">      editorState,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line"> <span class="comment">//让父组件获取到当前组件的信息</span></span><br><span class="line"> getDetail=<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">     <span class="keyword">return</span> draftToHtml(convertToRaw(<span class="keyword">this</span>.state.editorState.getCurrentContent()))</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> <span class="comment">//【2】图片上传加一个上传按钮</span></span><br><span class="line"> uploadImageCallBack = <span class="function">(<span class="params">file</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(</span><br><span class="line">      (resolve, reject) =&gt; &#123;</span><br><span class="line">        <span class="keyword">const</span> xhr = <span class="keyword">new</span> XMLHttpRequest()</span><br><span class="line">        xhr.open(<span class="string">'POST'</span>, <span class="string">'/manage/img/upload'</span>)</span><br><span class="line">        <span class="keyword">const</span> data = <span class="keyword">new</span> FormData()</span><br><span class="line">        data.append(<span class="string">'image'</span>, file)</span><br><span class="line">        xhr.send(data)</span><br><span class="line">        xhr.addEventListener(<span class="string">'load'</span>, () =&gt; &#123;</span><br><span class="line">          <span class="keyword">const</span> response = <span class="built_in">JSON</span>.parse(xhr.responseText)</span><br><span class="line">          <span class="keyword">const</span> url = response.data.url <span class="comment">// 得到图片的url</span></span><br><span class="line">          resolve(&#123;<span class="attr">data</span>: &#123;<span class="attr">link</span>: url&#125;&#125;)</span><br><span class="line">        &#125;)</span><br><span class="line">        xhr.addEventListener(<span class="string">'error'</span>, () =&gt; &#123;</span><br><span class="line">          <span class="keyword">const</span> error = <span class="built_in">JSON</span>.parse(xhr.responseText)</span><br><span class="line">          reject(error)</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; editorState &#125; = <span class="keyword">this</span>.state;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;Editor</span><br><span class="line">          editorState=&#123;editorState&#125;</span><br><span class="line">          wrapperClassName=<span class="string">"demo-wrapper"</span></span><br><span class="line">          editorClassName=<span class="string">"demo-editor"</span></span><br><span class="line">          editorStyle=&#123;&#123;<span class="attr">border</span>: <span class="string">'1px solid black'</span>, <span class="attr">minHeight</span>: <span class="number">200</span>, <span class="attr">paddingLeft</span>: <span class="number">10</span>&#125;&#125;</span><br><span class="line">          onEditorStateChange=&#123;<span class="keyword">this</span>.onEditorStateChange&#125;</span><br><span class="line">          <span class="comment">/**【1】图片上传按钮配置*/</span></span><br><span class="line">          toolbar=&#123;&#123;</span><br><span class="line">            image: &#123; <span class="attr">uploadCallback</span>: <span class="keyword">this</span>.uploadImageCallBack, <span class="attr">alt</span>: &#123; <span class="attr">present</span>: <span class="literal">true</span>, <span class="attr">mandatory</span>: <span class="literal">true</span> &#125; &#125;,</span><br><span class="line">          &#125;&#125;</span><br><span class="line">        /&gt;</span><br><span class="line">        &lt;textarea</span><br><span class="line">          disabled</span><br><span class="line">          value=&#123;draftToHtml(convertToRaw(editorState.getCurrentContent()))&#125;</span><br><span class="line">        /&gt;</span><br><span class="line">      &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    );</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure>
<h2 id="5-完成效果：点商品列表任一产品的修改按钮，显示如下"><a href="#5-完成效果：点商品列表任一产品的修改按钮，显示如下" class="headerlink" title="5.完成效果：点商品列表任一产品的修改按钮，显示如下"></a>5.完成效果：点商品列表任一产品的修改按钮，显示如下</h2><p><img src="https://img-blog.csdnimg.cn/20200310132143112.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTAxMzIxNzc=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br><img src="https://img-blog.csdnimg.cn/20200310132332484.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTAxMzIxNzc=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>

    </div>

    
    
    

      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2020/03/08/%E3%80%8AReact%E5%90%8E%E5%8F%B0%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E5%AE%9E%E6%88%98%EF%BC%9A%E4%BA%94%E3%80%8B%E4%BA%A7%E5%93%81%E7%AE%A1%E7%90%86%EF%BC%88%E4%B8%89%EF%BC%89%E5%95%86%E5%93%81%E5%88%97%E8%A1%A8%E9%A1%B5%EF%BC%88%E4%BA%A7%E5%93%81%E6%90%9C%E7%B4%A2%E5%8F%8A%E5%88%86%E9%A1%B5%EF%BC%89%E3%80%81%E5%95%86%E5%93%81%E8%AF%A6%E6%83%85%E7%BB%84%E4%BB%B6%E3%80%81%E5%95%86%E5%93%81%E4%B8%8A%E4%B8%8B%E6%9E%B6/" rel="prev" title="《React后台管理系统实战：五》产品管理（三）商品列表页（产品搜索及分页）、商品详情组件、商品上下架">
      <i class="fa fa-chevron-left"></i> 《React后台管理系统实战：五》产品管理（三）商品列表页（产品搜索及分页）、商品详情组件、商品上下架
    </a></div>
      <div class="post-nav-item">
    <a href="/2020/03/10/%E3%80%8AReact%E5%90%8E%E5%8F%B0%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E5%AE%9E%E6%88%98%EF%BC%9A%E4%BA%94%E3%80%8B%E4%BA%A7%E5%93%81%E7%AE%A1%E7%90%86%EF%BC%88%E4%BA%94%EF%BC%89%E6%8F%90%E4%BA%A4!%E4%BF%AE%E6%94%B9%20%E5%95%86%E5%93%81%EF%BC%8C%E5%8F%8A%E8%B7%B3%E8%BD%AC%E5%9B%9E%E5%95%86%E5%93%81%E5%88%97%E8%A1%A8%E9%A1%B5%E9%9D%A2------%E5%95%86%E5%93%81%E7%AE%A1%E7%90%86%E5%AE%8C%E7%BB%93/" rel="next" title="《React后台管理系统实战：五》产品管理（五）提交/修改 商品，及跳转回商品列表页面------商品管理完结">
      《React后台管理系统实战：五》产品管理（五）提交/修改 商品，及跳转回商品列表页面------商品管理完结 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  

  </div>


          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#一、点修改按钮传值给修改商品页"><span class="nav-number">1.</span> <span class="nav-text">一、点修改按钮传值给修改商品页</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-传当前产品对象给add-update组件页home-jsx"><span class="nav-number">1.1.</span> <span class="nav-text">1.传当前产品对象给add-update组件页home.jsx</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#二、接收传过来的商品对象-add-update-jsx"><span class="nav-number">2.</span> <span class="nav-text">二、接收传过来的商品对象 add-update.jsx</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-接收传过来的数据，并进行数据的处理"><span class="nav-number">2.1.</span> <span class="nav-text">1.接收传过来的数据，并进行数据的处理</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-解构数据，确定当前页面名（修改商品-添加商品）add-update-jsx"><span class="nav-number">2.2.</span> <span class="nav-text">3.解构数据，确定当前页面名（修改商品 | 添加商品）add-update.jsx</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#效果："><span class="nav-number">2.2.1.</span> <span class="nav-text">效果：</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#三、显示商品对应分类"><span class="nav-number">3.</span> <span class="nav-text">三、显示商品对应分类</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-商品分类显示解决1"><span class="nav-number">3.1.</span> <span class="nav-text">1.商品分类显示解决1</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#初步效果：仅能显示一级分类，二级分类不显示"><span class="nav-number">3.1.1.</span> <span class="nav-text">初步效果：仅能显示一级分类，二级分类不显示</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-商品分类显示2级分类"><span class="nav-number">3.2.</span> <span class="nav-text">2.商品分类显示2级分类</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#效果：-1"><span class="nav-number">3.2.1.</span> <span class="nav-text">效果：</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#三、显示图片"><span class="nav-number">4.</span> <span class="nav-text">三、显示图片</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-解析出要传递给图片显示组件的数据add-update-jsx"><span class="nav-number">4.1.</span> <span class="nav-text">1.解析出要传递给图片显示组件的数据add-update.jsx</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-传递数据以属性格式给子组件add-update-jsx"><span class="nav-number">4.2.</span> <span class="nav-text">2.传递数据以属性格式给子组件add-update.jsx</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-pictures-wall-jsx接收传过来的图片属性"><span class="nav-number">4.3.</span> <span class="nav-text">3.pictures-wall.jsx接收传过来的图片属性</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#效果：已自动加载对应图"><span class="nav-number">4.3.1.</span> <span class="nav-text">效果：已自动加载对应图</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#四、显示商品对应商品详情"><span class="nav-number">5.</span> <span class="nav-text">四、显示商品对应商品详情</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-add-update-jsx解析及传值给子组件"><span class="nav-number">5.1.</span> <span class="nav-text">1.add-update.jsx解析及传值给子组件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-rich-text-jsx接收传过来的值"><span class="nav-number">5.2.</span> <span class="nav-text">2.rich-text.jsx接收传过来的值</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-显示传过来的html"><span class="nav-number">5.3.</span> <span class="nav-text">3.显示传过来的html</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#效果：点修改自动加载对应商品详情内容"><span class="nav-number">5.3.1.</span> <span class="nav-text">效果：点修改自动加载对应商品详情内容</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#五、附：商品修改功能完整代码"><span class="nav-number">6.</span> <span class="nav-text">五、附：商品修改功能完整代码</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-home-jsx"><span class="nav-number">6.1.</span> <span class="nav-text">1.home.jsx</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-add-update-jsx"><span class="nav-number">6.2.</span> <span class="nav-text">2.add-update.jsx</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-pictures-wall-jsx"><span class="nav-number">6.3.</span> <span class="nav-text">3.pictures-wall.jsx</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-rich-text-jsx"><span class="nav-number">6.4.</span> <span class="nav-text">4.rich-text.jsx</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-完成效果：点商品列表任一产品的修改按钮，显示如下"><span class="nav-number">6.5.</span> <span class="nav-text">5.完成效果：点商品列表任一产品的修改按钮，显示如下</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="晨曦"
      src="http://www.zeyajt.com/u/40b74ddb-a87b-41cd-821b-3f6eeb544661/image/637203952121373129.jpg">
  <p class="site-author-name" itemprop="name">晨曦</p>
  <div class="site-description" itemprop="description">晨曦的技术博客，专注于python、vue、react、人工智能、爬虫、大数据分析</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">97</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">15</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">7</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">晨曦</span>
</div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  


 
</body>
</html>
