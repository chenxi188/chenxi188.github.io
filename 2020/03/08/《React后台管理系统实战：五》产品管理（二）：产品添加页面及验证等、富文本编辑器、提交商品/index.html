<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"chenxi188.github.io","root":"/","scheme":"Gemini","version":"7.7.2","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="详情请点阅读全文">
<meta property="og:type" content="article">
<meta property="og:title" content="《React后台管理系统实战：五》产品管理（二）：产品添加页面及验证等、富文本编辑器、提交商品">
<meta property="og:url" content="https://chenxi188.github.io/2020/03/08/%E3%80%8AReact%E5%90%8E%E5%8F%B0%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E5%AE%9E%E6%88%98%EF%BC%9A%E4%BA%94%E3%80%8B%E4%BA%A7%E5%93%81%E7%AE%A1%E7%90%86%EF%BC%88%E4%BA%8C%EF%BC%89%EF%BC%9A%E4%BA%A7%E5%93%81%E6%B7%BB%E5%8A%A0%E9%A1%B5%E9%9D%A2%E5%8F%8A%E9%AA%8C%E8%AF%81%E7%AD%89%E3%80%81%E5%AF%8C%E6%96%87%E6%9C%AC%E7%BC%96%E8%BE%91%E5%99%A8%E3%80%81%E6%8F%90%E4%BA%A4%E5%95%86%E5%93%81/index.html">
<meta property="og:site_name" content="晨曦的博客">
<meta property="og:description" content="详情请点阅读全文">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20200216214919909.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTAxMzIxNzc=,size_16,color_FFFFFF,t_70">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20200217135125633.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTAxMzIxNzc=,size_16,color_FFFFFF,t_70">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20200219215732924.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTAxMzIxNzc=,size_16,color_FFFFFF,t_70">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20200224170235843.png">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20200224174421569.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTAxMzIxNzc=,size_16,color_FFFFFF,t_70">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20200224215057252.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTAxMzIxNzc=,size_16,color_FFFFFF,t_70">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20200226162948529.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTAxMzIxNzc=,size_16,color_FFFFFF,t_70">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20200226163215296.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTAxMzIxNzc=,size_16,color_FFFFFF,t_70">
<meta property="article:published_time" content="2020-03-08T04:37:35.000Z">
<meta property="article:modified_time" content="2020-03-23T02:37:01.216Z">
<meta property="article:author" content="晨曦">
<meta property="article:tag" content="python">
<meta property="article:tag" content="vue">
<meta property="article:tag" content="react">
<meta property="article:tag" content="AI">
<meta property="article:tag" content="人工智能">
<meta property="article:tag" content="爬虫">
<meta property="article:tag" content="大数据分析">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://img-blog.csdnimg.cn/20200216214919909.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTAxMzIxNzc=,size_16,color_FFFFFF,t_70">

<link rel="canonical" href="https://chenxi188.github.io/2020/03/08/%E3%80%8AReact%E5%90%8E%E5%8F%B0%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E5%AE%9E%E6%88%98%EF%BC%9A%E4%BA%94%E3%80%8B%E4%BA%A7%E5%93%81%E7%AE%A1%E7%90%86%EF%BC%88%E4%BA%8C%EF%BC%89%EF%BC%9A%E4%BA%A7%E5%93%81%E6%B7%BB%E5%8A%A0%E9%A1%B5%E9%9D%A2%E5%8F%8A%E9%AA%8C%E8%AF%81%E7%AD%89%E3%80%81%E5%AF%8C%E6%96%87%E6%9C%AC%E7%BC%96%E8%BE%91%E5%99%A8%E3%80%81%E6%8F%90%E4%BA%A4%E5%95%86%E5%93%81/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>《React后台管理系统实战：五》产品管理（二）：产品添加页面及验证等、富文本编辑器、提交商品 | 晨曦的博客</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">晨曦的博客</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">技术博客</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i>关于</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>分类</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>标签</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block " lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://chenxi188.github.io/2020/03/08/%E3%80%8AReact%E5%90%8E%E5%8F%B0%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E5%AE%9E%E6%88%98%EF%BC%9A%E4%BA%94%E3%80%8B%E4%BA%A7%E5%93%81%E7%AE%A1%E7%90%86%EF%BC%88%E4%BA%8C%EF%BC%89%EF%BC%9A%E4%BA%A7%E5%93%81%E6%B7%BB%E5%8A%A0%E9%A1%B5%E9%9D%A2%E5%8F%8A%E9%AA%8C%E8%AF%81%E7%AD%89%E3%80%81%E5%AF%8C%E6%96%87%E6%9C%AC%E7%BC%96%E8%BE%91%E5%99%A8%E3%80%81%E6%8F%90%E4%BA%A4%E5%95%86%E5%93%81/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="http://www.zeyajt.com/u/40b74ddb-a87b-41cd-821b-3f6eeb544661/image/637203952121373129.jpg">
      <meta itemprop="name" content="晨曦">
      <meta itemprop="description" content="晨曦的技术博客，专注于python、vue、react、人工智能、爬虫、大数据分析">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="晨曦的博客">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          《React后台管理系统实战：五》产品管理（二）：产品添加页面及验证等、富文本编辑器、提交商品
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-03-08 12:37:35" itemprop="dateCreated datePublished" datetime="2020-03-08T12:37:35+08:00">2020-03-08</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-03-23 10:37:01" itemprop="dateModified" datetime="2020-03-23T10:37:01+08:00">2020-03-23</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%89%8D%E7%AB%AF/" itemprop="url" rel="index"><span itemprop="name">前端</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%89%8D%E7%AB%AF/React/" itemprop="url" rel="index"><span itemprop="name">React</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>详情请点阅读全文 </p>
<a id="more"></a>


<h1 id="一、产品添加基础部分"><a href="#一、产品添加基础部分" class="headerlink" title="一、产品添加基础部分"></a>一、产品添加基础部分</h1><h2 id="1-home-jsx点添加按钮动作跳转到添加商品页"><a href="#1-home-jsx点添加按钮动作跳转到添加商品页" class="headerlink" title="1 home.jsx点添加按钮动作跳转到添加商品页"></a>1 home.jsx点添加按钮动作跳转到添加商品页</h2><p>点击：<code>onClick={() =&gt; this.props.history.push(&#39;/product/add-update&#39;)}&gt;</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//card右侧内容</span></span><br><span class="line">        <span class="keyword">const</span> extra=(</span><br><span class="line">            &lt;Button type=<span class="string">'primary'</span> onClick=&#123;() =&gt; <span class="keyword">this</span>.props.history.push(<span class="string">'/product/add-update'</span>)&#125;&gt;</span><br><span class="line">                &lt;Icon type=<span class="string">'plus'</span>/&gt;</span><br><span class="line">                添加商品</span><br><span class="line">            &lt;<span class="regexp">/Button&gt;</span></span><br><span class="line"><span class="regexp">        )</span></span><br></pre></td></tr></table></figure>
<h2 id="2-静态页面-add-update-jsx"><a href="#2-静态页面-add-update-jsx" class="headerlink" title="2 静态页面 add-update.jsx"></a>2 静态页面 add-update.jsx</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React,&#123;Component&#125; <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">    Card,</span><br><span class="line">    Icon,</span><br><span class="line">    Form,</span><br><span class="line">    Input,</span><br><span class="line">    Cascader,<span class="comment">//级联组件</span></span><br><span class="line">    Upload, <span class="comment">//上传组件</span></span><br><span class="line">    Button,</span><br><span class="line">    message,</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">'antd'</span></span><br><span class="line"><span class="keyword">import</span> LinkButton <span class="keyword">from</span> <span class="string">'../../../components/link-button'</span></span><br><span class="line"><span class="keyword">const</span> &#123;Item&#125;=Form</span><br><span class="line"><span class="keyword">const</span> &#123;TextArea&#125;=Input</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">AddUpdate</span> <span class="keyword">extends</span> <span class="title">Component</span></span>&#123;</span><br><span class="line">    render()&#123;</span><br><span class="line">        <span class="comment">//card左</span></span><br><span class="line">        <span class="keyword">const</span> title=(</span><br><span class="line">            &lt;span&gt;</span><br><span class="line">                &lt;LinkButton&gt;</span><br><span class="line">                    &lt;Icon type=<span class="string">'arrow-left'</span> style=&#123;&#123;<span class="attr">fontSize</span>:<span class="number">20</span>&#125;&#125; /&gt;                    </span><br><span class="line">                &lt;<span class="regexp">/LinkButton&gt;</span></span><br><span class="line"><span class="regexp">                &lt;span&gt;添加商品&lt;/</span>span&gt;</span><br><span class="line">            &lt;<span class="regexp">/span&gt;</span></span><br><span class="line"><span class="regexp">        )</span></span><br><span class="line"><span class="regexp">                </span></span><br><span class="line"><span class="regexp">        /</span><span class="regexp">/form内的Item的布局样式</span></span><br><span class="line"><span class="regexp">        const formItemLayout = &#123;</span></span><br><span class="line"><span class="regexp">            labelCol: &#123;span: 2&#125;, /</span><span class="regexp">/左侧label标签的宽度占2个格栅</span></span><br><span class="line"><span class="regexp">            wrapperCol: &#123;span: 8 &#125;, /</span><span class="regexp">/右侧（输入框外面有一层包裹）占8个格栅</span></span><br><span class="line"><span class="regexp">          &#125;;</span></span><br><span class="line"><span class="regexp">        return(</span></span><br><span class="line"><span class="regexp">            &lt;Card title=&#123;title&#125; extra=''&gt;</span></span><br><span class="line"><span class="regexp">                &#123;/</span>* 使用组件的扩展属性语法 *<span class="regexp">/&#125;</span></span><br><span class="line"><span class="regexp">                &lt;Form &#123;...formItemLayout&#125;&gt;</span></span><br><span class="line"><span class="regexp">                    &#123;/</span>* label指定商品前面标签名,placeholder指定输入框提示内容 *<span class="regexp">/&#125;</span></span><br><span class="line"><span class="regexp">                    &lt;Item label='商品名称'&gt;</span></span><br><span class="line"><span class="regexp">                        &lt;Input  placeholder='输入商品名' /</span>&gt;</span><br><span class="line">                    &lt;<span class="regexp">/Item&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">                    &lt;Item label='商品描述'&gt;</span></span><br><span class="line"><span class="regexp">                        &#123;/</span>* autoSize指定文本域最小高度和最大高度 *<span class="regexp">/&#125;</span></span><br><span class="line"><span class="regexp">                        &lt;TextArea placeholder='输入商品描述' autoSize=&#123;&#123; minRows: 2, maxRows: 6 &#125;&#125; /</span>&gt;</span><br><span class="line">                    &lt;<span class="regexp">/Item&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">                    &lt;Item label='商品价格'&gt;</span></span><br><span class="line"><span class="regexp">                        &lt;Input type='number' placeholder='输入商品价格' addonAfter="元" /</span>&gt;</span><br><span class="line">                    &lt;<span class="regexp">/Item&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">                    &lt;Item label='商品分类'&gt;</span></span><br><span class="line"><span class="regexp">                        &lt;Input placeholder='输入商品分类' /</span>&gt;</span><br><span class="line">                    &lt;<span class="regexp">/Item&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">                    &lt;Item label='商品图片'&gt;</span></span><br><span class="line"><span class="regexp">                        &lt;Input placeholder='输入商品图片' /</span>&gt;</span><br><span class="line">                    &lt;<span class="regexp">/Item&gt; </span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">                    &lt;Item label='商品详情'&gt;</span></span><br><span class="line"><span class="regexp">                        &lt;Input placeholder='输入商品详情' /</span>&gt;</span><br><span class="line">                    &lt;<span class="regexp">/Item&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">                    &lt;Item &gt;</span></span><br><span class="line"><span class="regexp">                        &lt;Button type='primary'&gt;提交&lt;/</span>Button&gt;</span><br><span class="line">                    &lt;<span class="regexp">/Item&gt;  </span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">                &lt;/</span>Form&gt;</span><br><span class="line">            &lt;<span class="regexp">/Card&gt;</span></span><br><span class="line"><span class="regexp">        )</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure>
<h3 id="效果：http-localhost-3000-product-add-update"><a href="#效果：http-localhost-3000-product-add-update" class="headerlink" title="效果：http://localhost:3000/product/add-update"></a>效果：<a href="http://localhost:3000/product/add-update" target="_blank" rel="noopener">http://localhost:3000/product/add-update</a></h3><p><img src="https://img-blog.csdnimg.cn/20200216214919909.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTAxMzIxNzc=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h2 id="3-表单验证add-update-jsx"><a href="#3-表单验证add-update-jsx" class="headerlink" title="3 表单验证add-update.jsx"></a>3 表单验证add-update.jsx</h2><p>【0】包装当前类使得到form的的强大函数<br>【0-1】解构得到from的getFieldDecorator<br>【1】商品名规则<br>【2】商品描述验证规则<br>【3】商品价格验证规则：知识点自自定义验证函数<br>【5】表单提交验证<br>【6】自定义验证规则要求价格大于0<br>【7】自定义验证：商品价格大于0函数</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React,&#123;Component&#125; <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">    Card,</span><br><span class="line">    Icon,</span><br><span class="line">    Form,</span><br><span class="line">    Input,</span><br><span class="line">    Cascader,<span class="comment">//级联组件</span></span><br><span class="line">    Upload, <span class="comment">//上传组件</span></span><br><span class="line">    Button,</span><br><span class="line">    message,</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">'antd'</span></span><br><span class="line"><span class="keyword">import</span> LinkButton <span class="keyword">from</span> <span class="string">'../../../components/link-button'</span></span><br><span class="line"><span class="keyword">const</span> &#123;Item&#125;=Form</span><br><span class="line"><span class="keyword">const</span> &#123;TextArea&#125;=Input</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AddUpdate</span> <span class="keyword">extends</span> <span class="title">Component</span></span>&#123;</span><br><span class="line">    <span class="comment">//【5】表单提交验证</span></span><br><span class="line">    submit=<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.props.form.validateFields(<span class="function">(<span class="params">err,v</span>)=&gt;</span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(!err)&#123;</span><br><span class="line">                alert(<span class="string">'产品添加中'</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//【7】自定义验证：商品价格大于0函数</span></span><br><span class="line">    valiPrice=<span class="function">(<span class="params">rule, value, callback</span>)=&gt;</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(value,<span class="keyword">typeof</span>(value)) <span class="comment">//在价格输入-1即显示是string类型</span></span><br><span class="line">        <span class="keyword">if</span>(value*<span class="number">1</span>&gt;<span class="number">0</span>)&#123; <span class="comment">//字符串*1：将字符串转化为数字类型</span></span><br><span class="line">            callback(<span class="string">'验证通过'</span>) <span class="comment">//每个节点必须调用否validateFields则会验证失败</span></span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            callback(<span class="string">'价格必须大于0'</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    render()&#123;</span><br><span class="line">        <span class="comment">//card左</span></span><br><span class="line">        <span class="keyword">const</span> title=(</span><br><span class="line">            &lt;span&gt;</span><br><span class="line">                &lt;LinkButton&gt;</span><br><span class="line">                    &lt;Icon type=<span class="string">'arrow-left'</span> style=&#123;&#123;<span class="attr">fontSize</span>:<span class="number">20</span>&#125;&#125; /&gt;                   </span><br><span class="line">                &lt;<span class="regexp">/LinkButton&gt;</span></span><br><span class="line"><span class="regexp">                &lt;span&gt;添加商品&lt;/</span>span&gt;</span><br><span class="line">            &lt;<span class="regexp">/span&gt;</span></span><br><span class="line"><span class="regexp">        )</span></span><br><span class="line"><span class="regexp">        /</span><span class="regexp">/card右</span></span><br><span class="line"><span class="regexp">        </span></span><br><span class="line"><span class="regexp">        /</span><span class="regexp">/form内的Item的布局样式</span></span><br><span class="line"><span class="regexp">        const formItemLayout = &#123;</span></span><br><span class="line"><span class="regexp">            labelCol: &#123;span: 2&#125;, /</span><span class="regexp">/左侧label标签的宽度占2个格栅</span></span><br><span class="line"><span class="regexp">            wrapperCol: &#123;span: 8 &#125;, /</span><span class="regexp">/右侧（输入框外面有一层包裹）占8个格栅</span></span><br><span class="line"><span class="regexp">          &#125;;</span></span><br><span class="line"><span class="regexp">		/</span><span class="regexp">/【0-1】获取from的getFieldDecorator</span></span><br><span class="line"><span class="regexp">        const &#123;getFieldDecorator&#125;=this.props.form</span></span><br><span class="line"><span class="regexp">        return(</span></span><br><span class="line"><span class="regexp">            &lt;Card title=&#123;title&#125; extra=''&gt;</span></span><br><span class="line"><span class="regexp">                &#123;/</span>* 使用组件的扩展属性语法 *<span class="regexp">/&#125;</span></span><br><span class="line"><span class="regexp">                &lt;Form &#123;...formItemLayout&#125;&gt;</span></span><br><span class="line"><span class="regexp">                    &#123;/</span>* label指定商品前面标签名,placeholder指定输入框提示内容 *<span class="regexp">/&#125;</span></span><br><span class="line"><span class="regexp">                    &lt;Item label='商品名称'&gt;</span></span><br><span class="line"><span class="regexp">                        &#123;/</span><span class="regexp">/【1】商品名规则</span></span><br><span class="line"><span class="regexp">                            getFieldDecorator('name',&#123;</span></span><br><span class="line"><span class="regexp">                                initialValue:'',</span></span><br><span class="line"><span class="regexp">                                rules:[</span></span><br><span class="line"><span class="regexp">                                    &#123;required:true,message:'商品名称必须填写'&#125;</span></span><br><span class="line"><span class="regexp">                                ]</span></span><br><span class="line"><span class="regexp">                            &#125;)(&lt;Input  placeholder='输入商品名' /</span>&gt;)</span><br><span class="line">                        &#125;</span><br><span class="line">                        </span><br><span class="line">                    &lt;<span class="regexp">/Item&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">                    &lt;Item label='商品描述'&gt;</span></span><br><span class="line"><span class="regexp">                        &#123;/</span><span class="regexp">/【2】</span></span><br><span class="line"><span class="regexp">                            getFieldDecorator('desc',&#123;</span></span><br><span class="line"><span class="regexp">                                initialValue:'',</span></span><br><span class="line"><span class="regexp">                                rules:[</span></span><br><span class="line"><span class="regexp">                                    &#123;required:true,message:'商品描述必须输入'&#125;</span></span><br><span class="line"><span class="regexp">                                ]</span></span><br><span class="line"><span class="regexp">                            &#125;)(&lt;TextArea placeholder='输入商品描述' autoSize=&#123;&#123; minRows: 2, maxRows: 6 &#125;&#125; /</span>&gt;)</span><br><span class="line">                        &#125;</span><br><span class="line">                        &#123;<span class="comment">/* autoSize指定文本域最小高度和最大高度 */</span>&#125;</span><br><span class="line">                        </span><br><span class="line">                    &lt;<span class="regexp">/Item&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">                    &lt;Item label='商品价格'&gt;</span></span><br><span class="line"><span class="regexp">                        &#123;/</span><span class="regexp">/【3】</span></span><br><span class="line"><span class="regexp">                            getFieldDecorator('price',&#123;</span></span><br><span class="line"><span class="regexp">                                initialValue:'',</span></span><br><span class="line"><span class="regexp">                                rules:[</span></span><br><span class="line"><span class="regexp">                                    &#123;required:true,message:'价格必须输入'&#125;,</span></span><br><span class="line"><span class="regexp">                                    &#123;validator:this.valiPrice&#125;,//【6】自定义验证规则要求价格大于0</span></span><br><span class="line"><span class="regexp">                                ]</span></span><br><span class="line"><span class="regexp">                            &#125;)(&lt;Input type='number' placeholder='输入商品价格' addonAfter="元" /</span>&gt;)</span><br><span class="line">                        &#125;</span><br><span class="line">                        </span><br><span class="line">                    &lt;<span class="regexp">/Item&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">                    &lt;Item label='商品分类'&gt;</span></span><br><span class="line"><span class="regexp">                        &lt;Input placeholder='输入商品分类' /</span>&gt;</span><br><span class="line">                    &lt;<span class="regexp">/Item&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">                    &lt;Item label='商品图片'&gt;</span></span><br><span class="line"><span class="regexp">                        &lt;Input placeholder='输入商品图片' /</span>&gt;</span><br><span class="line">                    &lt;<span class="regexp">/Item&gt; </span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">                    &lt;Item label='商品详情'&gt;</span></span><br><span class="line"><span class="regexp">                        &lt;Input placeholder='输入商品详情' /</span>&gt;</span><br><span class="line">                    &lt;<span class="regexp">/Item&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">                    &lt;Item &gt;</span></span><br><span class="line"><span class="regexp">                        &lt;Button type='primary' onClick=&#123;this.submit&#125;&gt;提交&lt;/</span>Button&gt;</span><br><span class="line">                    &lt;<span class="regexp">/Item&gt;  </span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">                &lt;/</span>Form&gt;</span><br><span class="line">            &lt;<span class="regexp">/Card&gt;</span></span><br><span class="line"><span class="regexp">        )</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp">export default Form.create()(AddUpdate) /</span><span class="regexp">/【0】包装当前类使得到form的的强大函数</span></span><br></pre></td></tr></table></figure>
<h3 id="效果：http-localhost-3000-product-add-update-1"><a href="#效果：http-localhost-3000-product-add-update-1" class="headerlink" title="效果：http://localhost:3000/product/add-update"></a>效果：<a href="http://localhost:3000/product/add-update" target="_blank" rel="noopener">http://localhost:3000/product/add-update</a></h3><p><img src="https://img-blog.csdnimg.cn/20200217135125633.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTAxMzIxNzc=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h2 id="4-商品分类：Cascader级联组件"><a href="#4-商品分类：Cascader级联组件" class="headerlink" title="4 商品分类：Cascader级联组件"></a>4 商品分类：Cascader级联组件</h2><h3 id="代码add-update-jsx"><a href="#代码add-update-jsx" class="headerlink" title="代码add-update.jsx"></a>代码add-update.jsx</h3><p>【0】定义状态选项<br>【1】级联商品分类<br>【2】获取categorys<br>【3】把获取到的categorys解析为options<br>【4】加载categorys并初始化为<br>【5】加载二级分类列表函数</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React,&#123;Component&#125; <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">    Card,</span><br><span class="line">    Icon,</span><br><span class="line">    Form,</span><br><span class="line">    Input,</span><br><span class="line">    Cascader,<span class="comment">//级联组件</span></span><br><span class="line">    Upload, <span class="comment">//上传组件</span></span><br><span class="line">    Button,</span><br><span class="line">    message,</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">'antd'</span></span><br><span class="line"><span class="keyword">import</span> LinkButton <span class="keyword">from</span> <span class="string">'../../../components/link-button'</span></span><br><span class="line"><span class="keyword">import</span> &#123;reqCategorys&#125; <span class="keyword">from</span> <span class="string">'../../../api'</span></span><br><span class="line"><span class="keyword">const</span> &#123;Item&#125;=Form</span><br><span class="line"><span class="keyword">const</span> &#123;TextArea&#125;=Input</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义选项</span></span><br><span class="line"><span class="comment">// const options = [</span></span><br><span class="line"><span class="comment">//     &#123;</span></span><br><span class="line"><span class="comment">//       value: 'zhejiang',</span></span><br><span class="line"><span class="comment">//       label: 'Zhejiang',</span></span><br><span class="line"><span class="comment">//       isLeaf: false,</span></span><br><span class="line"><span class="comment">//     &#125;,</span></span><br><span class="line"><span class="comment">//     &#123;</span></span><br><span class="line"><span class="comment">//       value: 'jiangsu',</span></span><br><span class="line"><span class="comment">//       label: 'Jiangsu',</span></span><br><span class="line"><span class="comment">//       isLeaf: false,</span></span><br><span class="line"><span class="comment">//     &#125;,</span></span><br><span class="line"><span class="comment">//   ];</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AddUpdate</span> <span class="keyword">extends</span> <span class="title">Component</span></span>&#123;</span><br><span class="line">    state=&#123;</span><br><span class="line">        options:[], <span class="comment">//【0】定义状态选项</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//表单提交验证</span></span><br><span class="line">    submit=<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.props.form.validateFields(<span class="function">(<span class="params">err,v</span>)=&gt;</span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(!err)&#123;</span><br><span class="line">                alert(<span class="string">'产品添加中'</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//【3】把获取到的categorys解析为options</span></span><br><span class="line">    initOptions=<span class="function">(<span class="params">categorys</span>)=&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">const</span> options = categorys.map(<span class="function">(<span class="params">v,k</span>)=&gt;</span>(&#123; <span class="comment">//返回一个字典，要额外加一个括号            </span></span><br><span class="line">                value: v._id,</span><br><span class="line">                label: v.name,</span><br><span class="line">                isLeaf: <span class="literal">false</span>,             </span><br><span class="line">        &#125;))</span><br><span class="line"></span><br><span class="line">        <span class="keyword">this</span>.setState(&#123;options&#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//【2】获取categorys</span></span><br><span class="line">    getCategorys= <span class="keyword">async</span> (parentId)=&gt;&#123;</span><br><span class="line">        <span class="keyword">const</span> result = <span class="keyword">await</span> reqCategorys(parentId)</span><br><span class="line">        <span class="keyword">if</span>(result.status===<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">const</span> categorys = result.data</span><br><span class="line">            <span class="comment">// 如果是一级分类列表</span></span><br><span class="line">            <span class="keyword">if</span> (parentId===<span class="string">'0'</span>) &#123;</span><br><span class="line">                <span class="keyword">this</span>.initOptions(categorys)</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123; <span class="comment">// 二级列表</span></span><br><span class="line">                <span class="keyword">return</span> categorys  <span class="comment">// 返回二级列表 ==&gt; 当前async函数返回的promsie就会成功且value为categorys</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            message.error(<span class="string">'产品分类获取失败请刷新重试'</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//自定义验证：商品价格大于0函数</span></span><br><span class="line">    valiPrice=<span class="function">(<span class="params">rule, value, callback</span>)=&gt;</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(value,<span class="keyword">typeof</span>(value))  <span class="comment">//在价格输入-1即显示是string类型</span></span><br><span class="line">        <span class="keyword">if</span>(value*<span class="number">1</span>&gt;<span class="number">0</span>)&#123; <span class="comment">//字符串*1：将字符串转化为数字类型</span></span><br><span class="line">            callback(<span class="string">'验证通过'</span>)</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            callback(<span class="string">'价格必须大于0'</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//【5】加载二级分类列表函数</span></span><br><span class="line">    loadData = <span class="keyword">async</span> selectedOptions =&gt; &#123;</span><br><span class="line">        <span class="keyword">const</span> targetOption = selectedOptions[<span class="number">0</span>];</span><br><span class="line">        targetOption.loading = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 根据选中的分类, 请求获取二级分类列表</span></span><br><span class="line">        <span class="keyword">const</span> subCategorys = <span class="keyword">await</span> <span class="keyword">this</span>.getCategorys(targetOption.value)</span><br><span class="line">        <span class="comment">// 隐藏loading</span></span><br><span class="line">        targetOption.loading = <span class="literal">false</span></span><br><span class="line">        <span class="comment">// 二级分类数组有数据</span></span><br><span class="line">        <span class="keyword">if</span> (subCategorys &amp;&amp; subCategorys.length&gt;<span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">// 生成一个二级列表的options</span></span><br><span class="line">        <span class="keyword">const</span> childOptions = subCategorys.map(<span class="function"><span class="params">c</span> =&gt;</span> (&#123;</span><br><span class="line">            value: c._id,</span><br><span class="line">            label: c.name,</span><br><span class="line">            isLeaf: <span class="literal">true</span></span><br><span class="line">        &#125;))</span><br><span class="line">        <span class="comment">// 关联到当前option上</span></span><br><span class="line">        targetOption.children = childOptions</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123; <span class="comment">// 当前选中的分类没有二级分类</span></span><br><span class="line">            targetOption.isLeaf = <span class="literal">true</span></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 更新options状态</span></span><br><span class="line">            <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">                options: [...this.state.options],</span><br><span class="line">            &#125;)        </span><br><span class="line">      &#125;;</span><br><span class="line">      </span><br><span class="line">    componentDidMount()&#123;</span><br><span class="line">        <span class="keyword">this</span>.getCategorys(<span class="string">'0'</span>) <span class="comment">//【4】加载categorys并初始化为</span></span><br><span class="line">    &#125;</span><br><span class="line">      </span><br><span class="line">    render()&#123;</span><br><span class="line">        <span class="comment">//card左</span></span><br><span class="line">        <span class="keyword">const</span> title=(</span><br><span class="line">            &lt;span&gt;</span><br><span class="line">                &lt;LinkButton&gt;</span><br><span class="line">                    &lt;Icon type=<span class="string">'arrow-left'</span> style=&#123;&#123;<span class="attr">fontSize</span>:<span class="number">20</span>&#125;&#125; /&gt;                   </span><br><span class="line">                &lt;<span class="regexp">/LinkButton&gt;</span></span><br><span class="line"><span class="regexp">                &lt;span&gt;添加商品&lt;/</span>span&gt;</span><br><span class="line">            &lt;<span class="regexp">/span&gt;</span></span><br><span class="line"><span class="regexp">        )</span></span><br><span class="line"><span class="regexp">        /</span><span class="regexp">/card右</span></span><br><span class="line"><span class="regexp">        </span></span><br><span class="line"><span class="regexp">        /</span><span class="regexp">/form内的Item的布局样式</span></span><br><span class="line"><span class="regexp">        const formItemLayout = &#123;</span></span><br><span class="line"><span class="regexp">            labelCol: &#123;span: 2&#125;, /</span><span class="regexp">/左侧label标签的宽度占2个格栅</span></span><br><span class="line"><span class="regexp">            wrapperCol: &#123;span: 8 &#125;, /</span><span class="regexp">/右侧（输入框外面有一层包裹）占8个格栅</span></span><br><span class="line"><span class="regexp">          &#125;;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">         /</span><span class="regexp">/获取from的getFieldDecorator</span></span><br><span class="line"><span class="regexp">        const &#123;getFieldDecorator&#125;=this.props.form</span></span><br><span class="line"><span class="regexp">        return(</span></span><br><span class="line"><span class="regexp">            &lt;Card title=&#123;title&#125; extra=''&gt;</span></span><br><span class="line"><span class="regexp">                &#123;/</span>* 使用组件的扩展属性语法 *<span class="regexp">/&#125;</span></span><br><span class="line"><span class="regexp">                &lt;Form &#123;...formItemLayout&#125;&gt;</span></span><br><span class="line"><span class="regexp">                    &#123;/</span>* label指定商品前面标签名,placeholder指定输入框提示内容 *<span class="regexp">/&#125;</span></span><br><span class="line"><span class="regexp">                    &lt;Item label='商品名称'&gt;</span></span><br><span class="line"><span class="regexp">                        &#123;/</span><span class="regexp">/商品名规则</span></span><br><span class="line"><span class="regexp">                            getFieldDecorator('name',&#123;</span></span><br><span class="line"><span class="regexp">                                initialValue:'',</span></span><br><span class="line"><span class="regexp">                                rules:[</span></span><br><span class="line"><span class="regexp">                                    &#123;required:true,message:'商品名称必须填写'&#125;</span></span><br><span class="line"><span class="regexp">                                ]</span></span><br><span class="line"><span class="regexp">                            &#125;)(&lt;Input  placeholder='输入商品名' /</span>&gt;)</span><br><span class="line">                        &#125;</span><br><span class="line">                        </span><br><span class="line">                    &lt;<span class="regexp">/Item&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">                    &lt;Item label='商品描述'&gt;</span></span><br><span class="line"><span class="regexp">                        &#123;/</span><span class="regexp">/</span></span><br><span class="line"><span class="regexp">                            getFieldDecorator('desc',&#123;</span></span><br><span class="line"><span class="regexp">                                initialValue:'',</span></span><br><span class="line"><span class="regexp">                                rules:[</span></span><br><span class="line"><span class="regexp">                                    &#123;required:true,message:'商品描述必须输入'&#125;</span></span><br><span class="line"><span class="regexp">                                ]</span></span><br><span class="line"><span class="regexp">                            &#125;)(&lt;TextArea placeholder='输入商品描述' autoSize=&#123;&#123; minRows: 2, maxRows: 6 &#125;&#125; /</span>&gt;)</span><br><span class="line">                        &#125;</span><br><span class="line">                        &#123;<span class="comment">/* autoSize指定文本域最小高度和最大高度 */</span>&#125;</span><br><span class="line">                        </span><br><span class="line">                    &lt;<span class="regexp">/Item&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">                    &lt;Item label='商品价格'&gt;</span></span><br><span class="line"><span class="regexp">                        &#123;/</span><span class="regexp">/</span></span><br><span class="line"><span class="regexp">                            getFieldDecorator('price',&#123;</span></span><br><span class="line"><span class="regexp">                                initialValue:'',</span></span><br><span class="line"><span class="regexp">                                rules:[</span></span><br><span class="line"><span class="regexp">                                    &#123;required:true,message:'价格必须输入'&#125;,</span></span><br><span class="line"><span class="regexp">                                    &#123;validator:this.valiPrice&#125;,//自定义验证规则要求价格大于0</span></span><br><span class="line"><span class="regexp">                                ]</span></span><br><span class="line"><span class="regexp">                            &#125;)(&lt;Input type='number' placeholder='输入商品价格' addonAfter="元" /</span>&gt;)</span><br><span class="line">                        &#125;</span><br><span class="line">                        </span><br><span class="line">                    &lt;<span class="regexp">/Item&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">                    &lt;Item label='商品分类'&gt;</span></span><br><span class="line"><span class="regexp">                        &#123;/</span>*【<span class="number">1</span>】级联商品分类 *<span class="regexp">/&#125;</span></span><br><span class="line"><span class="regexp">                        &lt;Cascader</span></span><br><span class="line"><span class="regexp">	                        placeholder='请选择'</span></span><br><span class="line"><span class="regexp">                            options=&#123;this.state.options&#125;</span></span><br><span class="line"><span class="regexp">                            loadData=&#123;this.loadData&#125;                            </span></span><br><span class="line"><span class="regexp">                        /</span>&gt;</span><br><span class="line">                    &lt;<span class="regexp">/Item&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">                    &lt;Item label='商品图片'&gt;</span></span><br><span class="line"><span class="regexp">                        &lt;Input placeholder='输入商品图片' /</span>&gt;</span><br><span class="line">                    &lt;<span class="regexp">/Item&gt; </span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">                    &lt;Item label='商品详情'&gt;</span></span><br><span class="line"><span class="regexp">                        &lt;Input placeholder='输入商品详情' /</span>&gt;</span><br><span class="line">                    &lt;<span class="regexp">/Item&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">                    &lt;Item &gt;</span></span><br><span class="line"><span class="regexp">                        &lt;Button type='primary' onClick=&#123;this.submit&#125;&gt;提交&lt;/</span>Button&gt;</span><br><span class="line">                    &lt;<span class="regexp">/Item&gt;  </span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">                &lt;/</span>Form&gt;</span><br><span class="line">            &lt;<span class="regexp">/Card&gt;</span></span><br><span class="line"><span class="regexp">        )</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp">export default Form.create()(AddUpdate) /</span><span class="regexp">/包装当前类使得到form的的强大函数</span></span><br></pre></td></tr></table></figure>
<h3 id="效果：http-localhost-3000-product-add-update-2"><a href="#效果：http-localhost-3000-product-add-update-2" class="headerlink" title="效果：http://localhost:3000/product/add-update"></a>效果：<a href="http://localhost:3000/product/add-update" target="_blank" rel="noopener">http://localhost:3000/product/add-update</a></h3><p><img src="https://img-blog.csdnimg.cn/20200219215732924.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTAxMzIxNzc=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h2 id="5-图片上传部分"><a href="#5-图片上传部分" class="headerlink" title="5 图片上传部分"></a>5 图片上传部分</h2><p>图片上传因为代码较多所以单独写个组件，引入进来</p>
<h3 id="5-1图片上传组件编写pictures-walls-jsx"><a href="#5-1图片上传组件编写pictures-walls-jsx" class="headerlink" title=".5.1图片上传组件编写pictures-walls.jsx"></a>.5.1图片上传组件编写pictures-walls.jsx</h3><p>【1】上传图片的接口地址<br>【2】只接受图片格式<br>【3】请求参数名，来自api说明上传图片的参数类型<br>【5】file: 当前操作的图片文件(上传/删除)<br>  fileList: 所有已上传图片文件对象的数组<br>  官方文档：<a href="https://ant.design/components/upload-cn/#onChange" target="_blank" rel="noopener">https://ant.design/components/upload-cn/#onChange</a><br> 【6】 一旦上传成功, 将当前上传的file的信息修正成最新的(name, url)<br> 【7】在操作(上传/删除)过程中不断更新fileList状态</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React,&#123;Component&#125; <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">import</span> &#123; Upload, Icon, Modal,message &#125; <span class="keyword">from</span> <span class="string">'antd'</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getBase64</span>(<span class="params">file</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> reader = <span class="keyword">new</span> FileReader();</span><br><span class="line">    reader.readAsDataURL(file);</span><br><span class="line">    reader.onload = <span class="function"><span class="params">()</span> =&gt;</span> resolve(reader.result);</span><br><span class="line">    reader.onerror = <span class="function"><span class="params">error</span> =&gt;</span> reject(error);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">PicturesWall</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  state = &#123;</span><br><span class="line">    previewVisible: <span class="literal">false</span>,</span><br><span class="line">    previewImage: <span class="string">''</span>,</span><br><span class="line">    fileList: [</span><br><span class="line">    <span class="comment">//   &#123;</span></span><br><span class="line">    <span class="comment">//     uid: '-1',</span></span><br><span class="line">    <span class="comment">//     name: 'image.png',</span></span><br><span class="line">    <span class="comment">//     status: 'done',</span></span><br><span class="line">    <span class="comment">//     url: 'https://zos.alipayobjects.com/rmsportal/jkjgkEfvpUPVyRjUImniVslZfWPnJuuZ.png',</span></span><br><span class="line">    <span class="comment">//   &#125;</span></span><br><span class="line">  </span><br><span class="line">     ],</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  handleCancel = <span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">this</span>.setState(&#123; <span class="attr">previewVisible</span>: <span class="literal">false</span> &#125;);</span><br><span class="line"></span><br><span class="line">  handlePreview = <span class="keyword">async</span> file =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (!file.url &amp;&amp; !file.preview) &#123;</span><br><span class="line">      file.preview = <span class="keyword">await</span> getBase64(file.originFileObj);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">      previewImage: file.url || file.preview,</span><br><span class="line">      previewVisible: <span class="literal">true</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">  【5】file: 当前操作的图片文件(上传/删除)</span></span><br><span class="line"><span class="comment">  fileList: 所有已上传图片文件对象的数组</span></span><br><span class="line"><span class="comment">  官方文档：https://ant.design/components/upload-cn/#onChange</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  handleChange = <span class="function">(<span class="params">&#123; file,fileList &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'handlechange:'</span>,file.status, fileList.length, file===fileList[fileList.length<span class="number">-1</span>])</span><br><span class="line"></span><br><span class="line">    <span class="comment">//【6】 一旦上传成功, 将当前上传的file的信息修正最新的(name, url)</span></span><br><span class="line">    <span class="keyword">if</span>(file.status===<span class="string">'done'</span>)&#123;</span><br><span class="line">      <span class="keyword">const</span> result = file.response  <span class="comment">// &#123;status: 0, data: &#123;name: 'xxx.jpg', url: '图片地址'&#125;&#125;</span></span><br><span class="line">      <span class="keyword">if</span>(result.status===<span class="number">0</span>)&#123;</span><br><span class="line">        message.success(<span class="string">'上传成功'</span>)</span><br><span class="line">        <span class="keyword">const</span> &#123;name, url&#125; = result.data</span><br><span class="line">        file = fileList[fileList.length<span class="number">-1</span>]</span><br><span class="line">        file.name = name</span><br><span class="line">        file.url = url           </span><br><span class="line">      &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">      message.error(<span class="string">'上传错误'</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 【7】在操作(上传/删除)过程中不断更新fileList状态</span></span><br><span class="line">    <span class="keyword">this</span>.setState(&#123; fileList &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; previewVisible, previewImage, fileList &#125; = <span class="keyword">this</span>.state;</span><br><span class="line">    <span class="keyword">const</span> uploadButton = (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;Icon type=<span class="string">"plus"</span> /&gt;</span><br><span class="line">        &lt;div className=<span class="string">"ant-upload-text"</span>&gt;Upload&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>div&gt;</span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div className=<span class="string">"clearfix"</span>&gt;</span><br><span class="line">        &lt;Upload</span><br><span class="line">          action=<span class="string">"/manage/img/upload"</span> <span class="comment">/**【1】上传图片的接口地址 */</span></span><br><span class="line">          accept=<span class="string">'image/*'</span>  <span class="comment">/**【2】只接受图片格式 */</span></span><br><span class="line">          name=<span class="string">'image'</span> <span class="comment">/**【3】请求参数名，来自api说明上传图片的参数类型 */</span></span><br><span class="line">          listType=<span class="string">"picture-card"</span> <span class="comment">/*卡片样式：text, picture 和 picture-card*/</span></span><br><span class="line">          fileList=&#123;fileList&#125; <span class="comment">/*所有已上传图片文件对象的数组*/</span></span><br><span class="line">          onPreview=&#123;<span class="keyword">this</span>.handlePreview&#125; <span class="comment">/**显示图片预览函数 */</span></span><br><span class="line">          onChange=&#123;<span class="keyword">this</span>.handleChange&#125; <span class="comment">/**上传/删除图片函数 */</span></span><br><span class="line">        &gt;</span><br><span class="line">          &#123;<span class="comment">//控制图片上传按钮最多5个</span></span><br><span class="line">          fileList.length &gt;= <span class="number">5</span> ? <span class="literal">null</span> : uploadButton&#125;</span><br><span class="line">        &lt;<span class="regexp">/Upload&gt;</span></span><br><span class="line"><span class="regexp">        &lt;Modal visible=&#123;previewVisible&#125; footer=&#123;null&#125; onCancel=&#123;this.handleCancel&#125;&gt;</span></span><br><span class="line"><span class="regexp">          &lt;img alt="example" style=&#123;&#123; width: '100%' &#125;&#125; src=&#123;previewImage&#125; /</span>&gt;</span><br><span class="line">        &lt;<span class="regexp">/Modal&gt;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>div&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="5-2-获取子组件的图片信息：父子组件传值"><a href="#5-2-获取子组件的图片信息：父子组件传值" class="headerlink" title=".5.2 获取子组件的图片信息：父子组件传值"></a>.5.2 获取子组件的图片信息：父子组件传值</h3><p>ref的官方教程：<a href="https://zh-hans.reactjs.org/docs/refs-and-the-dom.html" target="_blank" rel="noopener">https://zh-hans.reactjs.org/docs/refs-and-the-dom.html</a><br>首先，从add-update.jsx内引入picture-wall.jsx</p>
<h4 id="5-2-1-picture-wall-jsx"><a href="#5-2-1-picture-wall-jsx" class="headerlink" title=".5.2.1 picture-wall.jsx"></a>.5.2.1 picture-wall.jsx</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">constructor</span>(props)&#123;</span><br><span class="line">   <span class="keyword">super</span>(props)</span><br><span class="line"></span><br><span class="line">   <span class="keyword">this</span>.state=&#123;</span><br><span class="line">     previewVisible: <span class="literal">false</span>,</span><br><span class="line">     previewImage: <span class="string">''</span>,</span><br><span class="line">     fileList: []</span><br><span class="line">   &#125;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">/*</span></span><br><span class="line"><span class="comment"> 【1】获取所有已上传图片文件名的数组</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"> getImgs  = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line"> <span class="comment">//返回状态中的文件列表中每个文件的文件名</span></span><br><span class="line">   <span class="keyword">return</span> <span class="keyword">this</span>.state.fileList.map(<span class="function"><span class="params">file</span> =&gt;</span> file.name)</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<h4 id="5-2-1-add-update-jsx"><a href="#5-2-1-add-update-jsx" class="headerlink" title=".5.2.1 add-update.jsx"></a>.5.2.1 add-update.jsx</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">    <span class="keyword">constructor</span>(props)&#123;</span><br><span class="line">        <span class="keyword">super</span>(props)</span><br><span class="line"></span><br><span class="line">       <span class="keyword">this</span>.state=&#123;</span><br><span class="line">        options:[], <span class="comment">//定义状态选项</span></span><br><span class="line">        &#125; </span><br><span class="line"></span><br><span class="line">		<span class="comment">//【1】创建用于存放指定ref标识的标签对象容器</span></span><br><span class="line">        <span class="keyword">this</span>.pw=React.createRef()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//表单提交验证</span></span><br><span class="line">     submit=<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.props.form.validateFields(<span class="function">(<span class="params">error,values</span>)=&gt;</span>&#123;           </span><br><span class="line">            <span class="keyword">if</span>(!error)&#123;</span><br><span class="line">                <span class="comment">//【2】获取子组件的相关图片名数组信息</span></span><br><span class="line">                <span class="keyword">const</span> imgs=<span class="keyword">this</span>.pw.current.getImgs()         </span><br><span class="line">                alert(<span class="string">'成功'</span>)</span><br><span class="line">                <span class="comment">//【3】输出看看</span></span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">'表单，图片：'</span>,values,imgs)</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;               </span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">'失败'</span>)</span><br><span class="line">            &#125;             </span><br><span class="line">        &#125;)       </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//【4】render()内组件，ref标记为[1]处的容器</span></span><br><span class="line">&lt;Item label=<span class="string">'商品图片'</span>&gt;</span><br><span class="line">   &lt;PicturesWall ref=&#123;<span class="keyword">this</span>.pw&#125; /&gt;</span><br><span class="line">&lt;<span class="regexp">/Item&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="效果：提交后可看到获取到的数据"><a href="#效果：提交后可看到获取到的数据" class="headerlink" title="效果：提交后可看到获取到的数据"></a>效果：提交后可看到获取到的数据</h3><p><img src="https://img-blog.csdnimg.cn/20200224170235843.png" alt="在这里插入图片描述"></p>
<h2 id="6-图片删除（移除前端并删除服务器对应图片）"><a href="#6-图片删除（移除前端并删除服务器对应图片）" class="headerlink" title="6 图片删除（移除前端并删除服务器对应图片）"></a>6 图片删除（移除前端并删除服务器对应图片）</h2><h3 id="第一步：编写删除api函数src-api-index-js"><a href="#第一步：编写删除api函数src-api-index-js" class="headerlink" title="第一步：编写删除api函数src/api/index.js"></a>第一步：编写删除api函数src/api/index.js</h3><p>删除服务器上指定名称图片</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> ajax <span class="keyword">from</span> <span class="string">'./ajax'</span></span><br><span class="line"><span class="keyword">import</span> jsonp <span class="keyword">from</span> <span class="string">'jsonp'</span></span><br><span class="line"><span class="keyword">import</span> &#123;message&#125; <span class="keyword">from</span> <span class="string">'antd'</span> </span><br><span class="line"><span class="comment">// const BASE = 'http://localhost:5000'</span></span><br><span class="line"><span class="keyword">const</span> BASE = <span class="string">''</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 删除服务器上指定名称图片</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> reqDeletPic=<span class="function">(<span class="params">name</span>)=&gt;</span>ajax(BASE+<span class="string">'/manage/img/delete'</span>,&#123;name&#125;,<span class="string">'POST'</span>)</span><br></pre></td></tr></table></figure>
<h3 id="第二步-执行删除-src-pages-product-pictures-wall-jsx"><a href="#第二步-执行删除-src-pages-product-pictures-wall-jsx" class="headerlink" title="第二步 执行删除 src/pages/product/pictures-wall.jsx"></a>第二步 执行删除 src/pages/product/pictures-wall.jsx</h3><p>修改函数：handleChange加入删除对应图片代码：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;reqDeletPic&#125; <span class="keyword">from</span> <span class="string">'../../../api'</span> <span class="comment">//【1】</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">  file: 当前操作的图片文件(上传/删除)</span></span><br><span class="line"><span class="comment">  fileList: 所有已上传图片文件对象的数组</span></span><br><span class="line"><span class="comment">  官方文档：https://ant.design/components/upload-cn/#onChange</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  handleChange = <span class="keyword">async</span> (&#123; file,fileList &#125;) =&gt; &#123; <span class="comment">//【3】async</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'handlechange:'</span>,file.status, fileList.length, file===fileList[fileList.length<span class="number">-1</span>])</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 一旦上传成功, 将当前上传的file的信息修正成最新的(name, url)</span></span><br><span class="line">    <span class="keyword">if</span>(file.status===<span class="string">'done'</span>)&#123;</span><br><span class="line">      <span class="keyword">const</span> result = file.response  <span class="comment">// &#123;status: 0, data: &#123;name: 'xxx.jpg', url: '图片地址'&#125;&#125;</span></span><br><span class="line">      <span class="keyword">if</span>(result.status===<span class="number">0</span>)&#123;</span><br><span class="line">        message.success(<span class="string">'上传成功'</span>)</span><br><span class="line">        <span class="keyword">const</span> &#123;name, url&#125; = result.data</span><br><span class="line">        file = fileList[fileList.length<span class="number">-1</span>]</span><br><span class="line">        file.name = name</span><br><span class="line">        file.url = url           </span><br><span class="line">      &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">      message.error(<span class="string">'上传错误'</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span>(file.status===<span class="string">'removed'</span>)&#123;<span class="comment">//【2】如果文件的状态为移除，则删除服务器上对应图片名图片</span></span><br><span class="line">      <span class="keyword">const</span> result=<span class="keyword">await</span> reqDeletPic(file.name)</span><br><span class="line">      <span class="keyword">if</span>(result.status===<span class="number">0</span>)&#123;</span><br><span class="line">        message.success(<span class="string">'图片删除成功：'</span>+file.name)</span><br><span class="line">      &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        message.error(<span class="string">'图片删除失败：'</span>+file.name)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 在操作(上传/删除)过程中不断更新fileList状态</span></span><br><span class="line">    <span class="keyword">this</span>.setState(&#123; fileList &#125;)</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<h3 id="效果："><a href="#效果：" class="headerlink" title="效果："></a>效果：</h3><p><img src="https://img-blog.csdnimg.cn/20200224174421569.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTAxMzIxNzc=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h1 id="二、商品详情：富文本编辑器"><a href="#二、商品详情：富文本编辑器" class="headerlink" title="二、商品详情：富文本编辑器"></a>二、商品详情：富文本编辑器</h1><h2 id="1-使用基于react的富文本编程器插件库-react-draft-wysiwyg"><a href="#1-使用基于react的富文本编程器插件库-react-draft-wysiwyg" class="headerlink" title="1 使用基于react的富文本编程器插件库: react-draft-wysiwyg"></a>1 使用基于react的富文本编程器插件库: react-draft-wysiwyg</h2><p>官方文档：<a href="https://github.com/jpuri/react-draft-wysiwyg" target="_blank" rel="noopener">https://github.com/jpuri/react-draft-wysiwyg</a><br>官方实例：<a href="https://jpuri.github.io/react-draft-wysiwyg/#/demo" target="_blank" rel="noopener">https://jpuri.github.io/react-draft-wysiwyg/#/demo</a><br>安装1：<code>cnpm install --save react-draft-wysiwyg draft-js</code><br>安装2：<code>cnpm i --save draftjs-to-html</code><br>安装3：<code>cnpm i --save html-to-draftjs</code></p>
<h2 id="第一步，建新组件src-pages-product-rich-text-jsx"><a href="#第一步，建新组件src-pages-product-rich-text-jsx" class="headerlink" title="第一步，建新组件src/pages/product/rich-text.jsx"></a>第一步，建新组件src/pages/product/rich-text.jsx</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; EditorState, convertToRaw &#125; <span class="keyword">from</span> <span class="string">'draft-js'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Editor &#125; <span class="keyword">from</span> <span class="string">'react-draft-wysiwyg'</span>;</span><br><span class="line"><span class="keyword">import</span> draftToHtml <span class="keyword">from</span> <span class="string">'draftjs-to-html'</span>;</span><br><span class="line"><span class="keyword">import</span> htmlToDraft <span class="keyword">from</span> <span class="string">'html-to-draftjs'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'react-draft-wysiwyg/dist/react-draft-wysiwyg.css'</span> <span class="comment">//【1】引入编辑器样式，否则会乱七八糟</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">RichText</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  state = &#123;</span><br><span class="line">    editorState: EditorState.createEmpty(),</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  onEditorStateChange=<span class="function">(<span class="params">editorState</span>) =&gt;</span> &#123; <span class="comment">//【2】标签写法改成如左写法</span></span><br><span class="line">    <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">      editorState,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; editorState &#125; = <span class="keyword">this</span>.state;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;Editor</span><br><span class="line">          editorState=&#123;editorState&#125;</span><br><span class="line">          wrapperClassName=<span class="string">"demo-wrapper"</span></span><br><span class="line">          editorClassName=<span class="string">"demo-editor"</span></span><br><span class="line">          onEditorStateChange=&#123;<span class="keyword">this</span>.onEditorStateChange&#125;</span><br><span class="line">          <span class="comment">/*【3】给编辑器加内置样式，边框，高等*/</span></span><br><span class="line">          editorStyle=&#123;&#123;<span class="attr">border</span>: <span class="string">'1px solid black'</span>, <span class="attr">minHeight</span>: <span class="number">200</span>, <span class="attr">paddingLeft</span>: <span class="number">10</span>&#125;&#125;</span><br><span class="line">        /&gt;</span><br><span class="line">        &lt;textarea</span><br><span class="line">          disabled</span><br><span class="line">          value=&#123;draftToHtml(convertToRaw(editorState.getCurrentContent()))&#125;</span><br><span class="line">        /&gt;</span><br><span class="line">      &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    );</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure>
<h2 id="第二步，引入编辑器组件"><a href="#第二步，引入编辑器组件" class="headerlink" title="第二步，引入编辑器组件"></a>第二步，引入编辑器组件</h2><p>在add-updgate.jsx内引入组件</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> RichText <span class="keyword">from</span> <span class="string">'./rich-text'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//render()内</span></span><br><span class="line">&lt;Item label=<span class="string">'商品详情'</span>&gt;</span><br><span class="line">    &lt;RichText /&gt;</span><br><span class="line">&lt;<span class="regexp">/Item&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="第三步，编辑器尺寸改大"><a href="#第三步，编辑器尺寸改大" class="headerlink" title="第三步，编辑器尺寸改大"></a>第三步，编辑器尺寸改大</h2><h4 id="开始编辑器尺寸非常小，原因是-src-pages-product-add-update-jsx里定义了表单的格栅尺寸："><a href="#开始编辑器尺寸非常小，原因是-src-pages-product-add-update-jsx里定义了表单的格栅尺寸：" class="headerlink" title="开始编辑器尺寸非常小，原因是/src/pages/product/add-update.jsx里定义了表单的格栅尺寸："></a>开始编辑器尺寸非常小，原因是/src/pages/product/add-update.jsx里定义了表单的格栅尺寸：</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//form内的Item的布局样式</span></span><br><span class="line">        <span class="keyword">const</span> formItemLayout = &#123;</span><br><span class="line">            labelCol: &#123;<span class="attr">span</span>: <span class="number">2</span>&#125;, <span class="comment">//左侧label标签的宽度占2个格栅</span></span><br><span class="line">            wrapperCol: &#123;<span class="attr">span</span>: <span class="number">8</span> &#125;, <span class="comment">//右侧（输入框外面有一层包裹）占8个格栅</span></span><br><span class="line">          &#125;;</span><br></pre></td></tr></table></figure>
<h4 id="修改编辑器大小-src-pages-product-add-update-jsx"><a href="#修改编辑器大小-src-pages-product-add-update-jsx" class="headerlink" title="修改编辑器大小/src/pages/product/add-update.jsx"></a>修改编辑器大小/src/pages/product/add-update.jsx</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;Item label=<span class="string">'商品详情'</span> labelCol=&#123;&#123;<span class="attr">span</span>: <span class="number">2</span>&#125;&#125; wrapperCol=&#123;&#123;<span class="attr">span</span>: <span class="number">20</span>&#125;&#125;&gt;</span><br><span class="line">      &lt;RichText /&gt;</span><br><span class="line">&lt;<span class="regexp">/Item&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="2-父子传表单数据：点提交时获取富文本编辑器的内容"><a href="#2-父子传表单数据：点提交时获取富文本编辑器的内容" class="headerlink" title="2 父子传表单数据：点提交时获取富文本编辑器的内容"></a>2 父子传表单数据：点提交时获取富文本编辑器的内容</h2><h3 id="第一步，在rich-text-jsx内建立返回带html标签的字符串数据函数"><a href="#第一步，在rich-text-jsx内建立返回带html标签的字符串数据函数" class="headerlink" title="第一步，在rich-text.jsx内建立返回带html标签的字符串数据函数"></a>第一步，在rich-text.jsx内建立返回带html标签的字符串数据函数</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//【1】让父组件获取到当前组件的信息（state之下建立即可）</span></span><br><span class="line"> getDetail=<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">     <span class="keyword">return</span> draftToHtml(convertToRaw(<span class="keyword">this</span>.state.editorState.getCurrentContent()))</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<h3 id="第二步，在父组件add-update-jsx内接收子组件的数据"><a href="#第二步，在父组件add-update-jsx内接收子组件的数据" class="headerlink" title="第二步，在父组件add-update.jsx内接收子组件的数据"></a>第二步，在父组件add-update.jsx内接收子组件的数据</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">    <span class="keyword">constructor</span>(props)&#123;</span><br><span class="line">        <span class="keyword">super</span>(props)</span><br><span class="line">        <span class="comment">//创建用于存放指定ref标识的标签对象容器</span></span><br><span class="line">        <span class="keyword">this</span>.pw=React.createRef()</span><br><span class="line">        <span class="comment">//【1】建立空容器</span></span><br><span class="line">        <span class="keyword">this</span>.editor=React.createRef()</span><br><span class="line"></span><br><span class="line">       <span class="keyword">this</span>.state=&#123;</span><br><span class="line">        options:[], <span class="comment">//定义状态选项</span></span><br><span class="line">        &#125; </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//表单提交验证</span></span><br><span class="line">     submit=<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.props.form.validateFields(<span class="function">(<span class="params">error,values</span>)=&gt;</span>&#123;            </span><br><span class="line">            <span class="keyword">if</span>(!error)&#123;</span><br><span class="line">                <span class="comment">//获取子组件的相关信息</span></span><br><span class="line">                <span class="keyword">const</span> imgs=<span class="keyword">this</span>.pw.current.getImgs()  </span><br><span class="line">                <span class="comment">//【3】获取子组件商品详情的带html标签的字符串数据</span></span><br><span class="line">                <span class="keyword">const</span> detail=<span class="keyword">this</span>.editor.current.getDetail()       </span><br><span class="line">                alert(<span class="string">'成功'</span>)</span><br><span class="line">                <span class="comment">//【4】输出看看</span></span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">'表单，图片，详情：'</span>,values,imgs,detail)</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;             </span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">'失败'</span>)</span><br><span class="line">            &#125;           </span><br><span class="line">        &#125;)       </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//render()&#123;&#125;内</span></span><br><span class="line">&lt;Item label=<span class="string">'商品详情'</span> labelCol=&#123;&#123;<span class="attr">span</span>: <span class="number">2</span>&#125;&#125; wrapperCol=&#123;&#123;<span class="attr">span</span>: <span class="number">20</span>&#125;&#125;&gt;</span><br><span class="line">      &#123;<span class="comment">/**【2】指定把richtext对象装进editor里 */</span>&#125;</span><br><span class="line">      &lt;RichText ref=&#123;<span class="keyword">this</span>.editor&#125; /&gt;</span><br><span class="line">&lt;<span class="regexp">/Item&gt;</span></span><br></pre></td></tr></table></figure>


<h3 id="效果：填写商品信息，提交后，控制台输出"><a href="#效果：填写商品信息，提交后，控制台输出" class="headerlink" title="效果：填写商品信息，提交后，控制台输出"></a>效果：填写商品信息，提交后，控制台输出</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">表单，图片，详情： &#123;<span class="attr">name</span>: <span class="string">"游客131071427"</span>, <span class="attr">desc</span>: <span class="string">"a"</span>, <span class="attr">price</span>: <span class="string">"2"</span>, <span class="attr">categoryIds</span>: <span class="built_in">Array</span>(<span class="number">1</span>)&#125; [] </span><br><span class="line">&lt;p&gt;<span class="xml"><span class="tag">&lt;<span class="name">strong</span>&gt;</span>你好<span class="tag">&lt;/<span class="name">strong</span>&gt;</span></span>在 &lt;span style=<span class="string">"color: rgb(226,80,65);"</span>&gt;地地地柑&lt;<span class="regexp">/span&gt;  &lt;del&gt;工 城&lt;/</span>del&gt;&amp;nbsp;&amp;nbsp;&lt;<span class="regexp">/p&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="3-图片上传：没有按钮，加个，并实现功能rich-text-jsx"><a href="#3-图片上传：没有按钮，加个，并实现功能rich-text-jsx" class="headerlink" title="3 图片上传：没有按钮，加个，并实现功能rich-text.jsx"></a>3 图片上传：没有按钮，加个，并实现功能rich-text.jsx</h2><p>【1】图片上传按钮配置<br>【2】图片上传加一个上传按钮功能实现函数</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//【2】图片上传加一个上传按钮功能实现函数</span></span><br><span class="line"> uploadImageCallBack = <span class="function">(<span class="params">file</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(</span><br><span class="line">      (resolve, reject) =&gt; &#123;</span><br><span class="line">        <span class="keyword">const</span> xhr = <span class="keyword">new</span> XMLHttpRequest()</span><br><span class="line">        xhr.open(<span class="string">'POST'</span>, <span class="string">'/manage/img/upload'</span>)</span><br><span class="line">        <span class="keyword">const</span> data = <span class="keyword">new</span> FormData()</span><br><span class="line">        data.append(<span class="string">'image'</span>, file)</span><br><span class="line">        xhr.send(data)</span><br><span class="line">        xhr.addEventListener(<span class="string">'load'</span>, () =&gt; &#123;</span><br><span class="line">          <span class="keyword">const</span> response = <span class="built_in">JSON</span>.parse(xhr.responseText)</span><br><span class="line">          <span class="keyword">const</span> url = response.data.url <span class="comment">// 得到图片的url</span></span><br><span class="line">          resolve(&#123;<span class="attr">data</span>: &#123;<span class="attr">link</span>: url&#125;&#125;) <span class="comment">//返回图片的地址</span></span><br><span class="line">        &#125;)</span><br><span class="line">        xhr.addEventListener(<span class="string">'error'</span>, () =&gt; &#123;</span><br><span class="line">          <span class="keyword">const</span> error = <span class="built_in">JSON</span>.parse(xhr.responseText)</span><br><span class="line">          reject(error)</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="comment">//render()&#123;&#125;</span></span><br><span class="line">render() &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; editorState &#125; = <span class="keyword">this</span>.state;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;Editor</span><br><span class="line">          editorState=&#123;editorState&#125;</span><br><span class="line">          wrapperClassName=<span class="string">"demo-wrapper"</span></span><br><span class="line">          editorClassName=<span class="string">"demo-editor"</span></span><br><span class="line">          editorStyle=&#123;&#123;<span class="attr">border</span>: <span class="string">'1px solid black'</span>, <span class="attr">minHeight</span>: <span class="number">200</span>, <span class="attr">paddingLeft</span>: <span class="number">10</span>&#125;&#125;</span><br><span class="line">          onEditorStateChange=&#123;<span class="keyword">this</span>.onEditorStateChange&#125;</span><br><span class="line">          <span class="comment">/**【1】图片上传按钮配置*/</span></span><br><span class="line">          toolbar=&#123;&#123;</span><br><span class="line">            image: &#123; <span class="attr">uploadCallback</span>: <span class="keyword">this</span>.uploadImageCallBack, <span class="attr">alt</span>: &#123; <span class="attr">present</span>: <span class="literal">true</span>, <span class="attr">mandatory</span>: <span class="literal">true</span> &#125; &#125;,</span><br><span class="line">          &#125;&#125;</span><br><span class="line">        /&gt;</span><br><span class="line">        &lt;textarea</span><br><span class="line">          disabled</span><br><span class="line">          value=&#123;draftToHtml(convertToRaw(editorState.getCurrentContent()))&#125;</span><br><span class="line">        /&gt;</span><br><span class="line">      &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    );</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br></pre></td></tr></table></figure>
<h3 id="效果：点富文本内的图片上传按钮可成功上传图片："><a href="#效果：点富文本内的图片上传按钮可成功上传图片：" class="headerlink" title="效果：点富文本内的图片上传按钮可成功上传图片："></a>效果：点富文本内的图片上传按钮可成功上传图片：</h3><p>注意 alt 内容必须填个，否则无法上传图片<br><img src="https://img-blog.csdnimg.cn/20200224215057252.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTAxMzIxNzc=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h1 id="三、提交添加商品请求"><a href="#三、提交添加商品请求" class="headerlink" title="三、提交添加商品请求"></a>三、提交添加商品请求</h1><h2 id="第一步：编写api请求函数-src-api-index-js"><a href="#第一步：编写api请求函数-src-api-index-js" class="headerlink" title="第一步：编写api请求函数(src/api/index.js)"></a>第一步：编写api请求函数(src/api/index.js)</h2><p>添加商品/修改商品：因为参数相同所以组成二合一接口，请求地址为按条件拼接，如果参数存在._id则为修改商品，否则为添加商品</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//添加商品/修改商品：二合一接口，如果参数存在._id则为修改商品，否则为添加商品</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> reqAddUpdatePro=<span class="function">(<span class="params">product</span>)=&gt;</span>ajax(BASE+<span class="string">'/manage/product/'</span>+(product._id?<span class="string">'update'</span>:<span class="string">'add'</span>),product,<span class="string">'POST'</span>)</span><br></pre></td></tr></table></figure>
<h2 id="第二步：收集表单数据（src-pages-product-add-update-jsx）"><a href="#第二步：收集表单数据（src-pages-product-add-update-jsx）" class="headerlink" title="第二步：收集表单数据（src/pages/product/add-update.jsx）"></a>第二步：收集表单数据（src/pages/product/add-update.jsx）</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//表单提交验证</span></span><br><span class="line">     submit=<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.props.form.validateFields(<span class="function">(<span class="params">error,values</span>)=&gt;</span>&#123;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">//【2】调用接口请求函数去添加/更新</span></span><br><span class="line">            <span class="comment">//【3】根据结果提示是否添加/更新成功</span></span><br><span class="line">            <span class="keyword">if</span>(!error)&#123;</span><br><span class="line">                <span class="comment">//【1】收集数据, 并封装成product对象</span></span><br><span class="line">                <span class="keyword">const</span> &#123;name,desc,price,categoryIds&#125;=values</span><br><span class="line">                <span class="keyword">let</span> pCategoryId,categoryId</span><br><span class="line">                <span class="keyword">if</span>(categoryIds.length===<span class="number">1</span>)&#123;</span><br><span class="line">                    pCategoryId=<span class="string">'0'</span></span><br><span class="line">                    categoryId=categoryIds[<span class="number">0</span>]</span><br><span class="line">                &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                    pCategoryId=categoryIds[<span class="number">0</span>] </span><br><span class="line">                    categoryId=categoryIds[<span class="number">1</span>]</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">//获取子组件的相关信息</span></span><br><span class="line">                <span class="keyword">const</span> imgs=<span class="keyword">this</span>.pw.current.getImgs()  </span><br><span class="line">                <span class="comment">//获取子组件商品详情的带html标签的字符串数据</span></span><br><span class="line">                <span class="keyword">const</span> detail=<span class="keyword">this</span>.editor.current.getDetail()       </span><br><span class="line">                <span class="comment">//将收集到的表单数据封闭成product对象</span></span><br><span class="line">                <span class="keyword">const</span> product=&#123;name,desc,price,imgs,detail,pCategoryId,categoryId&#125;</span><br><span class="line">                <span class="comment">//输出看看</span></span><br><span class="line">                <span class="built_in">console</span>.log(product)</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;                </span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">'失败'</span>)</span><br><span class="line">            &#125;   </span><br><span class="line">            </span><br><span class="line">            </span><br><span class="line">        &#125;)      </span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h3 id="2步效果：填写完成添加产品表单，点提交按钮："><a href="#2步效果：填写完成添加产品表单，点提交按钮：" class="headerlink" title="2步效果：填写完成添加产品表单，点提交按钮："></a>2步效果：填写完成添加产品表单，点提交按钮：</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//只有一级分类的产品数据</span></span><br><span class="line">categoryId: <span class="string">"5e4154e725a557082c18f430"</span></span><br><span class="line">desc: <span class="string">"工"</span></span><br><span class="line">detail: <span class="string">"&lt;p&gt;手镯&lt;/p&gt;↵&lt;img src="</span>http:<span class="comment">//localhost:5000/upload/image-1582702969070.jpg" alt="顶替" style="height: auto;width: auto"/&gt;↵&lt;p&gt;&lt;/p&gt;↵"</span></span><br><span class="line">imgs: <span class="built_in">Array</span>(<span class="number">2</span>)</span><br><span class="line"><span class="number">0</span>: <span class="string">"image-1582702950591.jpg"</span></span><br><span class="line"><span class="number">1</span>: <span class="string">"image-1582702955364.jpg"</span></span><br><span class="line">length: <span class="number">2</span></span><br><span class="line">__proto__: <span class="built_in">Array</span>(<span class="number">0</span>)</span><br><span class="line">name: <span class="string">"游客131071427"</span></span><br><span class="line">pCategoryId: <span class="string">"0"</span></span><br><span class="line">price: <span class="string">"12"</span></span><br><span class="line">__proto__: <span class="built_in">Object</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//二级分类的产品数据</span></span><br><span class="line">categoryId: <span class="string">"5e4771a418da331714a18693"</span></span><br><span class="line">desc: <span class="string">"工"</span></span><br><span class="line">detail: <span class="string">"&lt;p&gt;手镯&lt;/p&gt;↵&lt;img src="</span>http:<span class="comment">//localhost:5000/upload/image-1582702969070.jpg" alt="顶替" style="height: auto;width: auto"/&gt;↵&lt;p&gt;&lt;/p&gt;↵"</span></span><br><span class="line">imgs: <span class="built_in">Array</span>(<span class="number">2</span>)</span><br><span class="line"><span class="number">0</span>: <span class="string">"image-1582702950591.jpg"</span></span><br><span class="line"><span class="number">1</span>: <span class="string">"image-1582702955364.jpg"</span></span><br><span class="line">length: <span class="number">2</span></span><br><span class="line">__proto__: <span class="built_in">Array</span>(<span class="number">0</span>)</span><br><span class="line">name: <span class="string">"游客131071427"</span></span><br><span class="line">pCategoryId: <span class="string">"5e41549925a557082c18f426"</span></span><br><span class="line">price: <span class="string">"12"</span></span><br><span class="line">__proto__: <span class="built_in">Object</span></span><br></pre></td></tr></table></figure>
<h2 id="第三步：提交数据（添加商品）"><a href="#第三步：提交数据（添加商品）" class="headerlink" title="第三步：提交数据（添加商品）"></a>第三步：提交数据（添加商品）</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;reqCategorys,reqAddUpdatePro&#125; <span class="keyword">from</span> <span class="string">'../../../api'</span> <span class="comment">//【0】引入添加修改产品函数</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//产品表单提交</span></span><br><span class="line">     submit=<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.props.form.validateFields(<span class="keyword">async</span>(error,values)=&gt;&#123;</span><br><span class="line">                                   </span><br><span class="line">            <span class="keyword">if</span>(!error)&#123;</span><br><span class="line">                <span class="comment">//【1】解构values收集数据, 并封装成product对象</span></span><br><span class="line">                <span class="keyword">const</span> &#123;name,desc,price,categoryIds&#125;=values</span><br><span class="line">                <span class="keyword">let</span> pCategoryId,categoryId</span><br><span class="line">                <span class="keyword">if</span>(categoryIds.length===<span class="number">1</span>)&#123;<span class="comment">//如果长度为1说明只有一级产品分类</span></span><br><span class="line">                    pCategoryId=<span class="string">'0'</span></span><br><span class="line">                    categoryId=categoryIds[<span class="number">0</span>]</span><br><span class="line">                &#125;<span class="keyword">else</span>&#123;<span class="comment">//否则说明有二级产品分类</span></span><br><span class="line">                    pCategoryId=categoryIds[<span class="number">0</span>] </span><br><span class="line">                    categoryId=categoryIds[<span class="number">1</span>]</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">//获取子组件的相关信息</span></span><br><span class="line">                <span class="keyword">const</span> imgs=<span class="keyword">this</span>.pw.current.getImgs()  </span><br><span class="line">                <span class="comment">//获取子组件商品详情的带html标签的字符串数据</span></span><br><span class="line">                <span class="keyword">const</span> detail=<span class="keyword">this</span>.editor.current.getDetail()       </span><br><span class="line">               <span class="comment">//封闭成product对象</span></span><br><span class="line">                <span class="keyword">const</span> product=&#123;name,desc,price,imgs,detail,pCategoryId,categoryId&#125;</span><br><span class="line">                <span class="comment">//输出看看</span></span><br><span class="line">                <span class="built_in">console</span>.log(product)</span><br><span class="line"></span><br><span class="line">                <span class="comment">//【2】调用接口请求函数去添加/更新</span></span><br><span class="line">                <span class="keyword">const</span> result=<span class="keyword">await</span> reqAddUpdatePro(product)</span><br><span class="line">                <span class="keyword">if</span>(result.status===<span class="number">0</span>)&#123;<span class="comment">//【3】根据结果提示是否添加/更新成功</span></span><br><span class="line">                    message.success(<span class="string">'添加产品成功'</span>)</span><br><span class="line">                &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                    message.error(<span class="string">'添加产品失败'</span>)</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;                </span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">'验证失败，请检查产品数据'</span>)</span><br><span class="line">            &#125;   </span><br><span class="line">                        </span><br><span class="line">        &#125;)    </span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h3 id="3步效果：全部完成点提交，将显示添加产品成功"><a href="#3步效果：全部完成点提交，将显示添加产品成功" class="headerlink" title="3步效果：全部完成点提交，将显示添加产品成功"></a>3步效果：全部完成点提交，将显示添加产品成功</h3><h1 id="附：完整代码"><a href="#附：完整代码" class="headerlink" title="附：完整代码"></a>附：完整代码</h1><h2 id="1-商品管理主页src-pages-product-home-jsx"><a href="#1-商品管理主页src-pages-product-home-jsx" class="headerlink" title="1.商品管理主页src/pages/product/home.jsx"></a>1.商品管理主页src/pages/product/home.jsx</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React,&#123;Component&#125; <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">    Card,</span><br><span class="line">    Select,</span><br><span class="line">    Input,</span><br><span class="line">    Table,</span><br><span class="line">    Icon,</span><br><span class="line">    Button,</span><br><span class="line">    message</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">'antd'</span></span><br><span class="line"><span class="keyword">import</span> LinkButton <span class="keyword">from</span> <span class="string">'../../../components/link-button'</span></span><br><span class="line"><span class="keyword">import</span> &#123;reqProducts&#125; <span class="keyword">from</span> <span class="string">'../../../api/'</span> <span class="comment">//【0】引入产品列表请求</span></span><br><span class="line"><span class="keyword">import</span> &#123;PAGE_SIZE&#125; <span class="keyword">from</span> <span class="string">'../../../utils/constans'</span> <span class="comment">//【0.1】引入常量</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Option=Select.Option</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">Home</span> <span class="keyword">extends</span> <span class="title">Component</span></span>&#123;</span><br><span class="line">    state=&#123;</span><br><span class="line">        <span class="comment">//商品列表</span></span><br><span class="line">         products:[</span><br><span class="line">        <span class="comment">//             &#123;</span></span><br><span class="line">        <span class="comment">//                 "status": 1,</span></span><br><span class="line">        <span class="comment">//                 "imgs": [</span></span><br><span class="line">        <span class="comment">//                     "image-1559402396338.jpg"</span></span><br><span class="line">        <span class="comment">//                 ],</span></span><br><span class="line">        <span class="comment">//                 "_id": "5ca9e05db49ef916541160cd",</span></span><br><span class="line">        <span class="comment">//                 "name": "联想ThinkPad 翼4809",</span></span><br><span class="line">        <span class="comment">//                 "desc": "年度重量级新品，X390、T490全新登场 更加轻薄机身设计9",</span></span><br><span class="line">        <span class="comment">//                 "price": 65999,</span></span><br><span class="line">        <span class="comment">//                 "pCategoryId": "5ca9d6c0b49ef916541160bb",</span></span><br><span class="line">        <span class="comment">//                 "categoryId": "5ca9db9fb49ef916541160cc",</span></span><br><span class="line">        <span class="comment">//                 "detail": "&lt;p&gt;&lt;span style=\"color: rgb(228,57,60);background-color: rgb(255,255,255);font-size: 12px;\"&gt;想你所需，超你所想！精致外观，轻薄便携带光驱，内置正版office杜绝盗版死机，全国联保两年！&lt;/span&gt; 222&lt;/p&gt;\n&lt;p&gt;&lt;span style=\"color: rgb(102,102,102);background-color: rgb(255,255,255);font-size: 16px;\"&gt;联想（Lenovo）扬天V110 15.6英寸家用轻薄便携商务办公手提笔记本电脑 定制 2G独显 内置&lt;/span&gt;&lt;/p&gt;\n&lt;p&gt;&lt;span style=\"color: rgb(102,102,102);background-color: rgb(255,255,255);font-size: 16px;\"&gt;99999&lt;/span&gt;&lt;/p&gt;\n",</span></span><br><span class="line">        <span class="comment">//                 "__v": 0</span></span><br><span class="line">        <span class="comment">//             &#125;,</span></span><br><span class="line">        <span class="comment">//             &#123;</span></span><br><span class="line">        <span class="comment">//                 "status": 1,</span></span><br><span class="line">        <span class="comment">//                 "imgs": [</span></span><br><span class="line">        <span class="comment">//                     "image-1559402448049.jpg",</span></span><br><span class="line">        <span class="comment">//                     "image-1559402450480.jpg"</span></span><br><span class="line">        <span class="comment">//                 ],</span></span><br><span class="line">        <span class="comment">//                 "_id": "5ca9e414b49ef916541160ce",</span></span><br><span class="line">        <span class="comment">//                 "name": "华硕(ASUS) 飞行堡垒",</span></span><br><span class="line">        <span class="comment">//                 "desc": "15.6英寸窄边框游戏笔记本电脑(i7-8750H 8G 256GSSD+1T GTX1050Ti 4G IPS)",</span></span><br><span class="line">        <span class="comment">//                 "price": 6799,</span></span><br><span class="line">        <span class="comment">//                 "pCategoryId": "5ca9d6c0b49ef916541160bb",</span></span><br><span class="line">        <span class="comment">//                 "categoryId": "5ca9db8ab49ef916541160cb",</span></span><br><span class="line">        <span class="comment">//                 "detail": "&lt;p&gt;&lt;span style=\"color: rgb(102,102,102);background-color: rgb(255,255,255);font-size: 16px;\"&gt;华硕(ASUS) 飞行堡垒6 15.6英寸窄边框游戏笔记本电脑(i7-8750H 8G 256GSSD+1T GTX1050Ti 4G IPS)火陨红黑&lt;/span&gt;&amp;nbsp;&lt;/p&gt;\n&lt;p&gt;&lt;span style=\"color: rgb(228,57,60);background-color: rgb(255,255,255);font-size: 12px;\"&gt;1T+256G高速存储组合！超窄边框视野无阻，强劲散热一键启动！&lt;/span&gt;&amp;nbsp;&lt;/p&gt;\n",</span></span><br><span class="line">        <span class="comment">//                 "__v": 0</span></span><br><span class="line">        <span class="comment">//             &#125;,</span></span><br><span class="line">        <span class="comment">//             &#123;</span></span><br><span class="line">        <span class="comment">//                 "status": 2,</span></span><br><span class="line">        <span class="comment">//                 "imgs": [</span></span><br><span class="line">        <span class="comment">//                     "image-1559402436395.jpg"</span></span><br><span class="line">        <span class="comment">//                 ],</span></span><br><span class="line">        <span class="comment">//                 "_id": "5ca9e4b7b49ef916541160cf",</span></span><br><span class="line">        <span class="comment">//                 "name": "你不知道的JS（上卷）",</span></span><br><span class="line">        <span class="comment">//                 "desc": "图灵程序设计丛书： [You Don't Know JS:Scope &amp; Closures] JavaScript开发经典入门图书 打通JavaScript的任督二脉",</span></span><br><span class="line">        <span class="comment">//                 "price": 35,</span></span><br><span class="line">        <span class="comment">//                 "pCategoryId": "0",</span></span><br><span class="line">        <span class="comment">//                 "categoryId": "5ca9d6c9b49ef916541160bc",</span></span><br><span class="line">        <span class="comment">//                 "detail": "&lt;p style=\"text-align:start;\"&gt;&lt;span style=\"color: rgb(102,102,102);background-color: rgb(255,255,255);font-size: 16px;\"&gt;图灵程序设计丛书：你不知道的JavaScript（上卷）&lt;/span&gt; &lt;span style=\"color: rgb(102,102,102);background-color: rgb(255,255,255);font-size: 16px;\"&gt;&lt;strong&gt;[You Don't Know JS:Scope &amp;amp; Closures]&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;\n&lt;p style=\"text-align:start;\"&gt;&lt;span style=\"color: rgb(227,57,60);background-color: rgb(255,255,255);font-size: 12px;\"&gt;JavaScript开发经典入门图书 打通JavaScript的任督二脉 领略语言内部的绝美风光&lt;/span&gt;&amp;nbsp;&lt;/p&gt;\n",</span></span><br><span class="line">        <span class="comment">//                 "__v": 0</span></span><br><span class="line">        <span class="comment">//             &#125;,</span></span><br><span class="line">        <span class="comment">//             &#123;</span></span><br><span class="line">        <span class="comment">//                 "status": 2,</span></span><br><span class="line">        <span class="comment">//                 "imgs": [</span></span><br><span class="line">        <span class="comment">//                     "image-1554638240202.jpg"</span></span><br><span class="line">        <span class="comment">//                 ],</span></span><br><span class="line">        <span class="comment">//                 "_id": "5ca9e5bbb49ef916541160d0",</span></span><br><span class="line">        <span class="comment">//                 "name": "美的(Midea) 213升-BCD-213TM",</span></span><br><span class="line">        <span class="comment">//                 "desc": "爆款直降!大容量三口之家优选! *节能养鲜,自动低温补偿,36分贝静音呵护",</span></span><br><span class="line">        <span class="comment">//                 "price": 1388,</span></span><br><span class="line">        <span class="comment">//                 "pCategoryId": "5ca9d695b49ef916541160ba",</span></span><br><span class="line">        <span class="comment">//                 "categoryId": "5ca9d9cfb49ef916541160c4",</span></span><br><span class="line">        <span class="comment">//                 "detail": "&lt;p style=\"text-align:start;\"&gt;&lt;span style=\"color: rgb(102,102,102);background-color: rgb(255,255,255);font-size: 16px;font-family: Arial, \"microsoft yahei;\"&gt;美的(Midea) 213升 节能静音家用三门小冰箱 阳光米 BCD-213TM(E)&lt;/span&gt;&lt;/p&gt;\n&lt;p&gt;&lt;span style=\"color: rgb(228,57,60);background-color: rgb(255,255,255);font-size: 12px;font-family: tahoma, arial, \"Microsoft YaHei\", \"Hiragino Sans GB\", u5b8bu4f53, sans-serif;\"&gt;爆款直降!大容量三口之家优选! *节能养鲜,自动低温补偿,36分贝静音呵护! *每天不到一度电,省钱又省心!&lt;/span&gt;&amp;nbsp;&lt;/p&gt;\n",</span></span><br><span class="line">        <span class="comment">//                 "__v": 0</span></span><br><span class="line">        <span class="comment">//             &#125;,</span></span><br><span class="line">        <span class="comment">//             &#123;</span></span><br><span class="line">        <span class="comment">//                 "status": 1,</span></span><br><span class="line">        <span class="comment">//                 "imgs": [</span></span><br><span class="line">        <span class="comment">//                     "image-1554638403550.jpg"</span></span><br><span class="line">        <span class="comment">//                 ],</span></span><br><span class="line">        <span class="comment">//                 "_id": "5ca9e653b49ef916541160d1",</span></span><br><span class="line">        <span class="comment">//                 "name": "美的（Midea）KFR-35GW/WDAA3",</span></span><br><span class="line">        <span class="comment">//                 "desc": "正1.5匹 变频 智弧 冷暖 智能壁挂式卧室空调挂机",</span></span><br><span class="line">        <span class="comment">//                 "price": 2499,</span></span><br><span class="line">        <span class="comment">//                 "pCategoryId": "5ca9d695b49ef916541160ba",</span></span><br><span class="line">        <span class="comment">//                 "categoryId": "5ca9da1ab49ef916541160c6",</span></span><br><span class="line">        <span class="comment">//                 "detail": "&lt;p style=\"text-align:start;\"&gt;&lt;span style=\"color: rgb(102,102,102);background-color: rgb(255,255,255);font-size: 16px;\"&gt;美的（Midea）正1.5匹 变频 智弧 冷暖 智能壁挂式卧室空调挂机 KFR-35GW/WDAA3@&lt;/span&gt;&lt;/p&gt;\n&lt;p style=\"text-align:start;\"&gt;&lt;/p&gt;\n&lt;p&gt;&lt;span style=\"color: rgb(228,57,60);background-color: rgb(255,255,255);font-size: 12px;\"&gt;提前加入购物车！2299元成交价！前50名下单送赠品加湿型电风扇，赠完即止！8日0点开抢！&lt;/span&gt;&lt;a href=\"https://sale.jd.com/mall/LKHdqZUIYk.html\" target=\"_blank\"&gt;&lt;span style=\"color: rgb(94,105,173);background-color: rgb(255,255,255);font-size: 12px;\"&gt;更有无风感柜挂组合套购立减500元！猛戳！！&lt;/span&gt;&lt;/a&gt;&amp;nbsp;&lt;/p&gt;\n",</span></span><br><span class="line">        <span class="comment">//                 "__v": 0</span></span><br><span class="line">        <span class="comment">//             &#125;</span></span><br><span class="line">          ], </span><br><span class="line">          loading:<span class="literal">false</span>,</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//Table的列名及对应显示的内容渲染</span></span><br><span class="line">    initColumns=<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.columns=[</span><br><span class="line">            &#123;</span><br><span class="line">                title:<span class="string">'商品名称'</span>,</span><br><span class="line">                dataIndex:<span class="string">'name'</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                title:<span class="string">'商品描述'</span>,</span><br><span class="line">                dataIndex:<span class="string">'desc'</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                title:<span class="string">'价格'</span>,</span><br><span class="line">                dataIndex:<span class="string">'price'</span>,</span><br><span class="line">                render:<span class="function">(<span class="params">price</span>)=&gt;</span><span class="string">'￥'</span>+price <span class="comment">//把price渲染进对应的行，并加上￥符号</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                width:<span class="number">100</span>,</span><br><span class="line">                title:<span class="string">'商品状态'</span>,</span><br><span class="line">                dataIndex:<span class="string">'status'</span>,</span><br><span class="line">                render:<span class="function">(<span class="params">status</span>)=&gt;</span>&#123;</span><br><span class="line">                    <span class="keyword">return</span>(</span><br><span class="line">                        &lt;span&gt;</span><br><span class="line">                            &lt;Button type=<span class="string">'primary'</span>&gt;&#123;status===<span class="number">1</span> ? <span class="string">'下架'</span> : <span class="string">'上架'</span>&#125;&lt;<span class="regexp">/Button&gt;</span></span><br><span class="line"><span class="regexp">                            &lt;span&gt;&#123;status===1 ? '在售':'已下架'&#125;&lt;/</span>span&gt;</span><br><span class="line">                        &lt;<span class="regexp">/span&gt;</span></span><br><span class="line"><span class="regexp">                    )</span></span><br><span class="line"><span class="regexp">                &#125;</span></span><br><span class="line"><span class="regexp">            &#125;,</span></span><br><span class="line"><span class="regexp">            &#123;</span></span><br><span class="line"><span class="regexp">                width:100,</span></span><br><span class="line"><span class="regexp">                title:'操作',</span></span><br><span class="line"><span class="regexp">                </span></span><br><span class="line"><span class="regexp">                render:(proObj)=&gt;&#123;</span></span><br><span class="line"><span class="regexp">                    return(</span></span><br><span class="line"><span class="regexp">                        &lt;span&gt;</span></span><br><span class="line"><span class="regexp">                            &lt;LinkButton&gt;详情&lt;/</span>LinkButton&gt;</span><br><span class="line">                            &lt;LinkButton&gt;修改&lt;<span class="regexp">/LinkButton&gt;</span></span><br><span class="line"><span class="regexp">                        &lt;/</span>span&gt;</span><br><span class="line">                    )</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// addPro=async()=&gt;&#123;</span></span><br><span class="line">    <span class="comment">//     const result=await reqAddPro('5e41549925a557082c18f426','0','桔子','desc','price','detail',[])</span></span><br><span class="line">    <span class="comment">//     console.log(result)</span></span><br><span class="line">    <span class="comment">//     if (result.status===0)&#123;</span></span><br><span class="line">    <span class="comment">//         message.success('产品添加成功')</span></span><br><span class="line">    <span class="comment">//     &#125;else&#123;</span></span><br><span class="line">    <span class="comment">//         message.error(result.msg)</span></span><br><span class="line">    <span class="comment">//     &#125;</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//【1】请求产品列表放入state，后台分页</span></span><br><span class="line">    getProducts=<span class="keyword">async</span>(pageNum)=&gt;&#123;<span class="comment">//pageNum为请求页码</span></span><br><span class="line">        <span class="keyword">this</span>.setState(&#123;<span class="attr">loading</span>:<span class="literal">true</span>&#125;) <span class="comment">//设置加载动画开始显示</span></span><br><span class="line">        <span class="keyword">this</span>.pageNum=pageNum <span class="comment">//接收参数</span></span><br><span class="line">        <span class="keyword">const</span> result = <span class="keyword">await</span> reqProducts(&#123;pageNum,PAGE_SIZE&#125;)</span><br><span class="line">        <span class="keyword">this</span>.setState(&#123;<span class="attr">loading</span>:<span class="literal">true</span>&#125;) <span class="comment">//关闭加载动画</span></span><br><span class="line">        <span class="keyword">if</span>(result.status===<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(result.data.list)</span><br><span class="line">            <span class="comment">//this.setState(&#123;products:result.data&#125;)</span></span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            message.error(<span class="string">'加载产品失败，请刷新页面重试'</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    componentWillMount()&#123;</span><br><span class="line">        <span class="comment">//Table列名初始化函数调用，用于准备表格列名及显示内容</span></span><br><span class="line">        <span class="keyword">this</span>.initColumns()</span><br><span class="line">        <span class="comment">//this.addPro()</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    componentDidMount()&#123;</span><br><span class="line">        <span class="keyword">this</span>.getProducts(<span class="number">1</span>)</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    render()&#123;</span><br><span class="line">        <span class="comment">//state数据解构，简化使用</span></span><br><span class="line">        <span class="keyword">const</span> &#123;products&#125;=<span class="keyword">this</span>.state</span><br><span class="line"></span><br><span class="line">        <span class="comment">//card左侧内容</span></span><br><span class="line">        <span class="keyword">const</span> title=(</span><br><span class="line">            &lt;span&gt;</span><br><span class="line">                &lt;Select value=<span class="string">'1'</span> style=&#123;&#123;<span class="attr">width</span>:<span class="number">150</span>,&#125;&#125;&gt;</span><br><span class="line">                    &lt;Option value=<span class="string">'1'</span>&gt;按名称搜索&lt;<span class="regexp">/Option&gt;</span></span><br><span class="line"><span class="regexp">                    &lt;Option value='2'&gt;按描述搜索&lt;/</span>Option&gt;</span><br><span class="line">                &lt;<span class="regexp">/Select&gt;</span></span><br><span class="line"><span class="regexp">                &lt;Input placeholder='关键字' style=&#123;&#123;width:150,margin:'0 8px'&#125;&#125; /</span>&gt;</span><br><span class="line">                &lt;Button type=<span class="string">'primary'</span>&gt;搜索&lt;<span class="regexp">/Button&gt;</span></span><br><span class="line"><span class="regexp">            &lt;/</span>span&gt;</span><br><span class="line">        )</span><br><span class="line">        <span class="comment">//card右侧内容</span></span><br><span class="line">        <span class="keyword">const</span> extra=(</span><br><span class="line">            &lt;Button type=<span class="string">'primary'</span> onClick=&#123;() =&gt; <span class="keyword">this</span>.props.history.push(<span class="string">'/product/add-update'</span>)&#125;&gt;</span><br><span class="line">                &lt;Icon type=<span class="string">'plus'</span>/&gt;</span><br><span class="line">                添加商品</span><br><span class="line">            &lt;<span class="regexp">/Button&gt;</span></span><br><span class="line"><span class="regexp">        )</span></span><br><span class="line"><span class="regexp">        return(</span></span><br><span class="line"><span class="regexp">            &lt;Card title=&#123;title&#125; extra=&#123;extra&#125;&gt;</span></span><br><span class="line"><span class="regexp">                &lt;Table </span></span><br><span class="line"><span class="regexp">                bordered </span></span><br><span class="line"><span class="regexp">                rowKey='_id'</span></span><br><span class="line"><span class="regexp">                dataSource=&#123;products&#125; </span></span><br><span class="line"><span class="regexp">                columns=&#123;this.columns&#125; /</span>&gt;</span><br><span class="line">            &lt;<span class="regexp">/Card&gt;</span></span><br><span class="line"><span class="regexp">        )</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure>
<h3 id="商品管理主页效果http-localhost-3000-product"><a href="#商品管理主页效果http-localhost-3000-product" class="headerlink" title="商品管理主页效果http://localhost:3000/product"></a>商品管理主页效果<a href="http://localhost:3000/product" target="_blank" rel="noopener">http://localhost:3000/product</a></h3><p><img src="https://img-blog.csdnimg.cn/20200226162948529.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTAxMzIxNzc=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h2 id="2-商品添加组件src-pages-product-add-update-jsx"><a href="#2-商品添加组件src-pages-product-add-update-jsx" class="headerlink" title="2.商品添加组件src/pages/product/add-update.jsx"></a>2.商品添加组件src/pages/product/add-update.jsx</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React,&#123;Component&#125; <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">    Card,</span><br><span class="line">    Icon,</span><br><span class="line">    Form,</span><br><span class="line">    Input,</span><br><span class="line">    Cascader,<span class="comment">//级联组件</span></span><br><span class="line">    Button,</span><br><span class="line">    message,</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">'antd'</span></span><br><span class="line"><span class="keyword">import</span> LinkButton <span class="keyword">from</span> <span class="string">'../../../components/link-button'</span></span><br><span class="line"><span class="keyword">import</span> &#123;reqCategorys,reqAddUpdatePro&#125; <span class="keyword">from</span> <span class="string">'../../../api'</span> <span class="comment">//【0】引入添加修改产品函数</span></span><br><span class="line"><span class="keyword">import</span> PicturesWall <span class="keyword">from</span> <span class="string">'./pictures-wall'</span></span><br><span class="line"><span class="keyword">import</span> RichText <span class="keyword">from</span> <span class="string">'./rich-text'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123;Item&#125;=Form</span><br><span class="line"><span class="keyword">const</span> &#123;TextArea&#125;=Input</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AddUpdate</span> <span class="keyword">extends</span> <span class="title">Component</span></span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(props)&#123;</span><br><span class="line">        <span class="keyword">super</span>(props)</span><br><span class="line">        <span class="comment">//创建用于存放指定ref标识的标签对象容器</span></span><br><span class="line">        <span class="keyword">this</span>.pw=React.createRef()</span><br><span class="line">        <span class="comment">//</span></span><br><span class="line">        <span class="keyword">this</span>.editor=React.createRef()</span><br><span class="line"></span><br><span class="line">       <span class="keyword">this</span>.state=&#123;</span><br><span class="line">        options:[], <span class="comment">//定义状态选项</span></span><br><span class="line">        &#125; </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    <span class="comment">//把获取到的categorys解析为options</span></span><br><span class="line">    initOptions=<span class="function">(<span class="params">categorys</span>)=&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">const</span> options = categorys.map(<span class="function">(<span class="params">v,k</span>)=&gt;</span>(&#123; <span class="comment">//返回一个字典，要额外加一个括号            </span></span><br><span class="line">                value: v._id,</span><br><span class="line">                label: v.name,</span><br><span class="line">                isLeaf: <span class="literal">false</span>,             </span><br><span class="line">        &#125;))</span><br><span class="line"></span><br><span class="line">        <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">            options</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//获取categorys</span></span><br><span class="line">    getCategorys= <span class="keyword">async</span> (parentId)=&gt;&#123;</span><br><span class="line">        <span class="keyword">const</span> result = <span class="keyword">await</span> reqCategorys(parentId)</span><br><span class="line">        <span class="keyword">if</span>(result.status===<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">const</span> categorys = result.data</span><br><span class="line">            <span class="comment">// 如果是一级分类列表</span></span><br><span class="line">            <span class="keyword">if</span> (parentId===<span class="string">'0'</span>) &#123;</span><br><span class="line">                <span class="keyword">this</span>.initOptions(categorys)</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123; <span class="comment">// 二级列表</span></span><br><span class="line">                <span class="keyword">return</span> categorys  <span class="comment">// 返回二级列表 ==&gt; 当前async函数返回的promsie就会成功且value为categorys</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            message.error(<span class="string">'产品分类获取失败请刷新重试'</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//自定义验证：商品价格大于0函数</span></span><br><span class="line">    valiPrice=<span class="function">(<span class="params">rule, value, callback</span>)=&gt;</span>&#123;</span><br><span class="line">        <span class="comment">//console.log(value,typeof(value))  //在价格输入-1即显示是string类型</span></span><br><span class="line">        <span class="keyword">if</span>(value*<span class="number">1</span>&gt;<span class="number">0</span>)&#123; <span class="comment">//字符串*1：将字符串转化为数字类型</span></span><br><span class="line">             callback()</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            callback(<span class="string">'价格必须大于0'</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    onChange = <span class="function">(<span class="params">value, selectedOptions</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(value, selectedOptions);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      </span><br><span class="line">    <span class="comment">//加载二级分类列表函数</span></span><br><span class="line">    loadData = <span class="keyword">async</span> selectedOptions =&gt; &#123;</span><br><span class="line">        <span class="keyword">const</span> targetOption = selectedOptions[<span class="number">0</span>];</span><br><span class="line">        targetOption.loading = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 根据选中的分类, 请求获取二级分类列表</span></span><br><span class="line">        <span class="keyword">const</span> subCategorys = <span class="keyword">await</span> <span class="keyword">this</span>.getCategorys(targetOption.value)</span><br><span class="line">        <span class="comment">// 隐藏loading</span></span><br><span class="line">        targetOption.loading = <span class="literal">false</span></span><br><span class="line">        <span class="comment">// 二级分类数组有数据</span></span><br><span class="line">        <span class="keyword">if</span> (subCategorys &amp;&amp; subCategorys.length&gt;<span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">// 生成一个二级列表的options</span></span><br><span class="line">        <span class="keyword">const</span> childOptions = subCategorys.map(<span class="function"><span class="params">c</span> =&gt;</span> (&#123;</span><br><span class="line">            value: c._id,</span><br><span class="line">            label: c.name,</span><br><span class="line">            isLeaf: <span class="literal">true</span></span><br><span class="line">        &#125;))</span><br><span class="line">        <span class="comment">// 关联到当前option上</span></span><br><span class="line">        targetOption.children = childOptions</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123; <span class="comment">// 当前选中的分类没有二级分类</span></span><br><span class="line">            targetOption.isLeaf = <span class="literal">true</span></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 更新options状态</span></span><br><span class="line">            <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">                options: [...this.state.options],</span><br><span class="line">            &#125;)        </span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//产品表单提交</span></span><br><span class="line">     submit=<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.props.form.validateFields(<span class="keyword">async</span>(error,values)=&gt;&#123;</span><br><span class="line">            </span><br><span class="line">                       </span><br><span class="line">            <span class="keyword">if</span>(!error)&#123;</span><br><span class="line">                <span class="comment">//【1】收集数据, 并封装成product对象</span></span><br><span class="line">                <span class="keyword">const</span> &#123;name,desc,price,categoryIds&#125;=values</span><br><span class="line">                <span class="keyword">let</span> pCategoryId,categoryId</span><br><span class="line">                <span class="keyword">if</span>(categoryIds.length===<span class="number">1</span>)&#123;<span class="comment">//如果长度为1说明只有一级产品分类</span></span><br><span class="line">                    pCategoryId=<span class="string">'0'</span></span><br><span class="line">                    categoryId=categoryIds[<span class="number">0</span>]</span><br><span class="line">                &#125;<span class="keyword">else</span>&#123;<span class="comment">//否则说明有二级产品分类</span></span><br><span class="line">                    pCategoryId=categoryIds[<span class="number">0</span>] </span><br><span class="line">                    categoryId=categoryIds[<span class="number">1</span>]</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">//获取子组件的相关信息</span></span><br><span class="line">                <span class="keyword">const</span> imgs=<span class="keyword">this</span>.pw.current.getImgs()  </span><br><span class="line">                <span class="comment">//获取子组件商品详情的带html标签的字符串数据</span></span><br><span class="line">                <span class="keyword">const</span> detail=<span class="keyword">this</span>.editor.current.getDetail()       </span><br><span class="line">               </span><br><span class="line">                <span class="keyword">const</span> product=&#123;name,desc,price,imgs,detail,pCategoryId,categoryId&#125;</span><br><span class="line">                <span class="comment">//输出看看</span></span><br><span class="line">                <span class="built_in">console</span>.log(product)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                <span class="comment">//【2】调用接口请求函数去添加/更新</span></span><br><span class="line">                <span class="keyword">const</span> result=<span class="keyword">await</span> reqAddUpdatePro(product)</span><br><span class="line">                <span class="keyword">if</span>(result.status===<span class="number">0</span>)&#123;<span class="comment">//【3】根据结果提示是否添加/更新成功</span></span><br><span class="line">                    message.success(<span class="string">'添加产品成功'</span>)</span><br><span class="line">                &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                    message.error(<span class="string">'添加产品失败'</span>)</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;                </span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">'验证失败，请检查产品数据'</span>)</span><br><span class="line">            &#125;   </span><br><span class="line">            </span><br><span class="line">            </span><br><span class="line">        &#125;)    </span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">      </span><br><span class="line">    componentDidMount()&#123;</span><br><span class="line">        <span class="keyword">this</span>.getCategorys(<span class="string">'0'</span>) <span class="comment">//加载categorys并初始化为</span></span><br><span class="line">    &#125;</span><br><span class="line">      </span><br><span class="line">    render()&#123;</span><br><span class="line">        <span class="comment">//card左</span></span><br><span class="line">        <span class="keyword">const</span> title=(</span><br><span class="line">            &lt;span&gt;</span><br><span class="line">                &lt;LinkButton&gt;</span><br><span class="line">                    &lt;Icon type=<span class="string">'arrow-left'</span> style=&#123;&#123;<span class="attr">fontSize</span>:<span class="number">20</span>&#125;&#125; /&gt;                   </span><br><span class="line">                &lt;<span class="regexp">/LinkButton&gt;</span></span><br><span class="line"><span class="regexp">                &lt;span&gt;添加商品&lt;/</span>span&gt;</span><br><span class="line">            &lt;<span class="regexp">/span&gt;</span></span><br><span class="line"><span class="regexp">        )</span></span><br><span class="line"><span class="regexp">        /</span><span class="regexp">/card右</span></span><br><span class="line"><span class="regexp">        </span></span><br><span class="line"><span class="regexp">        /</span><span class="regexp">/form内的Item的布局样式</span></span><br><span class="line"><span class="regexp">        const formItemLayout = &#123;</span></span><br><span class="line"><span class="regexp">            labelCol: &#123;span: 2&#125;, /</span><span class="regexp">/左侧label标签的宽度占2个格栅</span></span><br><span class="line"><span class="regexp">            wrapperCol: &#123;span: 8 &#125;, /</span><span class="regexp">/右侧（输入框外面有一层包裹）占8个格栅</span></span><br><span class="line"><span class="regexp">          &#125;;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">          /</span><span class="regexp">/获取from的getFieldDecorator</span></span><br><span class="line"><span class="regexp">        const &#123;getFieldDecorator&#125;=this.props.form</span></span><br><span class="line"><span class="regexp">        return(</span></span><br><span class="line"><span class="regexp">            &lt;Card title=&#123;title&#125; extra=''&gt;</span></span><br><span class="line"><span class="regexp">                &#123;/</span>* 使用组件的扩展属性语法 *<span class="regexp">/&#125;</span></span><br><span class="line"><span class="regexp">                &lt;Form &#123;...formItemLayout&#125;&gt;</span></span><br><span class="line"><span class="regexp">                    &#123;/</span>* label指定商品前面标签名,placeholder指定输入框提示内容 *<span class="regexp">/&#125;</span></span><br><span class="line"><span class="regexp">                    &lt;Item label='商品名称'&gt;</span></span><br><span class="line"><span class="regexp">                        &#123;/</span><span class="regexp">/商品名规则</span></span><br><span class="line"><span class="regexp">                            getFieldDecorator('name',&#123;</span></span><br><span class="line"><span class="regexp">                                initialValue:'',</span></span><br><span class="line"><span class="regexp">                                rules:[</span></span><br><span class="line"><span class="regexp">                                    &#123;required:true,message:'商品名称必须填写'&#125;</span></span><br><span class="line"><span class="regexp">                                ]</span></span><br><span class="line"><span class="regexp">                            &#125;)(&lt;Input  placeholder='输入商品名' /</span>&gt;)</span><br><span class="line">                        &#125;</span><br><span class="line">                        </span><br><span class="line">                    &lt;<span class="regexp">/Item&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">                    &lt;Item label='商品描述'&gt;</span></span><br><span class="line"><span class="regexp">                        &#123;/</span><span class="regexp">/autoSize指定文本域最小高度和最大高度</span></span><br><span class="line"><span class="regexp">                            getFieldDecorator('desc',&#123;</span></span><br><span class="line"><span class="regexp">                                initialValue:'',</span></span><br><span class="line"><span class="regexp">                                rules:[</span></span><br><span class="line"><span class="regexp">                                    &#123;required:true,message:'商品描述必须输入'&#125;</span></span><br><span class="line"><span class="regexp">                                ]</span></span><br><span class="line"><span class="regexp">                            &#125;)(&lt;TextArea placeholder='输入商品描述' autoSize=&#123;&#123; minRows: 2, maxRows: 6 &#125;&#125; /</span>&gt;)</span><br><span class="line">                        &#125;                       </span><br><span class="line">                    &lt;<span class="regexp">/Item&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">                    &lt;Item label='商品价格'&gt;</span></span><br><span class="line"><span class="regexp">                        &#123;/</span><span class="regexp">/validator自定义验证规则要求价格大于0</span></span><br><span class="line"><span class="regexp">                            getFieldDecorator('price',&#123;</span></span><br><span class="line"><span class="regexp">                                initialValue:'',</span></span><br><span class="line"><span class="regexp">                                rules:[</span></span><br><span class="line"><span class="regexp">                                    &#123;required:true,message:'价格必须输入'&#125;,</span></span><br><span class="line"><span class="regexp">                                    &#123;validator:(rule,value,callback)=&gt;&#123;</span></span><br><span class="line"><span class="regexp">                                        if(value*1&gt;0)&#123; //字符串*1：将字符串转化为数字类型</span></span><br><span class="line"><span class="regexp">                                            callback() //此处必须进行回调函数调用，否则将无法通过验证</span></span><br><span class="line"><span class="regexp">                                       &#125;else&#123;</span></span><br><span class="line"><span class="regexp">                                           callback('价格必须大于0')</span></span><br><span class="line"><span class="regexp">                                       &#125;</span></span><br><span class="line"><span class="regexp">                                    &#125;&#125;,</span></span><br><span class="line"><span class="regexp">                                ]</span></span><br><span class="line"><span class="regexp">                            &#125;)(&lt;Input type='number' placeholder='输入商品价格' addonAfter="元" /</span>&gt;)</span><br><span class="line">                        &#125;                        </span><br><span class="line">                    &lt;<span class="regexp">/Item&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">                    &lt;Item label="商品分类"&gt;</span></span><br><span class="line"><span class="regexp">                        &#123;</span></span><br><span class="line"><span class="regexp">                        getFieldDecorator('categoryIds', &#123;</span></span><br><span class="line"><span class="regexp">                            initialValue: [],</span></span><br><span class="line"><span class="regexp">                            rules: [</span></span><br><span class="line"><span class="regexp">                            &#123;required: true, message: '必须指定商品分类'&#125;,</span></span><br><span class="line"><span class="regexp">                            ]</span></span><br><span class="line"><span class="regexp">                        &#125;)(&lt;Cascader</span></span><br><span class="line"><span class="regexp">                            placeholder='请指定商品分类'</span></span><br><span class="line"><span class="regexp">                            options=&#123;this.state.options&#125;  /</span>*需要显示的列表数据数组*<span class="regexp">/</span></span><br><span class="line"><span class="regexp">                            loadData=&#123;this.loadData&#125; /</span>*当选择某个列表项, 加载下一级列表的监听回调*<span class="regexp">/</span></span><br><span class="line"><span class="regexp">                            /</span>&gt;</span><br><span class="line">                        )</span><br><span class="line">                        &#125;</span><br><span class="line"></span><br><span class="line">                    &lt;<span class="regexp">/Item&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">                    &lt;Item label='商品图片'&gt;</span></span><br><span class="line"><span class="regexp">                        &lt;PicturesWall ref=&#123;this.pw&#125; /</span>&gt;</span><br><span class="line">                    &lt;<span class="regexp">/Item&gt; </span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">                    &lt;Item label='商品详情' labelCol=&#123;&#123;span: 2&#125;&#125; wrapperCol=&#123;&#123;span: 20&#125;&#125;&gt;</span></span><br><span class="line"><span class="regexp">                        &#123;/</span>**指定把richtext对象装进editor里 *<span class="regexp">/&#125;</span></span><br><span class="line"><span class="regexp">                        &lt;RichText ref=&#123;this.editor&#125; /</span>&gt;</span><br><span class="line">                    &lt;<span class="regexp">/Item&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">                    &lt;Item &gt;</span></span><br><span class="line"><span class="regexp">                        &lt;Button type='primary' onClick=&#123;this.submit&#125;&gt;提交&lt;/</span>Button&gt;</span><br><span class="line">                    &lt;<span class="regexp">/Item&gt;  </span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">                &lt;/</span>Form&gt;</span><br><span class="line">            &lt;<span class="regexp">/Card&gt;</span></span><br><span class="line"><span class="regexp">        )</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp">export default Form.create()(AddUpdate) /</span><span class="regexp">/包装当前类使得到form的的强大函数</span></span><br></pre></td></tr></table></figure>
<h3 id="商品添加页效果：http-localhost-3000-product-add-update"><a href="#商品添加页效果：http-localhost-3000-product-add-update" class="headerlink" title="商品添加页效果：http://localhost:3000/product/add-update"></a>商品添加页效果：<a href="http://localhost:3000/product/add-update" target="_blank" rel="noopener">http://localhost:3000/product/add-update</a></h3><p><img src="https://img-blog.csdnimg.cn/20200226163215296.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTAxMzIxNzc=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h2 id="3-异步请求函数src-api-index-js"><a href="#3-异步请求函数src-api-index-js" class="headerlink" title="3.异步请求函数src/api/index.js"></a>3.异步请求函数src/api/index.js</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> ajax <span class="keyword">from</span> <span class="string">'./ajax'</span></span><br><span class="line"><span class="keyword">import</span> jsonp <span class="keyword">from</span> <span class="string">'jsonp'</span></span><br><span class="line"><span class="keyword">import</span> &#123;message&#125; <span class="keyword">from</span> <span class="string">'antd'</span> <span class="comment">//借用antd返回信息组件</span></span><br><span class="line"><span class="comment">// const BASE = 'http://localhost:5000'</span></span><br><span class="line"><span class="keyword">const</span> BASE = <span class="string">''</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//导出一个函数，第1种写法</span></span><br><span class="line"><span class="comment">//登录接口函数</span></span><br><span class="line"><span class="comment">// export function reqLogin(username,password)&#123;</span></span><br><span class="line"><span class="comment">//     return ajax('login',&#123;username,password&#125;,'POST')</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//导出一个函数，第2种写法</span></span><br><span class="line"><span class="comment">// 登录接口函数</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> reqLogin=<span class="function">(<span class="params">username,password</span>)=&gt;</span>ajax(BASE+<span class="string">'login'</span>,&#123;username,password&#125;,<span class="string">'POST'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//获取产品一级/二级分类列表接口</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> reqCategorys=<span class="function">(<span class="params">parentId</span>)=&gt;</span>ajax(BASE+<span class="string">'/manage/category/list'</span>,&#123;parentId&#125;)</span><br><span class="line"><span class="comment">//添加产品分类接口</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> reqAddCategory=<span class="function">(<span class="params">parentId,categoryName</span>)=&gt;</span>ajax(BASE+<span class="string">'/manage/category/add'</span>,&#123;parentId,categoryName&#125;,<span class="string">'POST'</span>)</span><br><span class="line"><span class="comment">//修改产品分类接口</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> reqUpdateCategory=<span class="function">(<span class="params">&#123;categoryId,categoryName&#125;</span>)=&gt;</span>ajax(BASE+<span class="string">'/manage/category/update'</span>,&#123;categoryId,categoryName&#125;,<span class="string">'POST'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//获取产品列表</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> reqProducts=<span class="function">(<span class="params">&#123;pageNum,pageSize&#125;</span>)=&gt;</span>ajax(BASE+<span class="string">'/manage/product/list'</span>,&#123;pageNum,pageSize&#125;)</span><br><span class="line"><span class="comment">//添加商品/修改商品：二合一接口，如果参数存在._id则为修改商品，否则为添加商品</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> reqAddUpdatePro=<span class="function">(<span class="params">product</span>)=&gt;</span>ajax(BASE+<span class="string">'/manage/product/'</span>+(product._id?<span class="string">'update'</span>:<span class="string">'add'</span>),product,<span class="string">'POST'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 删除服务器上指定名称图片</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> reqDeletPic=<span class="function">(<span class="params">name</span>)=&gt;</span>ajax(BASE+<span class="string">'/manage/img/delete'</span>,&#123;name&#125;,<span class="string">'POST'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 天气接口</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> reqWeather=<span class="function">(<span class="params">city</span>) =&gt;</span> &#123;    </span><br><span class="line">    <span class="keyword">const</span> url = <span class="string">`http://api.map.baidu.com/telematics/v3/weather?location=<span class="subst">$&#123;city&#125;</span>&amp;output=json&amp;ak=3p49MVra6urFRGOT9s8UBWr2`</span></span><br><span class="line">    <span class="comment">//返回一个promise函数</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve,reject</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">//发送一个jsonp请求</span></span><br><span class="line">        jsonp(url,&#123;&#125;,(err,data) =&gt; &#123;</span><br><span class="line">            <span class="comment">//输出请求的数据到控制台</span></span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">'jsonp()'</span>, err, data)</span><br><span class="line">            <span class="comment">//如果请求成功</span></span><br><span class="line">            <span class="keyword">if</span>(!err &amp;&amp; data.status===<span class="string">'success'</span>)&#123;</span><br><span class="line">                <span class="comment">//从数据中解构取出图片、天气</span></span><br><span class="line">                <span class="keyword">const</span> &#123;dayPictureUrl,weather&#125;=data.results[<span class="number">0</span>].weather_data[<span class="number">0</span>]</span><br><span class="line">                <span class="comment">//异步返回图片、天气给调用函数者</span></span><br><span class="line">                resolve(&#123;dayPictureUrl,weather&#125;)</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;<span class="comment">//如果请求失败</span></span><br><span class="line">                message.error(<span class="string">'天气信息获取失败'</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//reqWeather('上海')</span></span><br></pre></td></tr></table></figure>
<h2 id="4-商品路由页src-page-pruduct-index-jsx"><a href="#4-商品路由页src-page-pruduct-index-jsx" class="headerlink" title="4.商品路由页src/page/pruduct/index.jsx"></a>4.商品路由页src/page/pruduct/index.jsx</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React,&#123;Component&#125; <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">'./index.less'</span></span><br><span class="line"><span class="keyword">import</span> &#123;Switch,Route,Redirect&#125; <span class="keyword">from</span> <span class="string">'react-router-dom'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> Home <span class="keyword">from</span> <span class="string">'./home'</span></span><br><span class="line"><span class="keyword">import</span> AddUpdate <span class="keyword">from</span> <span class="string">'./add-update'</span></span><br><span class="line"><span class="keyword">import</span> Detail <span class="keyword">from</span> <span class="string">'./detail'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">Product</span> <span class="keyword">extends</span> <span class="title">Component</span></span>&#123;</span><br><span class="line">    render()&#123;</span><br><span class="line">        <span class="keyword">return</span>(</span><br><span class="line">            &lt;Switch&gt;</span><br><span class="line">                &#123;<span class="comment">/* 为防止不能匹配到product/xxx，加上exact */</span>&#125;</span><br><span class="line">                &lt;Route exact path=<span class="string">'/product'</span> component=&#123;Home&#125; /&gt;</span><br><span class="line">                &lt;Route path=<span class="string">'/product/add-update'</span> component=&#123;AddUpdate&#125; /&gt;</span><br><span class="line">                &lt;Route path=<span class="string">'/product/detail'</span> component=&#123;Detail&#125; /&gt;</span><br><span class="line">                &#123;<span class="comment">/* 如果以上都不匹配则跳转到产品首页 */</span>&#125;</span><br><span class="line">                &lt;Redirect to=<span class="string">'/product'</span> /&gt;</span><br><span class="line">            &lt;<span class="regexp">/Switch&gt;</span></span><br><span class="line"><span class="regexp">        )</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure>
<h2 id="5-富文件编辑组件rich-text-jsx"><a href="#5-富文件编辑组件rich-text-jsx" class="headerlink" title="5.富文件编辑组件rich-text.jsx"></a>5.富文件编辑组件rich-text.jsx</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; EditorState, convertToRaw &#125; <span class="keyword">from</span> <span class="string">'draft-js'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Editor &#125; <span class="keyword">from</span> <span class="string">'react-draft-wysiwyg'</span>;</span><br><span class="line"><span class="keyword">import</span> draftToHtml <span class="keyword">from</span> <span class="string">'draftjs-to-html'</span>;</span><br><span class="line"><span class="keyword">import</span> htmlToDraft <span class="keyword">from</span> <span class="string">'html-to-draftjs'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'react-draft-wysiwyg/dist/react-draft-wysiwyg.css'</span> <span class="comment">//引入编辑器样式，否则会乱七八糟</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">RichText</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  state = &#123;</span><br><span class="line">    editorState: EditorState.createEmpty(),</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  onEditorStateChange=<span class="function">(<span class="params">editorState</span>) =&gt;</span> &#123; <span class="comment">//标签写法改成如左写法</span></span><br><span class="line">    <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">      editorState,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line"> <span class="comment">//让父组件获取到当前组件的信息</span></span><br><span class="line"> getDetail=<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">     <span class="keyword">return</span> draftToHtml(convertToRaw(<span class="keyword">this</span>.state.editorState.getCurrentContent()))</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> <span class="comment">//【2】图片上传加一个上传按钮</span></span><br><span class="line"> uploadImageCallBack = <span class="function">(<span class="params">file</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(</span><br><span class="line">      (resolve, reject) =&gt; &#123;</span><br><span class="line">        <span class="keyword">const</span> xhr = <span class="keyword">new</span> XMLHttpRequest()</span><br><span class="line">        xhr.open(<span class="string">'POST'</span>, <span class="string">'/manage/img/upload'</span>)</span><br><span class="line">        <span class="keyword">const</span> data = <span class="keyword">new</span> FormData()</span><br><span class="line">        data.append(<span class="string">'image'</span>, file)</span><br><span class="line">        xhr.send(data)</span><br><span class="line">        xhr.addEventListener(<span class="string">'load'</span>, () =&gt; &#123;</span><br><span class="line">          <span class="keyword">const</span> response = <span class="built_in">JSON</span>.parse(xhr.responseText)</span><br><span class="line">          <span class="keyword">const</span> url = response.data.url <span class="comment">// 得到图片的url</span></span><br><span class="line">          resolve(&#123;<span class="attr">data</span>: &#123;<span class="attr">link</span>: url&#125;&#125;)</span><br><span class="line">        &#125;)</span><br><span class="line">        xhr.addEventListener(<span class="string">'error'</span>, () =&gt; &#123;</span><br><span class="line">          <span class="keyword">const</span> error = <span class="built_in">JSON</span>.parse(xhr.responseText)</span><br><span class="line">          reject(error)</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; editorState &#125; = <span class="keyword">this</span>.state;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;Editor</span><br><span class="line">          editorState=&#123;editorState&#125;</span><br><span class="line">          wrapperClassName=<span class="string">"demo-wrapper"</span></span><br><span class="line">          editorClassName=<span class="string">"demo-editor"</span></span><br><span class="line">          editorStyle=&#123;&#123;<span class="attr">border</span>: <span class="string">'1px solid black'</span>, <span class="attr">minHeight</span>: <span class="number">200</span>, <span class="attr">paddingLeft</span>: <span class="number">10</span>&#125;&#125;</span><br><span class="line">          onEditorStateChange=&#123;<span class="keyword">this</span>.onEditorStateChange&#125;</span><br><span class="line">          <span class="comment">/**【1】图片上传按钮配置*/</span></span><br><span class="line">          toolbar=&#123;&#123;</span><br><span class="line">            image: &#123; <span class="attr">uploadCallback</span>: <span class="keyword">this</span>.uploadImageCallBack, <span class="attr">alt</span>: &#123; <span class="attr">present</span>: <span class="literal">true</span>, <span class="attr">mandatory</span>: <span class="literal">true</span> &#125; &#125;,</span><br><span class="line">          &#125;&#125;</span><br><span class="line">        /&gt;</span><br><span class="line">        &lt;textarea</span><br><span class="line">          disabled</span><br><span class="line">          value=&#123;draftToHtml(convertToRaw(editorState.getCurrentContent()))&#125;</span><br><span class="line">        /&gt;</span><br><span class="line">      &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    );</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure>
<h2 id="6-图片上传组件src-page-product-pictures-wall-jsx"><a href="#6-图片上传组件src-page-product-pictures-wall-jsx" class="headerlink" title="6.图片上传组件src/page/product/pictures-wall.jsx"></a>6.图片上传组件src/page/product/pictures-wall.jsx</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React,&#123;Component&#125; <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">import</span> &#123; Upload, Icon, Modal,message &#125; <span class="keyword">from</span> <span class="string">'antd'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;reqDeletPic&#125; <span class="keyword">from</span> <span class="string">'../../../api'</span> <span class="comment">//【1】</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getBase64</span>(<span class="params">file</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> reader = <span class="keyword">new</span> FileReader();</span><br><span class="line">    reader.readAsDataURL(file);</span><br><span class="line">    reader.onload = <span class="function"><span class="params">()</span> =&gt;</span> resolve(reader.result);</span><br><span class="line">    reader.onerror = <span class="function"><span class="params">error</span> =&gt;</span> reject(error);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">PicturesWall</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(props)&#123;</span><br><span class="line">    <span class="keyword">super</span>(props)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>.state=&#123;</span><br><span class="line">      previewVisible: <span class="literal">false</span>,</span><br><span class="line">      previewImage: <span class="string">''</span>,</span><br><span class="line">      fileList: []</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">  获取所有已上传图片文件名的数组</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  getImgs  = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">//返回状态中的文件列表中每个文件的文件名</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.state.fileList.map(<span class="function"><span class="params">file</span> =&gt;</span> file.name)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// state = &#123;</span></span><br><span class="line">  <span class="comment">//   previewVisible: false,</span></span><br><span class="line">  <span class="comment">//   previewImage: '',</span></span><br><span class="line">  <span class="comment">//   fileList: [</span></span><br><span class="line">  <span class="comment">//   //   &#123;</span></span><br><span class="line">  <span class="comment">//   //     uid: '-1',</span></span><br><span class="line">  <span class="comment">//   //     name: 'image.png',</span></span><br><span class="line">  <span class="comment">//   //     status: 'done',</span></span><br><span class="line">  <span class="comment">//   //     url: 'https://zos.alipayobjects.com/rmsportal/jkjgkEfvpUPVyRjUImniVslZfWPnJuuZ.png',</span></span><br><span class="line">  <span class="comment">//   //   &#125;</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">//    ],</span></span><br><span class="line">  <span class="comment">// &#125;;</span></span><br><span class="line"></span><br><span class="line">  handleCancel = <span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">this</span>.setState(&#123; <span class="attr">previewVisible</span>: <span class="literal">false</span> &#125;);</span><br><span class="line"></span><br><span class="line">  handlePreview = <span class="keyword">async</span> file =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (!file.url &amp;&amp; !file.preview) &#123;</span><br><span class="line">      file.preview = <span class="keyword">await</span> getBase64(file.originFileObj);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">      previewImage: file.url || file.preview,</span><br><span class="line">      previewVisible: <span class="literal">true</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">  file: 当前操作的图片文件(上传/删除)</span></span><br><span class="line"><span class="comment">  fileList: 所有已上传图片文件对象的数组</span></span><br><span class="line"><span class="comment">  官方文档：https://ant.design/components/upload-cn/#onChange</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  handleChange = <span class="keyword">async</span> (&#123; file,fileList &#125;) =&gt; &#123; <span class="comment">//【3】async</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'handlechange:'</span>,file.status, fileList.length, file===fileList[fileList.length<span class="number">-1</span>])</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 一旦上传成功, 将当前上传的file的信息修正成最新的(name, url)</span></span><br><span class="line">    <span class="keyword">if</span>(file.status===<span class="string">'done'</span>)&#123;</span><br><span class="line">      <span class="keyword">const</span> result = file.response  <span class="comment">// &#123;status: 0, data: &#123;name: 'xxx.jpg', url: '图片地址'&#125;&#125;</span></span><br><span class="line">      <span class="keyword">if</span>(result.status===<span class="number">0</span>)&#123;</span><br><span class="line">        message.success(<span class="string">'上传成功'</span>)</span><br><span class="line">        <span class="keyword">const</span> &#123;name, url&#125; = result.data</span><br><span class="line">        file = fileList[fileList.length<span class="number">-1</span>]</span><br><span class="line">        file.name = name</span><br><span class="line">        file.url = url           </span><br><span class="line">      &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">      message.error(<span class="string">'上传错误'</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span>(file.status===<span class="string">'removed'</span>)&#123;<span class="comment">//【2】如果文件的状态为移除，则删除服务器上对应图片名图片</span></span><br><span class="line">      <span class="keyword">const</span> result=<span class="keyword">await</span> reqDeletPic(file.name)</span><br><span class="line">      <span class="keyword">if</span>(result.status===<span class="number">0</span>)&#123;</span><br><span class="line">        message.success(<span class="string">'图片删除成功：'</span>+file.name)</span><br><span class="line">      &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        message.error(<span class="string">'图片删除失败：'</span>+file.name)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 在操作(上传/删除)过程中不断更新fileList状态</span></span><br><span class="line">    <span class="keyword">this</span>.setState(&#123; fileList &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; previewVisible, previewImage, fileList &#125; = <span class="keyword">this</span>.state;</span><br><span class="line">    <span class="keyword">const</span> uploadButton = (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;Icon type=<span class="string">"plus"</span> /&gt;</span><br><span class="line">        &lt;div className=<span class="string">"ant-upload-text"</span>&gt;Upload&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>div&gt;</span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div className=<span class="string">"clearfix"</span>&gt;</span><br><span class="line">        &lt;Upload</span><br><span class="line">          action=<span class="string">"/manage/img/upload"</span> <span class="comment">/**上传图片的接口地址 */</span></span><br><span class="line">          accept=<span class="string">'image/*'</span>  <span class="comment">/**只接受图片格式 */</span></span><br><span class="line">          name=<span class="string">'image'</span> <span class="comment">/**请求参数名，来自api说明上传图片的参数类型 */</span></span><br><span class="line">          listType=<span class="string">"picture-card"</span> <span class="comment">/*卡片样式：text, picture 和 picture-card*/</span></span><br><span class="line">          fileList=&#123;fileList&#125; <span class="comment">/*所有已上传图片文件对象的数组*/</span></span><br><span class="line">          onPreview=&#123;<span class="keyword">this</span>.handlePreview&#125; <span class="comment">/**显示图片预览函数 */</span></span><br><span class="line">          onChange=&#123;<span class="keyword">this</span>.handleChange&#125; <span class="comment">/**上传/删除图片函数 */</span></span><br><span class="line">        &gt;</span><br><span class="line">          &#123;<span class="comment">//控制图片上传按钮最多5个</span></span><br><span class="line">          fileList.length &gt;= <span class="number">5</span> ? <span class="literal">null</span> : uploadButton&#125;</span><br><span class="line">        &lt;<span class="regexp">/Upload&gt;</span></span><br><span class="line"><span class="regexp">        &lt;Modal visible=&#123;previewVisible&#125; footer=&#123;null&#125; onCancel=&#123;this.handleCancel&#125;&gt;</span></span><br><span class="line"><span class="regexp">          &lt;img alt="example" style=&#123;&#123; width: '100%' &#125;&#125; src=&#123;previewImage&#125; /</span>&gt;</span><br><span class="line">        &lt;<span class="regexp">/Modal&gt;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>div&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


    </div>

    
    
    

      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2020/02/24/%E3%80%8AReact%E5%90%8E%E5%8F%B0%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E5%AE%9E%E6%88%98%EF%BC%9A%E4%BA%94%E3%80%8B%E4%BA%A7%E5%93%81%E7%AE%A1%E7%90%86%EF%BC%88%E4%B8%80%EF%BC%89/" rel="prev" title="《React后台管理系统实战：五》产品管理（一）">
      <i class="fa fa-chevron-left"></i> 《React后台管理系统实战：五》产品管理（一）
    </a></div>
      <div class="post-nav-item">
    <a href="/2020/03/08/%E3%80%8AReact%E5%90%8E%E5%8F%B0%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E5%AE%9E%E6%88%98%EF%BC%9A%E4%BA%94%E3%80%8B%E4%BA%A7%E5%93%81%E7%AE%A1%E7%90%86%EF%BC%88%E4%B8%89%EF%BC%89%E5%95%86%E5%93%81%E5%88%97%E8%A1%A8%E9%A1%B5%EF%BC%88%E4%BA%A7%E5%93%81%E6%90%9C%E7%B4%A2%E5%8F%8A%E5%88%86%E9%A1%B5%EF%BC%89%E3%80%81%E5%95%86%E5%93%81%E8%AF%A6%E6%83%85%E7%BB%84%E4%BB%B6%E3%80%81%E5%95%86%E5%93%81%E4%B8%8A%E4%B8%8B%E6%9E%B6/" rel="next" title="《React后台管理系统实战：五》产品管理（三）商品列表页（产品搜索及分页）、商品详情组件、商品上下架">
      《React后台管理系统实战：五》产品管理（三）商品列表页（产品搜索及分页）、商品详情组件、商品上下架 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  

  </div>


          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#一、产品添加基础部分"><span class="nav-number">1.</span> <span class="nav-text">一、产品添加基础部分</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-home-jsx点添加按钮动作跳转到添加商品页"><span class="nav-number">1.1.</span> <span class="nav-text">1 home.jsx点添加按钮动作跳转到添加商品页</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-静态页面-add-update-jsx"><span class="nav-number">1.2.</span> <span class="nav-text">2 静态页面 add-update.jsx</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#效果：http-localhost-3000-product-add-update"><span class="nav-number">1.2.1.</span> <span class="nav-text">效果：http:&#x2F;&#x2F;localhost:3000&#x2F;product&#x2F;add-update</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-表单验证add-update-jsx"><span class="nav-number">1.3.</span> <span class="nav-text">3 表单验证add-update.jsx</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#效果：http-localhost-3000-product-add-update-1"><span class="nav-number">1.3.1.</span> <span class="nav-text">效果：http:&#x2F;&#x2F;localhost:3000&#x2F;product&#x2F;add-update</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-商品分类：Cascader级联组件"><span class="nav-number">1.4.</span> <span class="nav-text">4 商品分类：Cascader级联组件</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#代码add-update-jsx"><span class="nav-number">1.4.1.</span> <span class="nav-text">代码add-update.jsx</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#效果：http-localhost-3000-product-add-update-2"><span class="nav-number">1.4.2.</span> <span class="nav-text">效果：http:&#x2F;&#x2F;localhost:3000&#x2F;product&#x2F;add-update</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-图片上传部分"><span class="nav-number">1.5.</span> <span class="nav-text">5 图片上传部分</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#5-1图片上传组件编写pictures-walls-jsx"><span class="nav-number">1.5.1.</span> <span class="nav-text">.5.1图片上传组件编写pictures-walls.jsx</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-2-获取子组件的图片信息：父子组件传值"><span class="nav-number">1.5.2.</span> <span class="nav-text">.5.2 获取子组件的图片信息：父子组件传值</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#5-2-1-picture-wall-jsx"><span class="nav-number">1.5.2.1.</span> <span class="nav-text">.5.2.1 picture-wall.jsx</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-2-1-add-update-jsx"><span class="nav-number">1.5.2.2.</span> <span class="nav-text">.5.2.1 add-update.jsx</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#效果：提交后可看到获取到的数据"><span class="nav-number">1.5.3.</span> <span class="nav-text">效果：提交后可看到获取到的数据</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-图片删除（移除前端并删除服务器对应图片）"><span class="nav-number">1.6.</span> <span class="nav-text">6 图片删除（移除前端并删除服务器对应图片）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#第一步：编写删除api函数src-api-index-js"><span class="nav-number">1.6.1.</span> <span class="nav-text">第一步：编写删除api函数src&#x2F;api&#x2F;index.js</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#第二步-执行删除-src-pages-product-pictures-wall-jsx"><span class="nav-number">1.6.2.</span> <span class="nav-text">第二步 执行删除 src&#x2F;pages&#x2F;product&#x2F;pictures-wall.jsx</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#效果："><span class="nav-number">1.6.3.</span> <span class="nav-text">效果：</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#二、商品详情：富文本编辑器"><span class="nav-number">2.</span> <span class="nav-text">二、商品详情：富文本编辑器</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-使用基于react的富文本编程器插件库-react-draft-wysiwyg"><span class="nav-number">2.1.</span> <span class="nav-text">1 使用基于react的富文本编程器插件库: react-draft-wysiwyg</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#第一步，建新组件src-pages-product-rich-text-jsx"><span class="nav-number">2.2.</span> <span class="nav-text">第一步，建新组件src&#x2F;pages&#x2F;product&#x2F;rich-text.jsx</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#第二步，引入编辑器组件"><span class="nav-number">2.3.</span> <span class="nav-text">第二步，引入编辑器组件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#第三步，编辑器尺寸改大"><span class="nav-number">2.4.</span> <span class="nav-text">第三步，编辑器尺寸改大</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#开始编辑器尺寸非常小，原因是-src-pages-product-add-update-jsx里定义了表单的格栅尺寸："><span class="nav-number">2.4.0.1.</span> <span class="nav-text">开始编辑器尺寸非常小，原因是&#x2F;src&#x2F;pages&#x2F;product&#x2F;add-update.jsx里定义了表单的格栅尺寸：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#修改编辑器大小-src-pages-product-add-update-jsx"><span class="nav-number">2.4.0.2.</span> <span class="nav-text">修改编辑器大小&#x2F;src&#x2F;pages&#x2F;product&#x2F;add-update.jsx</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-父子传表单数据：点提交时获取富文本编辑器的内容"><span class="nav-number">2.5.</span> <span class="nav-text">2 父子传表单数据：点提交时获取富文本编辑器的内容</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#第一步，在rich-text-jsx内建立返回带html标签的字符串数据函数"><span class="nav-number">2.5.1.</span> <span class="nav-text">第一步，在rich-text.jsx内建立返回带html标签的字符串数据函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#第二步，在父组件add-update-jsx内接收子组件的数据"><span class="nav-number">2.5.2.</span> <span class="nav-text">第二步，在父组件add-update.jsx内接收子组件的数据</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#效果：填写商品信息，提交后，控制台输出"><span class="nav-number">2.5.3.</span> <span class="nav-text">效果：填写商品信息，提交后，控制台输出</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-图片上传：没有按钮，加个，并实现功能rich-text-jsx"><span class="nav-number">2.6.</span> <span class="nav-text">3 图片上传：没有按钮，加个，并实现功能rich-text.jsx</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#效果：点富文本内的图片上传按钮可成功上传图片："><span class="nav-number">2.6.1.</span> <span class="nav-text">效果：点富文本内的图片上传按钮可成功上传图片：</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#三、提交添加商品请求"><span class="nav-number">3.</span> <span class="nav-text">三、提交添加商品请求</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#第一步：编写api请求函数-src-api-index-js"><span class="nav-number">3.1.</span> <span class="nav-text">第一步：编写api请求函数(src&#x2F;api&#x2F;index.js)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#第二步：收集表单数据（src-pages-product-add-update-jsx）"><span class="nav-number">3.2.</span> <span class="nav-text">第二步：收集表单数据（src&#x2F;pages&#x2F;product&#x2F;add-update.jsx）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2步效果：填写完成添加产品表单，点提交按钮："><span class="nav-number">3.2.1.</span> <span class="nav-text">2步效果：填写完成添加产品表单，点提交按钮：</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#第三步：提交数据（添加商品）"><span class="nav-number">3.3.</span> <span class="nav-text">第三步：提交数据（添加商品）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3步效果：全部完成点提交，将显示添加产品成功"><span class="nav-number">3.3.1.</span> <span class="nav-text">3步效果：全部完成点提交，将显示添加产品成功</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#附：完整代码"><span class="nav-number">4.</span> <span class="nav-text">附：完整代码</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-商品管理主页src-pages-product-home-jsx"><span class="nav-number">4.1.</span> <span class="nav-text">1.商品管理主页src&#x2F;pages&#x2F;product&#x2F;home.jsx</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#商品管理主页效果http-localhost-3000-product"><span class="nav-number">4.1.1.</span> <span class="nav-text">商品管理主页效果http:&#x2F;&#x2F;localhost:3000&#x2F;product</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-商品添加组件src-pages-product-add-update-jsx"><span class="nav-number">4.2.</span> <span class="nav-text">2.商品添加组件src&#x2F;pages&#x2F;product&#x2F;add-update.jsx</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#商品添加页效果：http-localhost-3000-product-add-update"><span class="nav-number">4.2.1.</span> <span class="nav-text">商品添加页效果：http:&#x2F;&#x2F;localhost:3000&#x2F;product&#x2F;add-update</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-异步请求函数src-api-index-js"><span class="nav-number">4.3.</span> <span class="nav-text">3.异步请求函数src&#x2F;api&#x2F;index.js</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-商品路由页src-page-pruduct-index-jsx"><span class="nav-number">4.4.</span> <span class="nav-text">4.商品路由页src&#x2F;page&#x2F;pruduct&#x2F;index.jsx</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-富文件编辑组件rich-text-jsx"><span class="nav-number">4.5.</span> <span class="nav-text">5.富文件编辑组件rich-text.jsx</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-图片上传组件src-page-product-pictures-wall-jsx"><span class="nav-number">4.6.</span> <span class="nav-text">6.图片上传组件src&#x2F;page&#x2F;product&#x2F;pictures-wall.jsx</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="晨曦"
      src="http://www.zeyajt.com/u/40b74ddb-a87b-41cd-821b-3f6eeb544661/image/637203952121373129.jpg">
  <p class="site-author-name" itemprop="name">晨曦</p>
  <div class="site-description" itemprop="description">晨曦的技术博客，专注于python、vue、react、人工智能、爬虫、大数据分析</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">97</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">15</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">9</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">晨曦</span>
</div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  


 
</body>
</html>
